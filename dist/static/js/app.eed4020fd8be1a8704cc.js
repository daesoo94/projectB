webpackJsonp([1],{"+F07":function(e,t){e.exports={id:"item-sword1",width:16,height:16,animations:{idle:{length:6,row:0}},offset_x:0,offset_y:0}},"+rbd":function(e,t){e.exports={id:"agent",width:24,height:24,animations:{idle_down:{length:2,row:0}},offset_x:-4,offset_y:-8}},"/Ooo":function(e,t){e.exports={id:"king",width:32,height:32,animations:{idle_down:{length:2,row:0}},offset_x:-8,offset_y:-12}},"/c9u":function(e,t,i){"use strict";var a=i("OvRC"),n=i.n(a),r=i("XDXK"),o=function(e,t,i,a,n,o){this.color=t;i=void 0!==i?i:0,a=void 0!==a?a:0,n=void 0!==n?n:1,o=void 0!==o?o:1;r.a.bind(this)(e,i,a,n,o)};(o.prototype=n()(r.a.prototype)).draw=function(e,t,i,a,n){e.fillStyle=this.color,e.fillRect(t,i,a,n)},t.a=o},"/sf/":function(e,t){e.exports={id:"guard",width:25,height:24,animations:{idle_down:{length:2,row:0}},offset_x:-5,offset_y:-8}},"/z/9":function(e,t){e.exports={id:"item-goldensword",width:16,height:16,animations:{idle:{length:6,row:0}},offset_x:0,offset_y:0}},0:function(e,t){},"0U4p":function(e,t){e.exports={id:"snake",width:28,height:28,animations:{atk_right:{length:5,row:0},walk_right:{length:4,row:1},idle_right:{length:4,row:2},atk_up:{length:5,row:3},walk_up:{length:4,row:4},idle_up:{length:4,row:5},atk_down:{length:5,row:6},walk_down:{length:4,row:7},idle_down:{length:6,row:8}},offset_x:-6,offset_y:-10}},"0YEL":function(e,t){e.exports={id:"item-leatherarmor",width:16,height:16,animations:{idle:{length:6,row:0}},offset_x:0,offset_y:0}},"0i05":function(e,t){e.exports={id:"mailarmor",width:32,height:32,animations:{atk_right:{length:5,row:0},walk_right:{length:4,row:1},idle_right:{length:2,row:2},atk_up:{length:5,row:3},walk_up:{length:4,row:4},idle_up:{length:2,row:5},atk_down:{length:5,row:6},walk_down:{length:4,row:7},idle_down:{length:2,row:8}},offset_x:-8,offset_y:-12}},1:function(e,t){},"1ZLN":function(e,t,i){var a={"./agent.json":"+rbd","./arrow.json":"ijQv","./axe.json":"q9QV","./bat.json":"oxPP","./beachnpc.json":"72jo","./bluesword.json":"yWNk","./boss.json":"taTb","./chest.json":"cKQl","./clotharmor.json":"AKwQ","./coder.json":"eOxi","./crab.json":"UcV4","./death.json":"Sqs0","./deathknight.json":"Oy9j","./desertnpc.json":"lUAm","./eye.json":"PznX","./firefox.json":"ujQs","./forestnpc.json":"aNYQ","./goblin.json":"C37V","./goldenarmor.json":"UStB","./goldensword.json":"hemJ","./guard.json":"/sf/","./hand.json":"mJyv","./impact.json":"t9nu","./item-axe.json":"HITf","./item-bluesword.json":"ZBgj","./item-burger.json":"wzZJ","./item-cake.json":"B4O8","./item-clotharmor.json":"LsZA","./item-firepotion.json":"9R10","./item-flask.json":"RgGw","./item-goldenarmor.json":"SML3","./item-goldensword.json":"/z/9","./item-leatherarmor.json":"0YEL","./item-mailarmor.json":"BvGv","./item-morningstar.json":"3SDg","./item-platearmor.json":"n+Rf","./item-redarmor.json":"A0vU","./item-redsword.json":"RZ8U","./item-sword1.json":"+F07","./item-sword2.json":"7fe2","./king.json":"/Ooo","./lavanpc.json":"Tb6K","./leatherarmor.json":"JYMs","./loot.json":"ySG5","./mailarmor.json":"0i05","./morningstar.json":"34Xz","./nyan.json":"47gg","./octocat.json":"lgfl","./ogre.json":"8VIR","./platearmor.json":"L0hz","./priest.json":"ni5p","./rat.json":"zRJz","./redarmor.json":"RVzG","./redsword.json":"IJ/y","./rick.json":"4Alr","./scientist.json":"t0mp","./shadow16.json":"me95","./skeleton.json":"1mYB","./skeleton2.json":"jgxY","./snake.json":"0U4p","./sorcerer.json":"8emz","./sparks.json":"2UF/","./spectre.json":"NxES","./sword.json":"wine","./sword1.json":"vm1t","./sword2.json":"H7Qu","./talk.json":"j8az","./target.json":"Qyla","./test1.json":"esNN","./villagegirl.json":"KD9h","./villager.json":"e7Fs","./wizard.json":"Lx20"};function n(e){return i(r(e))}function r(e){var t=a[e];if(!(t+1))throw new Error("Cannot find module '"+e+"'.");return t}n.keys=function(){return Object.keys(a)},n.resolve=r,e.exports=n,n.id="1ZLN"},"1fqz":function(e,t,i){"use strict";var a=i("Zx67"),n=i.n(a),r=i("Zrlr"),o=i.n(r),s=i("zwoO"),h=i.n(s),l=i("Pf15"),c=i.n(l),d=function(e){function t(e,i,a){o()(this,t);var r=h()(this,(t.__proto__||n()(t)).call(this,e,a));return r.name=i,r}return c()(t,e),t}(i("zTqn").a);t.a=d},"1mYB":function(e,t){e.exports={id:"skeleton",width:48,height:48,animations:{atk_right:{length:3,row:0},walk_right:{length:4,row:1},idle_right:{length:2,row:2},atk_up:{length:3,row:3},walk_up:{length:4,row:4},idle_up:{length:3,row:5},atk_down:{length:3,row:6},walk_down:{length:4,row:7},idle_down:{length:3,row:8}},offset_x:-16,offset_y:-20}},2:function(e,t){},"2UF/":function(e,t){e.exports={id:"sparks",width:16,height:16,animations:{idle:{length:6,row:0}},offset_x:0,offset_y:0}},3:function(e,t){},"34Xz":function(e,t){e.exports={id:"morningstar",width:38,height:38,animations:{atk_right:{length:5,row:0},walk_right:{length:4,row:1},idle_right:{length:2,row:2},atk_up:{length:5,row:3},walk_up:{length:4,row:4},idle_up:{length:2,row:5},atk_down:{length:5,row:6},walk_down:{length:4,row:7},idle_down:{length:2,row:8}},offset_x:-11,offset_y:-15}},"3SDg":function(e,t){e.exports={id:"item-morningstar",width:16,height:16,animations:{idle:{length:6,row:0}},offset_x:0,offset_y:0}},"47gg":function(e,t){e.exports={id:"nyan",width:49,height:24,animations:{idle_down:{length:6,row:0}},offset_x:-22,offset_y:-6}},"4Alr":function(e,t){e.exports={id:"rick",width:32,height:32,animations:{idle_down:{length:4,row:0}},offset_x:-8,offset_y:-12}},"4Vh3":function(e,t){e.exports={modp1:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a63a3620ffffffffffffffff"},modp2:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece65381ffffffffffffffff"},modp5:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca237327ffffffffffffffff"},modp14:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aacaa68ffffffffffffffff"},modp15:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a93ad2caffffffffffffffff"},modp16:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c934063199ffffffffffffffff"},modp17:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c93402849236c3fab4d27c7026c1d4dcb2602646dec9751e763dba37bdf8ff9406ad9e530ee5db382f413001aeb06a53ed9027d831179727b0865a8918da3edbebcf9b14ed44ce6cbaced4bb1bdb7f1447e6cc254b332051512bd7af426fb8f401378cd2bf5983ca01c64b92ecf032ea15d1721d03f482d7ce6e74fef6d55e702f46980c82b5a84031900b1c9e59e7c97fbec7e8f323a97a7e36cc88be0f1d45b7ff585ac54bd407b22b4154aacc8f6d7ebf48e1d814cc5ed20f8037e0a79715eef29be32806a1d58bb7c5da76f550aa3d8a1fbff0eb19ccb1a313d55cda56c9ec2ef29632387fe8d76e3c0468043e8f663f4860ee12bf2d5b0b7474d6e694f91e6dcc4024ffffffffffffffff"},modp18:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c93402849236c3fab4d27c7026c1d4dcb2602646dec9751e763dba37bdf8ff9406ad9e530ee5db382f413001aeb06a53ed9027d831179727b0865a8918da3edbebcf9b14ed44ce6cbaced4bb1bdb7f1447e6cc254b332051512bd7af426fb8f401378cd2bf5983ca01c64b92ecf032ea15d1721d03f482d7ce6e74fef6d55e702f46980c82b5a84031900b1c9e59e7c97fbec7e8f323a97a7e36cc88be0f1d45b7ff585ac54bd407b22b4154aacc8f6d7ebf48e1d814cc5ed20f8037e0a79715eef29be32806a1d58bb7c5da76f550aa3d8a1fbff0eb19ccb1a313d55cda56c9ec2ef29632387fe8d76e3c0468043e8f663f4860ee12bf2d5b0b7474d6e694f91e6dbe115974a3926f12fee5e438777cb6a932df8cd8bec4d073b931ba3bc832b68d9dd300741fa7bf8afc47ed2576f6936ba424663aab639c5ae4f5683423b4742bf1c978238f16cbe39d652de3fdb8befc848ad922222e04a4037c0713eb57a81a23f0c73473fc646cea306b4bcbc8862f8385ddfa9d4b7fa2c087e879683303ed5bdd3a062b3cf5b3a278a66d2a13f83f44f82ddf310ee074ab6a364597e899a0255dc164f31cc50846851df9ab48195ded7ea1b1d510bd7ee74d73faf36bc31ecfa268359046f4eb879f924009438b481c6cd7889a002ed5ee382bc9190da6fc026e479558e4475677e9aa9e3050e2765694dfc81f56e880b96e7160c980dd98edd3dfffffffffffffffff"}}},"6ZSt":function(e,t){e.exports={"aes-128-ecb":{cipher:"AES",key:128,iv:0,mode:"ECB",type:"block"},"aes-192-ecb":{cipher:"AES",key:192,iv:0,mode:"ECB",type:"block"},"aes-256-ecb":{cipher:"AES",key:256,iv:0,mode:"ECB",type:"block"},"aes-128-cbc":{cipher:"AES",key:128,iv:16,mode:"CBC",type:"block"},"aes-192-cbc":{cipher:"AES",key:192,iv:16,mode:"CBC",type:"block"},"aes-256-cbc":{cipher:"AES",key:256,iv:16,mode:"CBC",type:"block"},aes128:{cipher:"AES",key:128,iv:16,mode:"CBC",type:"block"},aes192:{cipher:"AES",key:192,iv:16,mode:"CBC",type:"block"},aes256:{cipher:"AES",key:256,iv:16,mode:"CBC",type:"block"},"aes-128-cfb":{cipher:"AES",key:128,iv:16,mode:"CFB",type:"stream"},"aes-192-cfb":{cipher:"AES",key:192,iv:16,mode:"CFB",type:"stream"},"aes-256-cfb":{cipher:"AES",key:256,iv:16,mode:"CFB",type:"stream"},"aes-128-cfb8":{cipher:"AES",key:128,iv:16,mode:"CFB8",type:"stream"},"aes-192-cfb8":{cipher:"AES",key:192,iv:16,mode:"CFB8",type:"stream"},"aes-256-cfb8":{cipher:"AES",key:256,iv:16,mode:"CFB8",type:"stream"},"aes-128-cfb1":{cipher:"AES",key:128,iv:16,mode:"CFB1",type:"stream"},"aes-192-cfb1":{cipher:"AES",key:192,iv:16,mode:"CFB1",type:"stream"},"aes-256-cfb1":{cipher:"AES",key:256,iv:16,mode:"CFB1",type:"stream"},"aes-128-ofb":{cipher:"AES",key:128,iv:16,mode:"OFB",type:"stream"},"aes-192-ofb":{cipher:"AES",key:192,iv:16,mode:"OFB",type:"stream"},"aes-256-ofb":{cipher:"AES",key:256,iv:16,mode:"OFB",type:"stream"},"aes-128-ctr":{cipher:"AES",key:128,iv:16,mode:"CTR",type:"stream"},"aes-192-ctr":{cipher:"AES",key:192,iv:16,mode:"CTR",type:"stream"},"aes-256-ctr":{cipher:"AES",key:256,iv:16,mode:"CTR",type:"stream"},"aes-128-gcm":{cipher:"AES",key:128,iv:12,mode:"GCM",type:"auth"},"aes-192-gcm":{cipher:"AES",key:192,iv:12,mode:"GCM",type:"auth"},"aes-256-gcm":{cipher:"AES",key:256,iv:12,mode:"GCM",type:"auth"}}},"72jo":function(e,t){e.exports={id:"beachnpc",width:24,height:24,animations:{idle_down:{length:2,row:0}},offset_x:-4,offset_y:-8}},"7fe2":function(e,t){e.exports={id:"item-sword2",width:16,height:16,animations:{idle:{length:6,row:0}},offset_x:0,offset_y:0}},"8VIR":function(e,t){e.exports={id:"ogre",width:48,height:48,animations:{atk_right:{length:3,row:0},walk_right:{length:6,row:1},idle_right:{length:2,row:2},atk_up:{length:3,row:3},walk_up:{length:5,row:4},idle_up:{length:2,row:5},atk_down:{length:3,row:6},walk_down:{length:6,row:7},idle_down:{length:2,row:8}},offset_x:-16,offset_y:-24}},"8YCc":function(e,t){e.exports={"2.16.840.1.101.3.4.1.1":"aes-128-ecb","2.16.840.1.101.3.4.1.2":"aes-128-cbc","2.16.840.1.101.3.4.1.3":"aes-128-ofb","2.16.840.1.101.3.4.1.4":"aes-128-cfb","2.16.840.1.101.3.4.1.21":"aes-192-ecb","2.16.840.1.101.3.4.1.22":"aes-192-cbc","2.16.840.1.101.3.4.1.23":"aes-192-ofb","2.16.840.1.101.3.4.1.24":"aes-192-cfb","2.16.840.1.101.3.4.1.41":"aes-256-ecb","2.16.840.1.101.3.4.1.42":"aes-256-cbc","2.16.840.1.101.3.4.1.43":"aes-256-ofb","2.16.840.1.101.3.4.1.44":"aes-256-cfb"}},"8emz":function(e,t){e.exports={id:"sorcerer",width:26,height:26,animations:{idle_down:{length:6,row:0}},offset_x:-5,offset_y:-9}},"8qcI":function(e,t,i){"use strict";var a=i("BO1k"),n=i.n(a),r=[],o=!0,s=!1,h=void 0;try{for(var l,c=n()(["deathknight","clotharmor","test1"]);!(o=(l=c.next()).done);o=!0){var d=l.value,f=i("1ZLN")("./"+d+".json");r.push(f)}}catch(e){s=!0,h=e}finally{try{!o&&c.return&&c.return()}finally{if(s)throw h}}t.a=r},"9R10":function(e,t){e.exports={id:"item-firepotion",width:16,height:16,animations:{idle:{length:6,row:0}},offset_x:0,offset_y:0}},A0vU:function(e,t){e.exports={id:"item-redarmor",width:16,height:16,animations:{idle:{length:6,row:0}},offset_x:0,offset_y:0}},AKwQ:function(e,t){e.exports={id:"clotharmor",width:32,height:32,animations:{atk_right:{length:5,row:0},walk_right:{length:4,row:1},idle_right:{length:2,row:2},atk_up:{length:5,row:3},walk_up:{length:4,row:4},idle_up:{length:2,row:5},atk_down:{length:5,row:6},walk_down:{length:4,row:7},idle_down:{length:2,row:8}},offset_x:-8,offset_y:-12}},AeT2:function(e,t,i){"use strict";(function(e){var a=i("C4MV"),n=i.n(a),r=i("uL5Q"),o=i("Rr+P"),s=i("/c9u"),h=i("b8n+"),l=i("tTs3"),c=i("jQdr"),d=(i.n(c),["x","y","width","height","rotation","alpha","visible","pivot","anchor","smoothing","stretch","offset","text","scale","parent","textAlign","assetPath","color","left","right","up","down","ActiveInvoke"]),f=function(e,t){d.forEach(function(i){var a="_proxied_"+i;e[a]=e[i],n()(e,i,{set:function(n){e[i]!==n&&(t.shouldReDraw=!0),e[a]=n},get:function(){return e[a]}})})},u=function(e,t,i){this.displayObjects=[],this.eventListeners={click:[]},this.clearRect=null,this.gameCanvas=e,this.canvas=document.getElementById("foreground"),this.context=this.canvas.getContext("2d"),this.renderOnQuad=i||!1,this.shouldReDraw=!0,this.renderOnQuad&&this.prepareThreeJSScene(),this.resize()};u.anchors=r.a,u.prototype.addCanvasToDom=function(){this.gameCanvas.parentNode.appendChild(this.canvas)},u.prototype.prepareThreeJSScene=function(){this.camera=new e.OrthographicCamera(-this.canvas.width/2,this.canvas.width/2,this.canvas.height/2,-this.canvas.height/2,0,30),this.scene=new e.Scene,this.texture=new e.Texture(this.canvas);var t=new e.MeshBasicMaterial({map:this.texture});t.transparent=!0;var i=new e.PlaneGeometry(this.canvas.width,this.canvas.height);this.plane=new e.Mesh(i,t),this.plane.matrixAutoUpdate=!1,this.scene.add(this.plane)},u.prototype.resize=function(){this.width=800,this.height=400,this.shouldReDraw=!0},u.prototype.draw=function(){if(this.shouldReDraw){this.clearRect||this.context.clearRect(0,0,this.canvas.width,this.canvas.height);for(var e=this.displayObjects.length,t=0;t<e;t++)this.displayObjects[t].render(this.context);this.renderOnQuad&&(this.texture.needsUpdate=!0),this.shouldReDraw=!1}},u.prototype.render=function(e){this.draw(),this.renderOnQuad&&e.render(this.scene,this.camera),this.colorReplace&&(this.context.save(),this.context.fillStyle=this.colorReplace,this.context.globalCompositeOperation="source-atop",this.context.fillRect(0,0,this.canvas.width,this.canvas.height),this.context.restore())},u.prototype.createSprite=function(e,t,i,a,n){var r=new h.a(this,e,t,i,a,n);return this.displayObjects.push(r),f(r,this),r},u.prototype.createSpriteFromSheet=function(e,t,i,a,n,r,o){var s=new h.a(this,e,a,n,r,o,t,i);return this.displayObjects.push(s),f(s,this),s},u.prototype.createRectangle=function(e,t,i,a,n){var r=new s.a(this,e,t,i,a,n);return this.displayObjects.push(r),f(r,this),r},u.prototype.createText=function(e,t,i,a,n){var r=new l.a(this,e,t,i,a,n);return this.displayObjects.push(r),f(r,this),r},u.prototype.createBitmapText=function(e,t,i,a,n,r){var s=new o.a(this,e,t,i,a,n,r);return this.displayObjects.push(s),f(s,this),s},u.prototype.addEventListener=function(e,t,i){this.eventListeners[e].push({callback:t,displayObject:i})},u.prototype.clickHandler=function(e,t){var i={x:e,y:t},a=[];this.eventListeners.click.forEach(function(e){var t=e.displayObject;if(t.shouldReceiveEvents()){var n=t.getBounds();u.isInBoundingBox(i.x,i.y,n.x,n.y,n.width,n.height)&&a.push(e.callback)}});var n=!1;return a.forEach(function(e){e(),n=!0}),n},u.prototype.windowToUISpace=function(e,t){var i=this.gameCanvas.getBoundingClientRect(),a=this.height/i.height;return{x:(e-i.left)*a,y:(t-i.top)*a}},u.prototype.moveToFront=function(e){var t=this.displayObjects.indexOf(e);t>-1&&this.displayObjects.splice(t,1),this.displayObjects.push(e)},u.isInBoundingBox=function(e,t,i,a,n,r){return e>=i&&e<=i+n&&t>=a&&t<=a+r},t.a=u}).call(t,i("Ml+6"))},B4O8:function(e,t){e.exports={id:"item-cake",width:24,height:24,animations:{idle:{length:3,row:0}},offset_x:-4,offset_y:-6}},BvGv:function(e,t){e.exports={id:"item-mailarmor",width:16,height:16,animations:{idle:{length:6,row:0}},offset_x:0,offset_y:0}},C37V:function(e,t){e.exports={id:"goblin",width:26,height:26,animations:{atk_right:{length:3,row:0},walk_right:{length:3,row:1},idle_right:{length:2,row:2},atk_up:{length:3,row:3},walk_up:{length:4,row:4},idle_up:{length:2,row:5},atk_down:{length:3,row:6},walk_down:{length:4,row:7},idle_down:{length:2,row:8}},offset_x:-5,offset_y:-9}},DwfQ:function(e,t,i){"use strict";(function(e){var a=i("Zx67"),n=i.n(a),r=i("Zrlr"),o=i.n(r),s=i("wxAW"),h=i.n(s),l=i("zwoO"),c=i.n(l),d=i("Pf15"),f=i.n(d),u=function(t){function i(e,t){o()(this,i);var a=c()(this,(i.__proto__||n()(i)).call(this,e,t));return a.load(),a}return f()(i,t),h()(i,[{key:"load",value:function(){var t=new e.BoxBufferGeometry(8,8,8),i=new e.MeshLambertMaterial({color:16777215}),a=new e.Mesh(t,i);t.computeBoundingBox(),this.mesh=a,this.offset={x:0,y:-t.boundingBox.min.y,z:0},this.isLoaded=!0}},{key:"attachPointLight",value:function(t,i,a){var n=new e.PointLight(t,i,a);n.position.set(0,10,0),n.castShadow=!0,this.mesh.add(n)}}]),i}(i("m3jU").a);t.a=u}).call(t,i("Ml+6"))},GoZD:function(e,t,i){"use strict";var a=i("Zrlr"),n=i.n(a),r=i("wxAW"),o=i.n(r);
/**
 * A* (A-Star) algorithm for a path finder
 * @author  Andrea Giammarchi
 * @license Mit Style License
 */
function s(e,t,i,a,n,r,o,s,h,l,c,d,f){return e&&(i&&!h[n][o]&&(d[f++]={x:o,y:n}),a&&!h[n][s]&&(d[f++]={x:s,y:n})),t&&(i&&!h[r][o]&&(d[f++]={x:o,y:r}),a&&!h[r][s]&&(d[f++]={x:s,y:r})),d}function h(e,t,i,a,n,r,o,s,h,l,c,d,f){return e=n>-1,t=r<l,a=s>-1,o<c&&(e&&!h[n][o]&&(d[f++]={x:o,y:n}),t&&!h[r][o]&&(d[f++]={x:o,y:r})),a&&(e&&!h[n][s]&&(d[f++]={x:s,y:n}),t&&!h[r][s]&&(d[f++]={x:s,y:r})),d}function l(e,t,i,a,n,r,o,s,h,l,c,d,f){return d}function c(e,t,i,a,n,r){var o=i-1,s=i+1,h=t+1,l=t-1,c=o>-1&&!a[o][t],d=s<n&&!a[s][t],f=h<r&&!a[i][h],u=l>-1&&!a[i][l],p=[],g=0;return c&&(p[g++]={x:t,y:o}),f&&(p[g++]={x:h,y:i}),d&&(p[g++]={x:t,y:s}),u&&(p[g++]={x:l,y:i}),e(c,d,f,u,o,s,h,l,a,n,r,p,g)}function d(e,t,i,a){return a(i(e.x-t.x),i(e.y-t.y))}function f(e,t,i,a){var n=e.x-t.x,r=e.y-t.y;return a(n*n+r*r)}function u(e,t,i,a){return i(e.x-t.x)+i(e.y-t.y)}var p=function(e,t,i,a){var n,r,o,p,g,m,v,w,b,y=e[0].length,_=e.length,x=y*_,k=Math.abs,S=Math.max,M={},T=[],A=[{x:t[0],y:t[1],f:0,g:0,v:t[0]+t[1]*y}],E=1;switch(i={x:i[0],y:i[1],v:i[0]+i[1]*y},a){case"Diagonal":o=s;case"DiagonalFree":r=d;break;case"Euclidean":o=s;case"EuclideanFree":S=Math.sqrt,r=f;break;default:r=u,o=l}o||(o=h);do{for(m=x,v=0,p=0;p<E;++p)(a=A[p].f)<m&&(m=a,v=p);if((w=A.splice(v,1)[0]).v!=i.v)for(--E,p=0,g=(b=c(o,w.x,w.y,e,_,y)).length;p<g;++p)(n=b[p]).p=w,n.f=n.g=0,n.v=n.x+n.y*y,n.v in M||(n.f=(n.g=w.g+r(n,w,k,S))+r(n,i,k,S),A[E++]=n,M[n.v]=1);else{p=E=0;do{T[p++]=[w.x,w.y]}while(w=w.p);T.reverse()}}while(E);return T},g=function(){function e(t,i){n()(this,e),this.width=t,this.height=i,this.grid=null,this.ignored=[],this.initBlankGrid()}return o()(e,[{key:"initBlankGrid",value:function(){this.blankGrid=[];for(var e=0;e<this.height;e+=1){this.blankGrid[e]=[];for(var t=0;t<this.width;t+=1)this.blankGrid[e][t]=0}}},{key:"findPath",value:function(e,t,i,a,n){var r=[t.gridX,t.gridY],o=[i,a];this.grid=e;var s=p(this.grid,r,o);return 0===s.length&&!0===n&&(s=this.findIncompletePath_(r,o)),s}},{key:"findIncompletePath_",value:function(e,t){for(var i,a=void 0,n=void 0,r=[],o=(i=p(this.blankGrid,e,t)).length-1;o>0;o-=1)if(a=i[o][0],n=i[o][1],0===this.grid[n][a]){r=p(this.grid,e,[a,n]);break}return r}},{key:"ignoreEntity",value:function(e){e&&this.ignored.push(e)}},{key:"clearIgnoreList",value:function(){this.applyIgnoreList_(!1),this.ignored=[]}}]),e}();t.a=g},H7Qu:function(e,t){e.exports={id:"sword2",width:48,height:48,animations:{atk_right:{length:5,row:0},walk_right:{length:4,row:1},idle_right:{length:2,row:2},atk_up:{length:5,row:3},walk_up:{length:4,row:4},idle_up:{length:2,row:5},atk_down:{length:5,row:6},walk_down:{length:4,row:7},idle_down:{length:2,row:8}},offset_x:-16,offset_y:-20}},HITf:function(e,t){e.exports={id:"item-axe",width:16,height:16,animations:{idle:{length:6,row:0}},offset_x:0,offset_y:0}},"IJ/y":function(e,t){e.exports={id:"redsword",width:48,height:48,animations:{atk_right:{length:5,row:0},walk_right:{length:4,row:1},idle_right:{length:2,row:2},atk_up:{length:5,row:3},walk_up:{length:4,row:4},idle_up:{length:2,row:5},atk_down:{length:5,row:6},walk_down:{length:4,row:7},idle_down:{length:2,row:8}},offset_x:-16,offset_y:-20}},ITPp:function(e,t,i){"use strict";(function(e,a){var n=i("Zrlr"),r=i.n(n),o=i("wxAW"),s=i.n(o),h=i("N9/5"),l=function(e){return e%1==0},c=function(){function t(e){r()(this,t),this.loadMap()}return s()(t,[{key:"loadMap",value:function(){var t=this;e.get("static/maps.json",function(e){t._initMap(e),t._generateCollisionGrid(),(new h.a).load("static/terrain.gltf",function(e){t.model=e,t.isLoaded=!0})},"json")}},{key:"_initMap",value:function(e){this.width=e.width,this.height=e.height,this.data=e.data,this.tilesize=e.tilesize,this.collisions=e.collisions,this.props=e.props}},{key:"_generateCollisionGrid",value:function(){var e=this;this.grid=[];for(var t=0;t<this.height;t++){this.grid[t]=[];for(var i=0;i<this.width;i++)this.grid[t][i]=0}a.each(this.collisions,function(t){var i=e.tileIndexToGridPosition(t+1);e.grid[i.y][i.x]=1})}},{key:"isColliding",value:function(e,t){return!(this.isOutOfBounds(e,t)||!this.grid)&&1===this.grid[t][e]}},{key:"isOutOfBounds",value:function(e,t){return l(e)&&l(t)&&(e<0||e>=this.width||t<0||t>=this.height)}},{key:"tileIndexToGridPosition",value:function(e){return{x:(e-=1)%this.width,y:Math.floor(e/this.width)}}}]),t}();t.a=c}).call(t,i("7t+N"),i("rdLu"))},JYMs:function(e,t){e.exports={id:"leatherarmor",width:32,height:32,animations:{atk_right:{length:5,row:0},walk_right:{length:4,row:1},idle_right:{length:2,row:2},atk_up:{length:5,row:3},walk_up:{length:4,row:4},idle_up:{length:2,row:5},atk_down:{length:5,row:6},walk_down:{length:4,row:7},idle_down:{length:2,row:8}},offset_x:-8,offset_y:-12}},KD9h:function(e,t){e.exports={id:"villagegirl",width:24,height:24,animations:{idle_down:{length:2,row:0}},offset_x:-4,offset_y:-8}},KGr3:function(e,t,i){"use strict";(function(e){var a=i("Zrlr"),n=i.n(a);t.a=function t(i,a){n()(this,t),this.game=i,this.map=a;var r=new e.PlaneBufferGeometry(a.width*a.tilesize,a.height*a.tilesize,a.width,a.height),o=new e.MeshStandardMaterial({transparent:!0,opacity:0}),s=new e.Mesh(r,o);if(s.rotation.order="YXZ",s.rotation.x=-Math.PI/2,s.position.y=1,r.computeBoundingBox(),i.map.offset={x:r.boundingBox.min.x,y:r.boundingBox.min.y},this.terrain=s,a.model){var h=a.model.scene.children[0];h.receiveShadow=!0,h.rotation.y=-Math.PI/2,h.scale.set(5,5,5),this.model=h}}}).call(t,i("Ml+6"))},KYqO:function(e,t){e.exports={_args:[["elliptic@6.4.1","C:\\work\\GitHub\\projectB"]],_development:!0,_from:"elliptic@6.4.1",_id:"elliptic@6.4.1",_inBundle:!1,_integrity:"sha512-BsXLz5sqX8OHcsh7CqBMztyXARmGQ3LWPtGjJi6DiJHq5C/qvi9P3OqgswKSDftbu8+IoI/QDTAm2fFnQ9SZSQ==",_location:"/elliptic",_phantomChildren:{},_requested:{type:"version",registry:!0,raw:"elliptic@6.4.1",name:"elliptic",escapedName:"elliptic",rawSpec:"6.4.1",saveSpec:null,fetchSpec:"6.4.1"},_requiredBy:["/browserify-sign","/create-ecdh"],_resolved:"https://registry.npmjs.org/elliptic/-/elliptic-6.4.1.tgz",_spec:"6.4.1",_where:"C:\\work\\GitHub\\projectB",author:{name:"Fedor Indutny",email:"fedor@indutny.com"},bugs:{url:"https://github.com/indutny/elliptic/issues"},dependencies:{"bn.js":"^4.4.0",brorand:"^1.0.1","hash.js":"^1.0.0","hmac-drbg":"^1.0.0",inherits:"^2.0.1","minimalistic-assert":"^1.0.0","minimalistic-crypto-utils":"^1.0.0"},description:"EC cryptography",devDependencies:{brfs:"^1.4.3",coveralls:"^2.11.3",grunt:"^0.4.5","grunt-browserify":"^5.0.0","grunt-cli":"^1.2.0","grunt-contrib-connect":"^1.0.0","grunt-contrib-copy":"^1.0.0","grunt-contrib-uglify":"^1.0.1","grunt-mocha-istanbul":"^3.0.1","grunt-saucelabs":"^8.6.2",istanbul:"^0.4.2",jscs:"^2.9.0",jshint:"^2.6.0",mocha:"^2.1.0"},files:["lib"],homepage:"https://github.com/indutny/elliptic",keywords:["EC","Elliptic","curve","Cryptography"],license:"MIT",main:"lib/elliptic.js",name:"elliptic",repository:{type:"git",url:"git+ssh://git@github.com/indutny/elliptic.git"},scripts:{jscs:"jscs benchmarks/*.js lib/*.js lib/**/*.js lib/**/**/*.js test/index.js",jshint:"jscs benchmarks/*.js lib/*.js lib/**/*.js lib/**/**/*.js test/index.js",lint:"npm run jscs && npm run jshint",test:"npm run lint && npm run unit",unit:"istanbul test _mocha --reporter=spec test/index.js",version:"grunt dist && git add dist/"},version:"6.4.1"}},L0hz:function(e,t){e.exports={id:"platearmor",width:32,height:32,animations:{atk_right:{length:5,row:0},walk_right:{length:4,row:1},idle_right:{length:2,row:2},atk_up:{length:5,row:3},walk_up:{length:4,row:4},idle_up:{length:2,row:5},atk_down:{length:5,row:6},walk_down:{length:4,row:7},idle_down:{length:2,row:8}},offset_x:-8,offset_y:-12}},LsZA:function(e,t){e.exports={id:"item-clotharmor",width:16,height:16,animations:{idle:{length:6,row:0}},offset_x:0,offset_y:0}},Lx20:function(e,t){e.exports={id:"wizard",width:26,height:26,animations:{death:{length:3,row:0},atk_right:{length:4,row:1},atk_up:{length:4,row:2},atk_down:{length:4,row:3},walk_right:{length:4,row:4},walk_up:{length:4,row:5},walk_down:{length:4,row:6},idle_right:{length:6,row:7},idle_up:{length:6,row:8},idle_down:{length:6,row:9}},offset_x:-5,offset_y:-9}},"N9/5":function(e,t,i){"use strict";(function(e){var a=i("fZjL"),n=i.n(a),r=i("pFYg"),o=i.n(r),s=i("OvRC"),h=i.n(s),l=i("//Fk"),c=i.n(l),d=i("Zrlr"),f=i.n(d),u=i("wxAW"),p=i.n(u),g=function(){function t(i){f()(this,t),this.manager=void 0!==i?i:e.DefaultLoadingManager,this.dracoLoader=null,this.crossOrigin="anonymous"}return p()(t,[{key:"load",value:function(t,i,a,n){var r,o=this;r=void 0!==this.resourcePath?this.resourcePath:void 0!==this.path?this.path:e.LoaderUtils.extractUrlBase(t),o.manager.itemStart(t);var s=function(e){n?n(e):console.error(e),o.manager.itemError(t),o.manager.itemEnd(t)},h=new e.FileLoader(o.manager);h.setPath(this.path),h.setResponseType("arraybuffer"),h.load(t,function(e){try{o.parse(e,r,function(e){i(e),o.manager.itemEnd(t)},s)}catch(e){s(e)}},a,s)}},{key:"setCrossOrigin",value:function(e){return this.crossOrigin=e,this}},{key:"setPath",value:function(e){return this.path=e,this}},{key:"setResourcePath",value:function(e){return this.resourcePath=e,this}},{key:"setDRACOLoader",value:function(e){return this.dracoLoader=e,this}},{key:"parse",value:function(t,i,a,n){var r,o={};if("string"==typeof t)r=t;else if(e.LoaderUtils.decodeText(new Uint8Array(t,0,4))===_){try{o[v.KHR_BINARY_GLTF]=new function(t){this.name=v.KHR_BINARY_GLTF,this.content=null,this.body=null;var i=new DataView(t,0,x);if(this.header={magic:e.LoaderUtils.decodeText(new Uint8Array(t.slice(0,4))),version:i.getUint32(4,!0),length:i.getUint32(8,!0)},this.header.magic!==_)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected. Use LegacyGLTFLoader instead.");var a=new DataView(t,x),n=0;for(;n<a.byteLength;){var r=a.getUint32(n,!0);n+=4;var o=a.getUint32(n,!0);if(n+=4,o===k.JSON){var s=new Uint8Array(t,x+n,r);this.content=e.LoaderUtils.decodeText(s)}else if(o===k.BIN){var h=x+n;this.body=t.slice(h,h+r)}n+=r}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}(t)}catch(e){return void(n&&n(e))}r=o[v.KHR_BINARY_GLTF].content}else r=e.LoaderUtils.decodeText(new Uint8Array(t));var s=JSON.parse(r);if(void 0===s.asset||s.asset.version[0]<2)n&&n(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported. Use LegacyGLTFLoader instead."));else{if(s.extensionsUsed)for(var h=0;h<s.extensionsUsed.length;++h){var l=s.extensionsUsed[h],c=s.extensionsRequired||[];switch(l){case v.KHR_LIGHTS_PUNCTUAL:o[l]=new b(s);break;case v.KHR_MATERIALS_UNLIT:o[l]=new y(s);break;case v.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:o[l]=new T(s);break;case v.KHR_DRACO_MESH_COMPRESSION:o[l]=new S(s,this.dracoLoader);break;case v.MSFT_TEXTURE_DDS:o[v.MSFT_TEXTURE_DDS]=new w;break;case v.KHR_TEXTURE_TRANSFORM:o[v.KHR_TEXTURE_TRANSFORM]=new M(s);break;default:c.indexOf(l)>=0&&console.warn('THREE.GLTFLoader: Unknown extension "'+l+'".')}}var d=new ee(s,o,{path:i||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager});d.parse(function(e,t,i,n,r){var s={scene:e,scenes:t,cameras:i,animations:n,asset:r.asset,parser:d,userData:{}};Z(o,s,r),a(s)},n)}}}]),t}();t.a=g;var m=function(){function e(){f()(this,e),this.objects={}}return p()(e,[{key:"get",value:function(e){return this.objects[e]}},{key:"add",value:function(e,t){this.objects[e]=t}},{key:"remove",value:function(e){delete this.objects[e]}},{key:"removeAll",value:function(){this.objects={}}}]),e}(),v={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function w(){if(!e.DDSLoader)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing THREE.DDSLoader");this.name=v.MSFT_TEXTURE_DDS,this.ddsLoader=new e.DDSLoader}function b(e){this.name=v.KHR_LIGHTS_PUNCTUAL;var t=e.extensions&&e.extensions[v.KHR_LIGHTS_PUNCTUAL]||{};this.lightDefs=t.lights||[]}function y(e){this.name=v.KHR_MATERIALS_UNLIT}b.prototype.loadLight=function(t){var i,a=this.lightDefs[t],n=new e.Color(16777215);void 0!==a.color&&n.fromArray(a.color);var r=void 0!==a.range?a.range:0;switch(a.type){case"directional":(i=new e.DirectionalLight(n)).target.position.set(0,0,-1),i.add(i.target);break;case"point":(i=new e.PointLight(n)).distance=r;break;case"spot":(i=new e.SpotLight(n)).distance=r,a.spot=a.spot||{},a.spot.innerConeAngle=void 0!==a.spot.innerConeAngle?a.spot.innerConeAngle:0,a.spot.outerConeAngle=void 0!==a.spot.outerConeAngle?a.spot.outerConeAngle:Math.PI/4,i.angle=a.spot.outerConeAngle,i.penumbra=1-a.spot.innerConeAngle/a.spot.outerConeAngle,i.target.position.set(0,0,-1),i.add(i.target);break;default:throw new Error('THREE.GLTFLoader: Unexpected light type, "'+a.type+'".')}return i.position.set(0,0,0),i.decay=2,void 0!==a.intensity&&(i.intensity=a.intensity),i.name=a.name||"light_"+t,c.a.resolve(i)},y.prototype.getMaterialType=function(t){return e.MeshBasicMaterial},y.prototype.extendParams=function(t,i,a){var n=[];t.color=new e.Color(1,1,1),t.opacity=1;var r=i.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){var o=r.baseColorFactor;t.color.fromArray(o),t.opacity=o[3]}void 0!==r.baseColorTexture&&n.push(a.assignTexture(t,"map",r.baseColorTexture))}return c.a.all(n)};var _="glTF",x=12,k={JSON:1313821514,BIN:5130562};function S(t,i){if(!i)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=v.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=i,e.DRACOLoader.getDecoderModule()}function M(e){this.name=v.KHR_TEXTURE_TRANSFORM}function T(){return{name:v.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return e.ShaderMaterial},extendParams:function(t,i,a){var n=i.extensions[this.name],r=e.ShaderLib.standard,o=e.UniformsUtils.clone(r.uniforms),s=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),h=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),l=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),d=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),f=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","material.specularRoughness = clamp( 1.0 - glossinessFactor, 0.04, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n"),u=r.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",s).replace("#include <metalnessmap_pars_fragment>",h).replace("#include <roughnessmap_fragment>",l).replace("#include <metalnessmap_fragment>",d).replace("#include <lights_physical_fragment>",f);delete o.roughness,delete o.metalness,delete o.roughnessMap,delete o.metalnessMap,o.specular={value:(new e.Color).setHex(1118481)},o.glossiness={value:.5},o.specularMap={value:null},o.glossinessMap={value:null},t.vertexShader=r.vertexShader,t.fragmentShader=u,t.uniforms=o,t.defines={STANDARD:""},t.color=new e.Color(1,1,1),t.opacity=1;var p=[];if(Array.isArray(n.diffuseFactor)){var g=n.diffuseFactor;t.color.fromArray(g),t.opacity=g[3]}if(void 0!==n.diffuseTexture&&p.push(a.assignTexture(t,"map",n.diffuseTexture)),t.emissive=new e.Color(0,0,0),t.glossiness=void 0!==n.glossinessFactor?n.glossinessFactor:1,t.specular=new e.Color(1,1,1),Array.isArray(n.specularFactor)&&t.specular.fromArray(n.specularFactor),void 0!==n.specularGlossinessTexture){var m=n.specularGlossinessTexture;p.push(a.assignTexture(t,"glossinessMap",m)),p.push(a.assignTexture(t,"specularMap",m))}return c.a.all(p)},createMaterial:function(t){var i=new e.ShaderMaterial({defines:t.defines,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:t.uniforms,fog:!0,lights:!0,opacity:t.opacity,transparent:t.transparent});return i.isGLTFSpecularGlossinessMaterial=!0,i.color=t.color,i.map=void 0===t.map?null:t.map,i.lightMap=null,i.lightMapIntensity=1,i.aoMap=void 0===t.aoMap?null:t.aoMap,i.aoMapIntensity=1,i.emissive=t.emissive,i.emissiveIntensity=1,i.emissiveMap=void 0===t.emissiveMap?null:t.emissiveMap,i.bumpMap=void 0===t.bumpMap?null:t.bumpMap,i.bumpScale=1,i.normalMap=void 0===t.normalMap?null:t.normalMap,t.normalScale&&(i.normalScale=t.normalScale),i.displacementMap=null,i.displacementScale=1,i.displacementBias=0,i.specularMap=void 0===t.specularMap?null:t.specularMap,i.specular=t.specular,i.glossinessMap=void 0===t.glossinessMap?null:t.glossinessMap,i.glossiness=t.glossiness,i.alphaMap=null,i.envMap=void 0===t.envMap?null:t.envMap,i.envMapIntensity=1,i.refractionRatio=.98,i.extensions.derivatives=!0,i},cloneMaterial:function(e){var t=e.clone();t.isGLTFSpecularGlossinessMaterial=!0;for(var i=this.specularGlossinessParams,a=0,n=i.length;a<n;a++)t[i[a]]=e[i[a]];return t},refreshUniforms:function(e,t,i,a,n,r){if(!0===n.isGLTFSpecularGlossinessMaterial){var o,s=n.uniforms,h=n.defines;s.opacity.value=n.opacity,s.diffuse.value.copy(n.color),s.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),s.map.value=n.map,s.specularMap.value=n.specularMap,s.alphaMap.value=n.alphaMap,s.lightMap.value=n.lightMap,s.lightMapIntensity.value=n.lightMapIntensity,s.aoMap.value=n.aoMap,s.aoMapIntensity.value=n.aoMapIntensity,n.map?o=n.map:n.specularMap?o=n.specularMap:n.displacementMap?o=n.displacementMap:n.normalMap?o=n.normalMap:n.bumpMap?o=n.bumpMap:n.glossinessMap?o=n.glossinessMap:n.alphaMap?o=n.alphaMap:n.emissiveMap&&(o=n.emissiveMap),void 0!==o&&(o.isWebGLRenderTarget&&(o=o.texture),!0===o.matrixAutoUpdate&&o.updateMatrix(),s.uvTransform.value.copy(o.matrix)),n.envMap&&(s.envMap.value=n.envMap,s.envMapIntensity.value=n.envMapIntensity,s.flipEnvMap.value=n.envMap.isCubeTexture?-1:1,s.reflectivity.value=n.reflectivity,s.refractionRatio.value=n.refractionRatio,s.maxMipLevel.value=e.properties.get(n.envMap).__maxMipLevel),s.specular.value.copy(n.specular),s.glossiness.value=n.glossiness,s.glossinessMap.value=n.glossinessMap,s.emissiveMap.value=n.emissiveMap,s.bumpMap.value=n.bumpMap,s.normalMap.value=n.normalMap,s.displacementMap.value=n.displacementMap,s.displacementScale.value=n.displacementScale,s.displacementBias.value=n.displacementBias,null!==s.glossinessMap.value&&void 0===h.USE_GLOSSINESSMAP&&(h.USE_GLOSSINESSMAP="",h.USE_ROUGHNESSMAP=""),null===s.glossinessMap.value&&void 0!==h.USE_GLOSSINESSMAP&&(delete h.USE_GLOSSINESSMAP,delete h.USE_ROUGHNESSMAP)}}}}function A(t,i,a,n){e.Interpolant.call(this,t,i,a,n)}S.prototype.decodePrimitive=function(e,t){var i=this.json,a=this.dracoLoader,n=e.extensions[this.name].bufferView,r=e.extensions[this.name].attributes,o={},s={},h={};for(var l in r)l in G&&(o[G[l]]=r[l]);for(l in e.attributes)if(void 0!==G[l]&&void 0!==r[l]){var d=i.accessors[e.attributes[l]],f=I[d.componentType];h[G[l]]=f,s[G[l]]=!0===d.normalized}return t.getDependency("bufferView",n).then(function(e){return new c.a(function(t){a.decodeDracoFile(e,function(e){for(var i in e.attributes){var a=e.attributes[i],n=s[i];void 0!==n&&(a.normalized=n)}t(e)},o,h)})})},M.prototype.extendTexture=function(e,t){return e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.needsUpdate=!0,e},A.prototype=h()(e.Interpolant.prototype),A.prototype.constructor=A,A.prototype.copySampleValue_=function(e){for(var t=this.resultBuffer,i=this.sampleValues,a=this.valueSize,n=e*a*3+a,r=0;r!==a;r++)t[r]=i[n+r];return t},A.prototype.beforeStart_=A.prototype.copySampleValue_,A.prototype.afterEnd_=A.prototype.copySampleValue_,A.prototype.interpolate_=function(e,t,i,a){for(var n=this.resultBuffer,r=this.sampleValues,o=this.valueSize,s=2*o,h=3*o,l=a-t,c=(i-t)/l,d=c*c,f=d*c,u=e*h,p=u-h,g=-2*f+3*d,m=f-d,v=1-g,w=m-d+c,b=0;b!==o;b++){var y=r[p+b+o],_=r[p+b+s]*l,x=r[u+b+o],k=r[u+b]*l;n[b]=v*y+w*_+g*x+m*k}return n};var E=0,R=1,L=2,D=3,F=4,C=5,j=6,I=(Number,e.Matrix3,e.Matrix4,e.Vector2,e.Vector3,e.Vector4,e.Texture,{5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array}),P={9728:e.NearestFilter,9729:e.LinearFilter,9984:e.NearestMipMapNearestFilter,9985:e.LinearMipMapNearestFilter,9986:e.NearestMipMapLinearFilter,9987:e.LinearMipMapLinearFilter},O={33071:e.ClampToEdgeWrapping,33648:e.MirroredRepeatWrapping,10497:e.RepeatWrapping},B=(e.BackSide,e.FrontSide,e.NeverDepth,e.LessDepth,e.EqualDepth,e.LessEqualDepth,e.GreaterEqualDepth,e.NotEqualDepth,e.GreaterEqualDepth,e.AlwaysDepth,e.AddEquation,e.SubtractEquation,e.ReverseSubtractEquation,e.ZeroFactor,e.OneFactor,e.SrcColorFactor,e.OneMinusSrcColorFactor,e.SrcAlphaFactor,e.OneMinusSrcAlphaFactor,e.DstAlphaFactor,e.OneMinusDstAlphaFactor,e.DstColorFactor,e.OneMinusDstColorFactor,e.SrcAlphaSaturateFactor,{SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16}),G={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},U={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},H={CUBICSPLINE:e.InterpolateSmooth,LINEAR:e.InterpolateLinear,STEP:e.InterpolateDiscrete},N="OPAQUE",z="MASK",V="BLEND",K={"image/png":e.RGBAFormat,"image/jpeg":e.RGBFormat};function X(e,t){return"string"!=typeof e||""===e?"":/^(https?:)?\/\//i.test(e)?e:/^data:.*,.*$/i.test(e)?e:/^blob:.*$/i.test(e)?e:t+e}function Z(e,t,i){for(var a in i.extensions)void 0===e[a]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[a]=i.extensions[a])}function W(e,t){void 0!==t.extras&&("object"===o()(t.extras)?e.userData=t.extras:console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function Y(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var i=0,a=t.weights.length;i<a;i++)e.morphTargetInfluences[i]=t.weights[i];if(t.extras&&Array.isArray(t.extras.targetNames)){var n=t.extras.targetNames;if(e.morphTargetInfluences.length===n.length){e.morphTargetDictionary={};for(i=0,a=n.length;i<a;i++)e.morphTargetDictionary[n[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function q(e,t){if(n()(e).length!==n()(t).length)return!1;for(var i in e)if(e[i]!==t[i])return!1;return!0}function Q(e){var t=e.extensions&&e.extensions[v.KHR_DRACO_MESH_COMPRESSION];return t?"draco:"+t.bufferView+":"+t.indices+":"+J(t.attributes):e.indices+":"+J(e.attributes)+":"+e.mode}function J(e){for(var t="",i=n()(e).sort(),a=0,r=i.length;a<r;a++)t+=i[a]+":"+e[i[a]]+";";return t}function $(t){if(t.isInterleavedBufferAttribute){for(var i=t.count,a=t.itemSize,n=t.array.slice(0,i*a),r=0,o=0;r<i;++r)n[o++]=t.getX(r),a>=2&&(n[o++]=t.getY(r)),a>=3&&(n[o++]=t.getZ(r)),a>=4&&(n[o++]=t.getW(r));return new e.BufferAttribute(n,a,t.normalized)}return t.clone()}function ee(t,i,a){this.json=t||{},this.extensions=i||{},this.options=a||{},this.cache=new m,this.primitiveCache={},this.multiplePrimitivesCache={},this.multiPassGeometryCache={},this.textureLoader=new e.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new e.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer")}function te(e,t,i){var a=t.attributes,n=[];function r(t,a){return i.getDependency("accessor",t).then(function(t){e.addAttribute(a,t)})}for(var o in a){var s=G[o];s&&(s in e.attributes||n.push(r(a[o],s)))}if(void 0!==t.indices&&!e.index){var h=i.getDependency("accessor",t.indices).then(function(t){e.setIndex(t)});n.push(h)}return W(e,t),c.a.all(n).then(function(){return void 0!==t.targets?function(e,t,i){for(var a=!1,n=!1,r=0,o=t.length;r<o&&(void 0!==(l=t[r]).POSITION&&(a=!0),void 0!==l.NORMAL&&(n=!0),!a||!n);r++);if(!a&&!n)return c.a.resolve(e);var s=[],h=[];for(r=0,o=t.length;r<o;r++){var l=t[r];if(a){var d=void 0!==l.POSITION?i.getDependency("accessor",l.POSITION).then(function(e){return $(e)}):e.attributes.position;s.push(d)}n&&(d=void 0!==l.NORMAL?i.getDependency("accessor",l.NORMAL).then(function(e){return $(e)}):e.attributes.normal,h.push(d))}return c.a.all([c.a.all(s),c.a.all(h)]).then(function(i){for(var r=i[0],o=i[1],s=0,h=t.length;s<h;s++){var l=t[s],c="morphTarget"+s;if(a&&void 0!==l.POSITION){var d=r[s];d.name=c;for(var f=e.attributes.position,u=0,p=d.count;u<p;u++)d.setXYZ(u,d.getX(u)+f.getX(u),d.getY(u)+f.getY(u),d.getZ(u)+f.getZ(u))}if(n&&void 0!==l.NORMAL){var g=o[s];g.name=c;var m=e.attributes.normal;for(u=0,p=g.count;u<p;u++)g.setXYZ(u,g.getX(u)+m.getX(u),g.getY(u)+m.getY(u),g.getZ(u)+m.getZ(u))}}return a&&(e.morphAttributes.position=r),n&&(e.morphAttributes.normal=o),e})}(e,t.targets,i):e})}ee.prototype.parse=function(e,t){var i=this.json;this.cache.removeAll(),this.markDefs(),this.getMultiDependencies(["scene","animation","camera"]).then(function(t){var a=t.scenes||[],n=a[i.scene||0],r=t.animations||[],o=t.cameras||[];e(n,a,o,r,i)}).catch(t)},ee.prototype.markDefs=function(){for(var e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[],a={},n={},r=0,o=t.length;r<o;r++)for(var s=t[r].joints,h=0,l=s.length;h<l;h++)e[s[h]].isBone=!0;for(var c=0,d=e.length;c<d;c++){var f=e[c];void 0!==f.mesh&&(void 0===a[f.mesh]&&(a[f.mesh]=n[f.mesh]=0),a[f.mesh]++,void 0!==f.skin&&(i[f.mesh].isSkinnedMesh=!0))}this.json.meshReferences=a,this.json.meshUses=n},ee.prototype.getDependency=function(e,t){var i=e+":"+t,a=this.cache.get(i);if(!a){switch(e){case"scene":a=this.loadScene(t);break;case"node":a=this.loadNode(t);break;case"mesh":a=this.loadMesh(t);break;case"accessor":a=this.loadAccessor(t);break;case"bufferView":a=this.loadBufferView(t);break;case"buffer":a=this.loadBuffer(t);break;case"material":a=this.loadMaterial(t);break;case"texture":a=this.loadTexture(t);break;case"skin":a=this.loadSkin(t);break;case"animation":a=this.loadAnimation(t);break;case"camera":a=this.loadCamera(t);break;case"light":a=this.extensions[v.KHR_LIGHTS_PUNCTUAL].loadLight(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(i,a)}return a},ee.prototype.getDependencies=function(e){var t=this.cache.get(e);if(!t){var i=this,a=this.json[e+("mesh"===e?"es":"s")]||[];t=c.a.all(a.map(function(t,a){return i.getDependency(e,a)})),this.cache.add(e,t)}return t},ee.prototype.getMultiDependencies=function(e){for(var t={},i=[],a=0,n=e.length;a<n;a++){var r=e[a],o=this.getDependencies(r);o=o.then(function(e,i){t[e]=i}.bind(this,r+("mesh"===r?"es":"s"))),i.push(o)}return c.a.all(i).then(function(){return t})},ee.prototype.loadBuffer=function(e){var t=this.json.buffers[e],i=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return c.a.resolve(this.extensions[v.KHR_BINARY_GLTF].body);var a=this.options;return new c.a(function(e,n){i.load(X(t.uri,a.path),e,void 0,function(){n(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})},ee.prototype.loadBufferView=function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(e){var i=t.byteLength||0,a=t.byteOffset||0;return e.slice(a,a+i)})},ee.prototype.loadAccessor=function(t){var i=this,a=this.json,n=this.json.accessors[t];if(void 0===n.bufferView&&void 0===n.sparse)return c.a.resolve(null);var r=[];return void 0!==n.bufferView?r.push(this.getDependency("bufferView",n.bufferView)):r.push(null),void 0!==n.sparse&&(r.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",n.sparse.values.bufferView))),c.a.all(r).then(function(t){var r,o,s=t[0],h=B[n.type],l=I[n.componentType],c=l.BYTES_PER_ELEMENT,d=c*h,f=n.byteOffset||0,u=void 0!==n.bufferView?a.bufferViews[n.bufferView].byteStride:void 0,p=!0===n.normalized;if(u&&u!==d){var g="InterleavedBuffer:"+n.bufferView+":"+n.componentType,m=i.cache.get(g);m||(r=new l(s),m=new e.InterleavedBuffer(r,u/c),i.cache.add(g,m)),o=new e.InterleavedBufferAttribute(m,h,f/c,p)}else r=null===s?new l(n.count*h):new l(s,f,n.count*h),o=new e.BufferAttribute(r,h,p);if(void 0!==n.sparse){var v=B.SCALAR,w=I[n.sparse.indices.componentType],b=n.sparse.indices.byteOffset||0,y=n.sparse.values.byteOffset||0,_=new w(t[1],b,n.sparse.count*v),x=new l(t[2],y,n.sparse.count*h);null!==s&&o.setArray(o.array.slice());for(var k=0,S=_.length;k<S;k++){var M=_[k];if(o.setX(M,x[k*h]),h>=2&&o.setY(M,x[k*h+1]),h>=3&&o.setZ(M,x[k*h+2]),h>=4&&o.setW(M,x[k*h+3]),h>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return o})},ee.prototype.loadTexture=function(t){var i,a=this,n=this.json,r=this.options,o=this.textureLoader,s=window.URL||window.webkitURL,h=n.textures[t],l=h.extensions||{},d=(i=l[v.MSFT_TEXTURE_DDS]?n.images[l[v.MSFT_TEXTURE_DDS].source]:n.images[h.source]).uri,f=!1;return void 0!==i.bufferView&&(d=a.getDependency("bufferView",i.bufferView).then(function(e){f=!0;var t=new Blob([e],{type:i.mimeType});return d=s.createObjectURL(t)})),c.a.resolve(d).then(function(t){var i=e.Loader.Handlers.get(t);return i||(i=l[v.MSFT_TEXTURE_DDS]?a.extensions[v.MSFT_TEXTURE_DDS].ddsLoader:o),new c.a(function(e,a){i.load(X(t,r.path),e,void 0,a)})}).then(function(t){!0===f&&s.revokeObjectURL(d),t.flipY=!1,void 0!==h.name&&(t.name=h.name),i.mimeType in K&&(t.format=K[i.mimeType]);var a=(n.samplers||{})[h.sampler]||{};return t.magFilter=P[a.magFilter]||e.LinearFilter,t.minFilter=P[a.minFilter]||e.LinearMipMapLinearFilter,t.wrapS=O[a.wrapS]||e.RepeatWrapping,t.wrapT=O[a.wrapT]||e.RepeatWrapping,t})},ee.prototype.assignTexture=function(t,i,a){var n=this;return this.getDependency("texture",a.index).then(function(r){switch(i){case"aoMap":case"emissiveMap":case"metalnessMap":case"normalMap":case"roughnessMap":r.format=e.RGBFormat}if(n.extensions[v.KHR_TEXTURE_TRANSFORM]){var o=void 0!==a.extensions?a.extensions[v.KHR_TEXTURE_TRANSFORM]:void 0;o&&(r=n.extensions[v.KHR_TEXTURE_TRANSFORM].extendTexture(r,o))}t[i]=r})},ee.prototype.loadMaterial=function(t){var i,a=this.json,n=this.extensions,r=a.materials[t],o={},s=r.extensions||{},h=[];if(s[v.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var l=n[v.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];i=l.getMaterialType(r),h.push(l.extendParams(o,r,this))}else if(s[v.KHR_MATERIALS_UNLIT]){var d=n[v.KHR_MATERIALS_UNLIT];i=d.getMaterialType(r),h.push(d.extendParams(o,r,this))}else{i=e.MeshStandardMaterial;var f=r.pbrMetallicRoughness||{};if(o.color=new e.Color(1,1,1),o.opacity=1,Array.isArray(f.baseColorFactor)){var u=f.baseColorFactor;o.color.fromArray(u),o.opacity=u[3]}void 0!==f.baseColorTexture&&h.push(this.assignTexture(o,"map",f.baseColorTexture)),o.metalness=void 0!==f.metallicFactor?f.metallicFactor:1,o.roughness=void 0!==f.roughnessFactor?f.roughnessFactor:1,void 0!==f.metallicRoughnessTexture&&(h.push(this.assignTexture(o,"metalnessMap",f.metallicRoughnessTexture)),h.push(this.assignTexture(o,"roughnessMap",f.metallicRoughnessTexture)))}!0===r.doubleSided&&(o.side=e.DoubleSide);var p=r.alphaMode||N;return p===V?o.transparent=!0:(o.transparent=!1,p===z&&(o.alphaTest=void 0!==r.alphaCutoff?r.alphaCutoff:.5)),void 0!==r.normalTexture&&i!==e.MeshBasicMaterial&&(h.push(this.assignTexture(o,"normalMap",r.normalTexture)),o.normalScale=new e.Vector2(1,1),void 0!==r.normalTexture.scale&&o.normalScale.set(r.normalTexture.scale,r.normalTexture.scale)),void 0!==r.occlusionTexture&&i!==e.MeshBasicMaterial&&(h.push(this.assignTexture(o,"aoMap",r.occlusionTexture)),void 0!==r.occlusionTexture.strength&&(o.aoMapIntensity=r.occlusionTexture.strength)),void 0!==r.emissiveFactor&&i!==e.MeshBasicMaterial&&(o.emissive=(new e.Color).fromArray(r.emissiveFactor)),void 0!==r.emissiveTexture&&i!==e.MeshBasicMaterial&&h.push(this.assignTexture(o,"emissiveMap",r.emissiveTexture)),c.a.all(h).then(function(){var t;return t=i===e.ShaderMaterial?n[v.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(o):new i(o),void 0!==r.name&&(t.name=r.name),t.map&&(t.map.encoding=e.sRGBEncoding),t.emissiveMap&&(t.emissiveMap.encoding=e.sRGBEncoding),t.specularMap&&(t.specularMap.encoding=e.sRGBEncoding),W(t,r),r.extensions&&Z(n,t,r),t})},ee.prototype.loadGeometries=function(t){var i,a=this,n=this.extensions,r=this.primitiveCache,o=function(e){if(e.length<2)return!1;var t=e[0],i=t.targets||[];if(void 0===t.indices)return!1;for(var a=1,n=e.length;a<n;a++){var r=e[a];if(t.mode!==r.mode)return!1;if(void 0===r.indices)return!1;if(r.extensions&&r.extensions[v.KHR_DRACO_MESH_COMPRESSION])return!1;if(!q(t.attributes,r.attributes))return!1;var o=r.targets||[];if(i.length!==o.length)return!1;for(var s=0,h=i.length;s<h;s++)if(!q(i[s],o[s]))return!1}return!0}(t);function s(e){return n[v.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,a).then(function(t){return te(t,e,a)})}o&&(i=t,t=[t[0]]);for(var h=[],l=0,d=t.length;l<d;l++){var f,u=t[l],p=Q(u),g=r[p];if(g)h.push(g.promise);else f=u.extensions&&u.extensions[v.KHR_DRACO_MESH_COMPRESSION]?s(u):te(new e.BufferGeometry,u,a),r[p]={primitive:u,promise:f},h.push(f)}return c.a.all(h).then(function(n){if(o){var r=n[0],s=a.multiPassGeometryCache,h=function(e,t){for(var i=e.uuid,a=0,n=t.length;a<n;a++)i+=a+Q(t[a]);return i}(r,i);if(null!==(g=s[h]))return[g.geometry];var l=new e.BufferGeometry;for(var d in l.name=r.name,l.userData=r.userData,r.attributes)l.addAttribute(d,r.attributes[d]);for(var d in r.morphAttributes)l.morphAttributes[d]=r.morphAttributes[d];for(var f=[],u=0,p=i.length;u<p;u++)f.push(a.getDependency("accessor",i[u].indices));return c.a.all(f).then(function(e){for(var t=[],a=0,n=0,o=i.length;n<o;n++){for(var c=e[n],d=0,f=c.count;d<f;d++)t.push(c.array[d]);l.addGroup(a,c.count,n),a+=c.count}return l.setIndex(t),s[h]={geometry:l,baseGeometry:r,primitives:i},[l]})}if(n.length>1&&void 0!==e.BufferGeometryUtils){for(u=1,p=t.length;u<p;u++)if(t[0].mode!==t[u].mode)return n;var g;s=a.multiplePrimitivesCache,h=function(e){for(var t="",i=0,a=e.length;i<a;i++)t+=":"+e[i].uuid;return t}(n);if(g=s[h]){if(null!==g.geometry)return[g.geometry]}else{l=e.BufferGeometryUtils.mergeBufferGeometries(n,!0);if(s[h]={geometry:l,baseGeometries:n},null!==l)return[l]}}return n})},ee.prototype.loadMesh=function(t){for(var i=this,a=this.json,r=this.extensions,o=a.meshes[t],s=o.primitives,h=[],l=0,d=s.length;l<d;l++){var f=void 0===s[l].material?new e.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:e.FrontSide}):this.getDependency("material",s[l].material);h.push(f)}return c.a.all(h).then(function(a){return i.loadGeometries(s).then(function(h){for(var l=1===h.length&&h[0].groups.length>0,c=[],d=0,f=h.length;d<f;d++){var u,p=h[d],g=s[d],m=l?a:a[d];if(g.mode===F||g.mode===C||g.mode===j||void 0===g.mode)!0===(u=!0===o.isSkinnedMesh?new e.SkinnedMesh(p,m):new e.Mesh(p,m)).isSkinnedMesh&&u.normalizeSkinWeights(),g.mode===C?u.drawMode=e.TriangleStripDrawMode:g.mode===j&&(u.drawMode=e.TriangleFanDrawMode);else if(g.mode===R)u=new e.LineSegments(p,m);else if(g.mode===D)u=new e.Line(p,m);else if(g.mode===L)u=new e.LineLoop(p,m);else{if(g.mode!==E)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+g.mode);u=new e.Points(p,m)}n()(u.geometry.morphAttributes).length>0&&Y(u,o),u.name=o.name||"mesh_"+t,h.length>1&&(u.name+="_"+d),W(u,o),c.push(u);for(var w=l?u.material:[u.material],b=void 0!==p.attributes.tangent,y=void 0!==p.attributes.color,_=void 0===p.attributes.normal,x=!0===u.isSkinnedMesh,k=n()(p.morphAttributes).length>0,S=k&&void 0!==p.morphAttributes.normal,M=0,T=w.length;M<T;M++){m=w[M];if(u.isPoints){var A="PointsMaterial:"+m.uuid,I=i.cache.get(A);I||(I=new e.PointsMaterial,e.Material.prototype.copy.call(I,m),I.color.copy(m.color),I.map=m.map,I.lights=!1,i.cache.add(A,I)),m=I}else if(u.isLine){A="LineBasicMaterial:"+m.uuid;var P=i.cache.get(A);P||(P=new e.LineBasicMaterial,e.Material.prototype.copy.call(P,m),P.color.copy(m.color),P.lights=!1,i.cache.add(A,P)),m=P}if(b||y||_||x||k){A="ClonedMaterial:"+m.uuid+":";m.isGLTFSpecularGlossinessMaterial&&(A+="specular-glossiness:"),x&&(A+="skinning:"),b&&(A+="vertex-tangents:"),y&&(A+="vertex-colors:"),_&&(A+="flat-shading:"),k&&(A+="morph-targets:"),S&&(A+="morph-normals:");var O=i.cache.get(A);O||(O=m.isGLTFSpecularGlossinessMaterial?r[v.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].cloneMaterial(m):m.clone(),x&&(O.skinning=!0),b&&(O.vertexTangents=!0),y&&(O.vertexColors=e.VertexColors),_&&(O.flatShading=!0),k&&(O.morphTargets=!0),S&&(O.morphNormals=!0),i.cache.add(A,O)),m=O}w[M]=m,m.aoMap&&void 0===p.attributes.uv2&&void 0!==p.attributes.uv&&(console.log("THREE.GLTFLoader: Duplicating UVs to support aoMap."),p.addAttribute("uv2",new e.BufferAttribute(p.attributes.uv.array,2))),m.isGLTFSpecularGlossinessMaterial&&(u.onBeforeRender=r[v.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].refreshUniforms)}u.material=l?w:w[0]}if(1===c.length)return c[0];var B=new e.Group;for(d=0,f=c.length;d<f;d++)B.add(c[d]);return B})})},ee.prototype.loadCamera=function(t){var i,a=this.json.cameras[t],n=a[a.type];if(n)return"perspective"===a.type?i=new e.PerspectiveCamera(e.Math.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):"orthographic"===a.type&&(i=new e.OrthographicCamera(n.xmag/-2,n.xmag/2,n.ymag/2,n.ymag/-2,n.znear,n.zfar)),void 0!==a.name&&(i.name=a.name),W(i,a),c.a.resolve(i);console.warn("THREE.GLTFLoader: Missing camera parameters.")},ee.prototype.loadSkin=function(e){var t=this.json.skins[e],i={joints:t.joints};return void 0===t.inverseBindMatrices?c.a.resolve(i):this.getDependency("accessor",t.inverseBindMatrices).then(function(e){return i.inverseBindMatrices=e,i})},ee.prototype.loadAnimation=function(t){for(var i=this.json.animations[t],a=[],n=[],r=[],o=[],s=[],h=0,l=i.channels.length;h<l;h++){var d=i.channels[h],f=i.samplers[d.sampler],u=d.target,p=void 0!==u.node?u.node:u.id,g=void 0!==i.parameters?i.parameters[f.input]:f.input,m=void 0!==i.parameters?i.parameters[f.output]:f.output;a.push(this.getDependency("node",p)),n.push(this.getDependency("accessor",g)),r.push(this.getDependency("accessor",m)),o.push(f),s.push(u)}return c.a.all([c.a.all(a),c.a.all(n),c.a.all(r),c.a.all(o),c.a.all(s)]).then(function(a){for(var n=a[0],r=a[1],o=a[2],s=a[3],h=a[4],l=[],c=0,d=n.length;c<d;c++){var f=n[c],u=r[c],p=o[c],g=s[c],m=h[c];if(void 0!==f){var v;switch(f.updateMatrix(),f.matrixAutoUpdate=!0,U[m.path]){case U.weights:v=e.NumberKeyframeTrack;break;case U.rotation:v=e.QuaternionKeyframeTrack;break;case U.position:case U.scale:default:v=e.VectorKeyframeTrack}var w=f.name?f.name:f.uuid,b=void 0!==g.interpolation?H[g.interpolation]:e.InterpolateLinear,y=[];U[m.path]===U.weights?f.traverse(function(e){!0===e.isMesh&&e.morphTargetInfluences&&y.push(e.name?e.name:e.uuid)}):y.push(w);for(var _=0,x=y.length;_<x;_++){var k=new v(y[_]+"."+U[m.path],e.AnimationUtils.arraySlice(u.array,0),e.AnimationUtils.arraySlice(p.array,0),b);"CUBICSPLINE"===g.interpolation&&(k.createInterpolant=function(e){return new A(this.times,this.values,this.getValueSize()/3,e)},k.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),l.push(k)}}}var S=void 0!==i.name?i.name:"animation_"+t;return new e.AnimationClip(S,void 0,l)})},ee.prototype.loadNode=function(t){var i=this.json,a=this.extensions,n=this,r=i.meshReferences,o=i.meshUses,s=i.nodes[t];return(!0===s.isBone?c.a.resolve(new e.Bone):void 0!==s.mesh?n.getDependency("mesh",s.mesh).then(function(e){var t;if(r[s.mesh]>1){var i=o[s.mesh]++;(t=e.clone()).name+="_instance_"+i,t.onBeforeRender=e.onBeforeRender;for(var a=0,n=t.children.length;a<n;a++)t.children[a].name+="_instance_"+i,t.children[a].onBeforeRender=e.children[a].onBeforeRender}else t=e;return void 0!==s.weights&&t.traverse(function(e){if(e.isMesh)for(var t=0,i=s.weights.length;t<i;t++)e.morphTargetInfluences[t]=s.weights[t]}),t}):void 0!==s.camera?n.getDependency("camera",s.camera):s.extensions&&s.extensions[v.KHR_LIGHTS_PUNCTUAL]&&void 0!==s.extensions[v.KHR_LIGHTS_PUNCTUAL].light?n.getDependency("light",s.extensions[v.KHR_LIGHTS_PUNCTUAL].light):c.a.resolve(new e.Object3D)).then(function(t){if(void 0!==s.name&&(t.name=e.PropertyBinding.sanitizeNodeName(s.name)),W(t,s),s.extensions&&Z(a,t,s),void 0!==s.matrix){var i=new e.Matrix4;i.fromArray(s.matrix),t.applyMatrix(i)}else void 0!==s.translation&&t.position.fromArray(s.translation),void 0!==s.rotation&&t.quaternion.fromArray(s.rotation),void 0!==s.scale&&t.scale.fromArray(s.scale);return t})},ee.prototype.loadScene=function(){function t(i,a,n,r){var o=n.nodes[i];return r.getDependency("node",i).then(function(t){return void 0===o.skin?t:r.getDependency("skin",o.skin).then(function(e){for(var t=[],a=0,n=(i=e).joints.length;a<n;a++)t.push(r.getDependency("node",i.joints[a]));return c.a.all(t)}).then(function(a){for(var n=!0===t.isGroup?t.children:[t],r=0,o=n.length;r<o;r++){for(var s=n[r],h=[],l=[],c=0,d=a.length;c<d;c++){var f=a[c];if(f){h.push(f);var u=new e.Matrix4;void 0!==i.inverseBindMatrices&&u.fromArray(i.inverseBindMatrices.array,16*c),l.push(u)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',i.joints[c])}s.bind(new e.Skeleton(h,l),s.matrixWorld)}return t});var i}).then(function(e){a.add(e);var i=[];if(o.children)for(var s=o.children,h=0,l=s.length;h<l;h++){var d=s[h];i.push(t(d,e,n,r))}return c.a.all(i)})}var i=this.json,a=this.extensions,n=this.json.scenes[0],r=new e.Scene;void 0!==n.name&&(r.name=n.name),W(r,n),n.extensions&&Z(a,r,n);for(var o=n.nodes||[],s=[],h=0,l=o.length;h<l;h++)s.push(t(o[h],r,i,this));return c.a.all(s).then(function(){return r})}}).call(t,i("Ml+6"))},NHnr:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){var t,a,n,r=i("cbRa"),o=i("c6m3");t=new r.a,a=new o.a,n=document.getElementById("canvas"),a.init(n),t.setGame(a),e("#foreground").click(function(t){var i=e("#canvas").offset(),n={};n.x=t.pageX-i.left,n.y=t.pageY-i.top,a.click(n.x,n.y)}),window.addEventListener("keydown",function(e){a.keyDown(e.keyCode)},!1),t.start("TEST")}.call(t,i("7t+N"))},NxES:function(e,t){e.exports={id:"spectre",width:34,height:34,animations:{atk_right:{length:8,row:0},walk_right:{length:4,row:1},idle_right:{length:2,row:2},atk_up:{length:6,row:3},walk_up:{length:8,row:4},idle_up:{length:8,row:5},atk_down:{length:6,row:6},walk_down:{length:4,row:7},idle_down:{length:2,row:8}},offset_x:-9,offset_y:-13}},Oy9j:function(e,t){e.exports={id:"deathknight",width:42,height:42,animations:{atk_right:{length:5,row:0},walk_right:{length:4,row:1},idle_right:{length:2,row:2},atk_up:{length:5,row:3},walk_up:{length:4,row:4},idle_up:{length:2,row:5},atk_down:{length:5,row:6},walk_down:{length:4,row:7},idle_down:{length:2,row:8}},offset_x:-13,offset_y:-17}},PznX:function(e,t){e.exports={id:"eye",width:40,height:48,animations:{atk_right:{length:6,row:0},walk_right:{length:4,row:1},idle_right:{length:14,row:2},atk_up:{length:4,row:3},walk_up:{length:4,row:4},idle_up:{length:14,row:5},atk_down:{length:8,row:6},walk_down:{length:4,row:7},idle_down:{length:14,row:8}},offset_x:-12,offset_y:-18}},QDfD:function(e,t){e.exports={"1.3.132.0.10":"secp256k1","1.3.132.0.33":"p224","1.2.840.10045.3.1.1":"p192","1.2.840.10045.3.1.7":"p256","1.3.132.0.34":"p384","1.3.132.0.35":"p521"}},Qyla:function(e,t){e.exports={id:"target",width:16,height:16,animations:{move:{length:4,row:0},atk:{length:4,row:1}}}},RVzG:function(e,t){e.exports={id:"redarmor",width:32,height:32,animations:{atk_right:{length:5,row:0},walk_right:{length:4,row:1},idle_right:{length:2,row:2},atk_up:{length:5,row:3},walk_up:{length:4,row:4},idle_up:{length:2,row:5},atk_down:{length:5,row:6},walk_down:{length:4,row:7},idle_down:{length:2,row:8}},offset_x:-8,offset_y:-12}},RZ8U:function(e,t){e.exports={id:"item-redsword",width:16,height:16,animations:{idle:{length:6,row:0}},offset_x:0,offset_y:0}},RgGw:function(e,t){e.exports={id:"item-flask",width:16,height:16,animations:{idle:{length:6,row:0}},offset_x:0,offset_y:0}},"Rr+P":function(e,t,i){"use strict";var a=i("fZjL"),n=i.n(a),r=i("pFYg"),o=i.n(r),s=i("OvRC"),h=i.n(s),l=i("XDXK"),c=function(e,t,i,a,n,r,o){this.parseSheet(r,o),this.scale=void 0!==i?i:1,this.setText(t);a=void 0!==a?a:0,n=void 0!==n?n:0;var s=this.calculateDimensions();l.a.bind(this)(e,a,n,s.width,s.height),this.pivot.x=0,this.pivot.y=0};(c.prototype=h()(l.a.prototype)).setText=function(e){if(this.text!==e){this.text=void 0!==e?e.toString():"",this.characters=this.text.split("");var t=this.calculateDimensions();this.width=t.width,this.height=t.height}},c.prototype.parseSheet=function(e,t){if(void 0===e&&!this.sheet)throw new Error("Sheet image path missing when creating sprite from sheet");if(void 0===t&&!this.sheetData)throw new Error("Sheet data path missing when creating sprite from sheet");if(!e&&this.sheet||(this.sheet=AssetLoader.getAssetById(e)),!t&&this.sheetData||(this.sheetData=AssetLoader.getAssetById(t)),"object"!==o()(this.sheetData))throw new Error("Invalid sheet data "+t+" -- not an object");this.characterData={};for(var i=n()(this.sheetData),a=i.length,r=0;r<a;r++){var s=i[r],h=this.sheetData[s];h.uv0[0]=Math.min(1,Math.max(0,h.uv0[0])),h.uv0[1]=Math.min(1,Math.max(0,h.uv0[1])),h.uv1[0]=Math.min(1,Math.max(0,h.uv1[0])),h.uv1[1]=Math.min(1,Math.max(0,h.uv1[1])),this.characterData[s]={x:Math.round(h.uv0[0]*this.sheet.width),y:Math.round((1-h.uv0[1])*this.sheet.height),width:Math.round((h.uv1[0]-h.uv0[0])*this.sheet.width),height:Math.round((h.uv0[1]-h.uv1[1])*this.sheet.height)};var l=this.characterData[s];l.width=Math.max(1e-5,l.width),l.height=Math.max(1e-5,l.height)}},c.prototype.calculateDimensions=function(){for(var e={width:0,height:0},t=this.characters.length,i=0;i<t;i++){var a=this.characters[i];this.characterData[a]||(a=n()(this.characterData)[0]);var r=this.characterData[a];e.width+=r?r.width:0,e.height=Math.max(e.height,r?r.height:0)}return e.width*=this.scale,e.height*=this.scale,e},c.prototype.draw=function(e,t,i){for(var a=this.characters.length,n=0;n<a;n++){var r=this.characters[n],o=this.drawCharacter(e,r,t,i);t=o.x+o.width,i=o.y}},c.prototype.drawCharacter=function(e,t,i,a){var n=this.characterData[t],r=!1;void 0===n&&(n={width:6,height:6},r=!0);var o=n.width*this.scale,s=n.height*this.scale;return r||e.drawImage(this.sheet,n.x,n.y,n.width,n.height,i,a,o,s),{x:i,y:a,width:o,height:s}},t.a=c},SML3:function(e,t){e.exports={id:"item-goldenarmor",width:16,height:16,animations:{idle:{length:6,row:0}},offset_x:0,offset_y:0}},Sqs0:function(e,t){e.exports={id:"death",width:24,height:24,animations:{death:{length:6,row:0}},offset_x:-4,offset_y:-4}},TAbc:function(e,t,i){"use strict";var a=i("Zrlr"),n=i.n(a),r=i("wxAW"),o=i.n(r),s=function(){function e(){n()(this,e),this.startValue=0,this.endValue=0,this.duration=0,this.inProgress=!1}return o()(e,[{key:"start",value:function(e,t,i,a,n,r){this.startTime=e,this.updateFunction=t,this.stopFunction=i,this.startValue=a,this.endValue=n,this.duration=r,this.inProgress=!0,this.count=0}},{key:"step",value:function(e){if(this.inProgress)if(this.count>0)this.count-=1,log.debug(e+": jumped frame");else{var t=e-this.startTime;t>this.duration&&(t=this.duration);var i=this.endValue-this.startValue,a=this.startValue+i/this.duration*t;a=Math.round(a),t===this.duration||a===this.endValue?(this.stop(),this.stopFunction&&this.stopFunction()):this.updateFunction&&this.updateFunction(a)}}},{key:"restart",value:function(e,t,i){this.start(e,this.updateFunction,this.stopFunction,t,i,this.duration),this.step(e)}},{key:"stop",value:function(){this.inProgress=!1}}]),e}();t.a=s},Tb6K:function(e,t){e.exports={id:"lavanpc",width:24,height:24,animations:{idle_down:{length:2,row:0}},offset_x:-4,offset_y:-8}},UStB:function(e,t){e.exports={id:"goldenarmor",width:32,height:32,animations:{atk_right:{length:5,row:0},walk_right:{length:4,row:1},idle_right:{length:2,row:2},atk_up:{length:5,row:3},walk_up:{length:4,row:4},idle_up:{length:2,row:5},atk_down:{length:5,row:6},walk_down:{length:4,row:7},idle_down:{length:2,row:8}},offset_x:-8,offset_y:-12}},UcV4:function(e,t){e.exports={id:"crab",width:32,height:32,animations:{death:{length:8,row:0},atk_right:{length:7,row:1},walk_right:{length:6,row:2},idle_right:{length:4,row:3},atk_up:{length:8,row:4},idle_up:{length:4,row:5},walk_up:{length:6,row:6},atk_down:{length:8,row:7},walk_down:{length:6,row:8},idle_down:{length:7,row:9}},offset_x:-8,offset_y:-8}},"X+Uv":function(e,t,i){"use strict";(function(e){var a=i("Zrlr"),n=i.n(a),r=i("wxAW"),o=i.n(r),s=i("yh7f"),h=i("DwfQ"),l=i("ZQ2e"),c=i("zTqn"),d=function(){function t(){n()(this,t)}return o()(t,null,[{key:"createEntity",value:function(i,a,n){if(i){if(!e.isFunction(t.builders[i]))throw Error(i+" is not a valid Entity type");return t.builders[i](a,n)}}}]),t}();d.builders=[],d.builders[s.a.Entities.DEATHKNIGHT]=function(e){return new c.a(e,s.a.Entities.DEATHKNIGHT)},d.builders[s.a.Entities.CHEST]=function(e){return new l.a(e)},d.builders[s.a.Entities.FIRE]=function(e){var t=new h.a(e,s.a.Entities.FIRE);return t.attachPointLight(16760992,1),t},t.a=d}).call(t,i("rdLu"))},XDXK:function(e,t,i){"use strict";var a=i("fZjL"),n=i.n(a),r=i("uL5Q"),o=function(e,t,i,a,n){this.ui=e,this.x=void 0!==t?t:0,this.y=void 0!==i?i:0,this.width=void 0!==a?a:0,this.height=void 0!==n?n:0,this.rotation=0,this.alpha=1,this.visible=!0,this.pivot={x:.5,y:.5},this.anchor={x:r.a.left,y:r.a.top},this.smoothing=!0,this.stretch={x:!1,y:!1},this.offset={left:0,top:0,right:0,bottom:0},this.parent=void 0};o.prototype.getBounds=function(){var e=this.determinePositionInCanvas(),t=this.determineDimensionsInCanvas();return{x:e.x,y:e.y,width:t.width,height:t.height}},o.prototype.getParentBounds=function(){if(void 0===this.parent)return{x:0,y:0,width:this.ui.width,height:this.ui.height};if(this.parent instanceof o)return this.parent.getBounds();throw new Error("DisplayObject.parent should always be an instance of DisplayObject")},o.prototype.determinePositionInCanvas=function(){var e={x:"number"==typeof this.x?this.x:0,y:"number"==typeof this.y?this.y:0};return e=this.adjustPositionForAnchor(e.x,e.y),e=this.adjustPositionForPivot(e.x,e.y)},o.prototype.determineDimensionsInCanvas=function(){return{width:"number"==typeof this.width?this.width:0,height:"number"==typeof this.height?this.height:0}},o.prototype.adjustPositionForAnchor=function(e,t){var i=this.getParentBounds();return this.anchor.x===r.a.left?e+=i.x:this.anchor.x===r.a.right?e+=i.x+i.width-this.width:this.anchor.x===r.a.center&&(e+=i.x+i.width/2-this.width/2),this.anchor.y===r.a.top?t+=i.y:this.anchor.y===r.a.bottom?t+=i.y+i.height-this.height:this.anchor.y===r.a.center&&(t+=i.y+i.height/2-this.height/2),{x:e,y:t}},o.prototype.getOffsetInCanvas=function(){for(var e,t={left:this.offset.left,top:this.offset.top,right:this.offset.right,bottom:this.offset.bottom},i=n()(t),a=i.length,r=0;r<a;r++){var o=i[r],s=t[o];if("number"!=typeof s){e=e||this.getParentBounds();var h=parseFloat(s.match(/^([0-9\.]+)%$/)[1]);t[o]=h/100*e.width}}return t},o.prototype.adjustPositionForPivot=function(e,t){return{x:e-=this.width*this.pivot.x,y:t-=this.height*this.pivot.y}},o.prototype.shouldReceiveEvents=function(){return this.visible},o.prototype.onClick=function(e){this.ui.addEventListener("click",e,this)},o.prototype.render=function(e){if(this.visible){e.save();var t=this.getBounds();e.globalAlpha=this.alpha,void 0!==e.mozImageSmoothingEnabled&&(e.mozImageSmoothingEnabled=this.smoothing),void 0!==e.webkitImageSmoothingEnabled&&(e.webkitImageSmoothingEnabled=this.smoothing),void 0!==e.msImageSmoothingEnabled&&(e.msImageSmoothingEnabled=this.smoothing),void 0!==e.imageSmoothingEnabled&&(e.imageSmoothingEnabled=this.smoothing),this.draw(e,t.x,t.y,t.width,t.height),e.restore()}},o.draw=function(e,t,i,a,n){},Object.defineProperty(o.prototype,"_proxied_visible",{get:function(){return!(this.parent&&this.parent!==this&&!this.parent.visible)&&this._visible},set:function(e){return this._visible=e}}),t.a=o},YAyI:function(e,t,i){"use strict";var a=i("Zx67"),n=i.n(a),r=i("Zrlr"),o=i.n(r),s=i("zwoO"),h=i.n(s),l=i("Pf15"),c=i.n(l),d=i("wxAW"),f=i.n(d),u=function(){function e(){o()(this,e)}return f()(e,[{key:"begin",value:function(){this.begin_callback&&this.begin_callback()}},{key:"end",value:function(){this.end_callback&&this.end_callback()}},{key:"click",value:function(e,t){this.click_callback&&this.click_callback(e,t)}},{key:"onBegin",value:function(e){this.begin_callback=e}},{key:"onEnd",value:function(e){this.end_callback=e}},{key:"transitionTo",value:function(e){}},{key:"onClick",value:function(e){this.click_callback=e}},{key:"onUpdate",value:function(e){this.update_callback=e}},{key:"update",value:function(){this.update_callback&&this.update_callback()}}]),e}(),p=(i("VI/i"),function(){function e(t){o()(this,e),this.image=t,this.x=0,this.y=0,this.attackRange=32,this.moveSpeed=1,this.offset={x:0,y:0},this.target=null,this.flipX=!1,this.anims={idle:{animRow:2,animFrameCount:2},walk:{animRow:1,animFrameCount:4},attack:{animRow:0,animFrameCount:5}},this.currentFrame=0,this.currentFrameMax=2,this.currentRow=2,this.state="idle",this.utime=Date.now()+200,this.tilesize=32,this.health=100,this.Maxhealth=100}return f()(e,[{key:"setAnim",value:function(e){this.state!==e&&(this.state=e,this.currentFrame=0,this.currentRow=this.anims[e].animRow,this.currentFrameMax=this.anims[e].animFrameCount)}},{key:"render",value:function(e){e.save(),e.translate(this.x+this.offset.x,this.y+this.offset.y),this.flipX&&(e.translate(this.tilesize,0),e.scale(-1,1)),e.drawImage(this.image,this.currentFrame*this.tilesize,this.currentRow*this.tilesize,this.tilesize,this.tilesize,0,0,this.tilesize,this.tilesize);var t=this.tilesize;e.fillStyle="#000",e.fillRect(-1,-4,t+2,4),e.fillStyle="#F00",e.fillRect(0,-3,t*this.health/this.Maxhealth,2),e.restore()}},{key:"update",value:function(){var e=!1;if(this.utime<=Date.now()&&(this.utime+=200,this.currentFrame=(this.currentFrame+1)%this.currentFrameMax,3==this.currentFrame&&"attack"===this.state&&(e=!0)),this.target){var t=this.target.x-this.x;Math.abs(t)>this.attackRange?(t>0?this.x+=this.moveSpeed:this.x-=this.moveSpeed,this.setAnim("walk")):(this.setAnim("attack"),e&&(this.animFrameCount,this.target.health=Math.max(0,this.target.health-10)))}}}]),e}()),g=(function(e){function t(e){o()(this,t);var i=h()(this,(t.__proto__||n()(t)).call(this)),a=document.getElementById("foreground").getContext("2d"),r=new p(e.sprites.clotharmor.image),s=new p(e.sprites.deathknight.image);return r.x=200,r.y=200,r.offset.y=5,r.target=s,s.x=600,s.y=200,s.tilesize=42,s.target=r,s.flipX=!0,i.onUpdate(function(){r.update(),s.update();a.fillStyle="#ffffff",a.fillRect(147,117,506,206),a.fillStyle="#606060",a.fillRect(150,120,500,200),a.fillStyle="#101010",a.fillRect(150,232,500,87),r.render(a),s.render(a),0===s.health&&(r.target=null,r.setAnim("idle"),a.font="50px Arial",a.fillStyle="white",a.textAlign="center",a.fillText("Victory",400,160))}),i}c()(t,e)}(u),function(e){function t(e,i){o()(this,t);var a=h()(this,(t.__proto__||n()(t)).call(this));return a.game=e,a.kind=i,a.onBegin(function(){"enter"===i&&(e.player.mesh.visible=!1,a.skipFrame=60)}),a.onUpdate(function(){"enter"===i&&(a.skipFrame>0?--a.skipFrame:e.player.mesh.visible?e.player.isFading:(e.player.mesh.visible=!0,e.player.spriteMesh.material.opacity=0,e.player.fadeIn(e.currentTime)))}),a}return c()(t,e),t}(u));t.a=g},ZBgj:function(e,t){e.exports={id:"item-bluesword",width:16,height:16,animations:{idle:{length:6,row:0}},offset_x:0,offset_y:0}},ZQ2e:function(e,t,i){"use strict";var a=i("Zx67"),n=i.n(a),r=i("Zrlr"),o=i.n(r),s=i("zwoO"),h=i.n(s),l=i("Pf15"),c=i.n(l),d=i("yh7f"),f=function(e){function t(e){return o()(this,t),h()(this,(t.__proto__||n()(t)).call(this,e,d.a.Entities.CHEST))}return c()(t,e),t}(i("DwfQ").a);t.a=f},aNYQ:function(e,t){e.exports={id:"forestnpc",width:24,height:24,animations:{idle_down:{length:2,row:0}},offset_x:-4,offset_y:-8}},"b8n+":function(e,t,i){"use strict";var a=i("pFYg"),n=i.n(a),r=i("OvRC"),o=i.n(r),s=i("XDXK"),h=function(e,t,i,a,n,r,o,h){this.setAssetPath(t,o,h);i=void 0!==i?i:0,a=void 0!==a?a:0,n=void 0!==n?n:null,r=void 0!==r?r:null;this.asset?(n=null!==n?n:this.asset.width,r=null!==r?r:this.asset.height):this.sheet&&this.sheetImageData&&(n=null!==n?n:this.sheetImageData.frame.w,r=null!==r?r:this.sheetImageData.frame.h),s.a.bind(this)(e,i,a,n,r)};(h.prototype=o()(s.a.prototype)).draw=function(e,t,i,a,n){this.sheet&&this.sheetImageData?e.drawImage(this.sheet,this.sheetImageData.frame.x,this.sheetImageData.frame.y,this.sheetImageData.frame.w,this.sheetImageData.frame.h,t,i,a,n):e.drawImage(this.asset,t,i,a,n)},h.prototype.setAssetPath=function(e,t,i){this.assetPath=e,void 0!==t||this.sheet?(this.asset=null,this.parseSheet(e,t,i)):(this.asset=AssetLoader.getAssetById(e),this.sheet=null)},h.prototype.parseSheet=function(e,t,i){if(void 0===i&&!this.sheetData)throw new Error("Sheet data path missing when creating sprite from sheet");if(!t&&this.sheet||(this.sheet=AssetLoader.getAssetById(t)),!i&&this.sheetData||(this.sheetData=AssetLoader.getAssetById(i)),"object"!==n()(this.sheetData))throw new Error("Invalid sheet data "+i+" -- not an object");if(!this.sheetData.frames)throw new Error("Invalid sheet data "+i+" -- does not have frames");var a;if(this.sheetData.frames.forEach(function(t){t.filename===e&&(a=t)}),!a)throw new Error('Asset "'+e+'" does not exist in sheet "'+i+'"');this.sheetImageData=a},t.a=h},c6m3:function(e,t,i){"use strict";(function(e,a){var n=i("BO1k"),r=i.n(n),o=i("Zrlr"),s=i.n(o),h=i("wxAW"),l=i.n(h),c=i("1fqz"),d=i("fzpQ"),f=i("ITPp"),u=i("GoZD"),p=i("m3jU"),g=i("X+Uv"),m=i("N9/5"),v=i("wVBE"),w=i.n(v),b=i("ZQ2e"),y=i("YAyI"),_=i("AeT2"),x=i("KGr3"),k=i("8qcI"),S=i("rwlJ"),M=(i.n(S),function(){function t(){s()(this,t)}return l()(t,[{key:"init",value:function(t){var i=t.width,a=t.height;this.canvas=t;var n=new e.WebGLRenderer({canvas:t});n.shadowMap.enabled=!0,n.setPixelRatio(window.devicePixelRatio),n.setSize(i,a),n.autoClear=!1;var r=new e.PerspectiveCamera(20,t.width/t.height,1,1e3);r.position.set(0,150,500);var o=new _.a(t,a);this.renderer=n,this.camera=r,this.ui=o;var s=new e.Scene;this.scene=s,r.lookAt(new e.Vector3(0,0,0)),new w.a(r,n.domElement),this.entities={},this.entityGrid=null,this.phase=null,this.nextPhase=null,this.initPostprocessing(i,a)}},{key:"initPostprocessing",value:function(t,i){var a={enabled:!0},n=e.BokehDepthShader,r=new e.ShaderMaterial({uniforms:n.uniforms,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader});r.uniforms.mNear.value=this.camera.near,r.uniforms.mFar.value=this.camera.far,a.materialDepth=r;var o=3,s=4;a.scene=new e.Scene,a.camera=new e.OrthographicCamera(t/-2,t/2,i/2,i/-2,-1e4,1e4),a.camera.position.z=100,a.scene.add(a.camera);var h={minFilter:e.LinearFilter,magFilter:e.LinearFilter,format:e.RGBFormat};a.rtTextureDepth=new e.WebGLRenderTarget(t,i,h),a.rtTextureColor=new e.WebGLRenderTarget(t,i,h);var l=e.BokehShader;a.bokeh_uniforms=e.UniformsUtils.clone(l.uniforms),a.bokeh_uniforms.tColor.value=a.rtTextureColor.texture,a.bokeh_uniforms.tDepth.value=a.rtTextureDepth.texture,a.bokeh_uniforms.textureWidth.value=t,a.bokeh_uniforms.textureHeight.value=i,a.bokeh_uniforms.znear.value=this.camera.near,a.bokeh_uniforms.zfar.value=this.camera.far,a.bokeh_uniforms.shaderFocus.value=!1,a.bokeh_uniforms.focusCoords.value.set(.5,.5),a.materialBokeh=new e.ShaderMaterial({uniforms:a.bokeh_uniforms,vertexShader:l.vertexShader,fragmentShader:l.fragmentShader,defines:{RINGS:o,SAMPLES:s}}),a.quad=new e.Mesh(new e.PlaneBufferGeometry(t,i),a.materialBokeh),a.quad.position.z=-500,a.scene.add(a.quad),this.postprocessing=a}},{key:"updateCamera",value:function(){if(this.camera&&this.player){var t=(this.battlemode?new e.Vector3(200,100,400):new e.Vector3(0,150,500)).applyMatrix4(this.player.mesh.matrixWorld).sub(this.camera.position),i=Math.min(t.length(),10),a=t.normalize().multiplyScalar(i);this.camera.position.copy(this.camera.position.add(a)),this.camera.lookAt(this.player.mesh.position),this.player.spriteMesh.lookAt(this.camera.position)}}},{key:"tick",value:function(){if(this.currentTime=(new Date).getTime(),this.updater.update(),this.ui.render(),this.updateCamera(),this.postprocessing.enabled){var e=this.renderer,t=this.postprocessing,i=this.player.mesh.position.distanceTo(this.camera.position),a=this.camera.far,n=this.camera.near,r=Math.max(0,Math.min(1,(i-n)/(a-n))),o=-a*n/((1-r*r*(3-2*r))*(a-n)-a);t.bokeh_uniforms.focalDepth.value=o,e.clear(),e.setRenderTarget(t.rtTextureColor),e.clear(),e.render(this.scene,this.camera),this.scene.overrideMaterial=t.materialDepth,e.setRenderTarget(t.rtTextureDepth),e.clear(),e.render(this.scene,this.camera),this.scene.overrideMaterial=null,e.setRenderTarget(null),e.render(t.scene,t.camera)}else this.scene.overrideMaterial=null,this.renderer.setRenderTarget(null),this.renderer.clear(),this.renderer.render(this.scene,this.camera);this.isStopped||requestAnimationFrame(this.tick.bind(this))}},{key:"start",value:function(){this.tick()}},{key:"stop",value:function(){this.isStopped=!0}},{key:"run",value:function(t){var i=this;this.loadSprites(),this.loadMap(),this.loadModel(),this.updater=new d.a(this);var a=setInterval(function(){if(i.map.isLoaded&&i.isSpritesLoaded()&&i.model){for(clearInterval(a);i.scene.children.length>0;)i.scene.remove(i.scene.children[0]);var n=new x.a(i,i.map);i.world=n,i.scene.add(n.terrain),i.scene.add(n.model),i.initEntityGrid(),p.a.setGridSize(i.map.tilesize);var o=new e.AmbientLight(16777215,1);i.scene.add(o);var s=2,h=!0,l=!1,d=void 0;try{for(var f,m=r()(i.map.props);!(h=(f=m.next()).done);h=!0){var v=f.value,w=g.a.createEntity(v.kind,s++,"");w.setGridPosition(v.x,v.y),w instanceof b.a&&(w.model=i.model,w.mesh=w.model.scene.clone(),w.mesh.scale.set(5,5,5),w.mesh.rotation.y=Math.PI),i.addEntity(w),i.scene.add(w.mesh)}}catch(e){l=!0,d=e}finally{try{!h&&m.return&&m.return()}finally{if(l)throw d}}i.pathfinder=new u.a(i.map.width,i.map.height);var _=new c.a(1,t,"");_.setSprite(i.sprites.test1),_.buildMesh(),_.onRequestPath(function(e,t){return i.findPath(_,e,t)}),_.onStopPathing(function(t,a){if(_.target instanceof b.a){var n=_.target;if(_.target=null,!n.open){n.open=!0;var r=new e.AnimationMixer(n.mesh.children[0]),o=i.model.animations,s=e.AnimationClip.findByName(o,"Cube.001Action_Cube.001"),h=r.clipAction(s);h.setLoop(e.LoopOnce),h.clampWhenFinished=!0,h.play();var l=setInterval(function(){r.update(.05),h.isRunning()||clearInterval(l)},10)}}}),_.setGridPosition(3,3),_.idle(),i.addEntity(_),i.unregisterEntityPosition(_),i.player=_,i.nextPhase=new y.a(i,"enter"),i.scene.add(i.player.mesh),i.start()}},100)}},{key:"loadSprites",value:function(){var e={},t=function(t){var i={data:t,image:null,isLoaded:!1};e[t.id]=i;var a=new Image;a.src="static/"+t.id+".png",a.onload=function(){i.image=a,i.isLoaded=!0,i.width=a.width,i.height=a.height}},i=!0,a=!1,n=void 0;try{for(var o,s=r()(k.a);!(i=(o=s.next()).done);i=!0){t(o.value)}}catch(e){a=!0,n=e}finally{try{!i&&s.return&&s.return()}finally{if(a)throw n}}this.sprites=e}},{key:"loadMap",value:function(){this.map=new f.a}},{key:"loadModel",value:function(){var e=this;(new m.a).load("static/box.gltf",function(t){e.model=t},void 0,function(e){console.error(e)})}},{key:"isSpritesLoaded",value:function(){return!a.any(this.sprites,function(e){return!e.isLoaded})}},{key:"initEntityGrid",value:function(){this.entityGrid=[];for(var e=0;e<this.map.height;e+=1){this.entityGrid[e]=[];for(var t=0;t<this.map.width;t+=1)this.entityGrid[e][t]={}}}},{key:"addEntity",value:function(e){void 0===this.entities[e.id]&&(this.entities[e.id]=e,this.registerEntityPosition(e))}},{key:"removeEntity",value:function(e){e.id in this.entities&&(this.unregisterEntityPosition(e),delete this.entities[e.id])}},{key:"registerEntityPosition",value:function(e){var t=e.gridX,i=e.gridY;this.entityGrid[i][t][e.id]=e}},{key:"unregisterEntityPosition",value:function(e){var t=e.gridX,i=e.gridY;this.entityGrid[i][t][e.id]&&delete this.entityGrid[i][t][e.id]}},{key:"getEntityAt",value:function(e,t){if(this.map.isOutOfBounds(e,t)||!this.entityGrid)return null;var i=this.entityGrid[t][e],n=null;return a.size(i)>0&&(n=i[a.keys(i)[0]]),n}},{key:"getItemAt",value:function(e,t){return null}},{key:"getGridPosition",value:function(e,t){var i=this.map.tilesize;return{x:Math.floor((e.x-t.min.x)/i),y:Math.floor((e.z-t.min.y)/i)}}},{key:"click",value:function(t,i){if(this.ui&&this.ui.clickHandler(t,i))return;this.phase&&this.phase.click(t,i);var a=new e.Vector2;this.renderer.getSize(a);var n=new e.Vector2;n.x=t/a.x*2-1,n.y=-i/a.y*2+1;var o=new e.Raycaster;o.setFromCamera(n,this.camera);var s=o.intersectObjects(this.scene.children),h=!0,l=!1,c=void 0;try{for(var d,f=r()(s);!(h=(d=f.next()).done);h=!0){var u=d.value,p=this.getGridPosition(u.point,this.world.terrain.geometry.boundingBox),g=this.getEntityAt(p.x,p.y);g instanceof b.a?(this.player.setTarget(g),this.player.follow(g)):this.player.go(p.x,p.y)}}catch(e){l=!0,c=e}finally{try{!h&&f.return&&f.return()}finally{if(l)throw c}}}},{key:"keyDown",value:function(e){66===e&&(this.battlemode=!this.battlemode)}},{key:"forEachEntity",value:function(e){a.each(this.entities,function(t){e(t)})}},{key:"findPath",value:function(e,t,i){return this.map.isColliding(t,i)?[]:this.pathfinder&&e?this.pathfinder.findPath(this.map.grid,e,t,i,!1):[]}}]),t}());t.a=M}).call(t,i("Ml+6"),i("rdLu"))},cKQl:function(e,t){e.exports={id:"chest",width:16,height:16,animations:{idle_down:{length:1,row:0}},offset_x:0,offset_y:0}},cbRa:function(e,t,i){"use strict";var a=i("Zrlr"),n=i.n(a),r=i("wxAW"),o=i.n(r),s=function(){function e(){n()(this,e)}return o()(e,[{key:"setGame",value:function(e){this.game=e}},{key:"center",value:function(){window.scrollTo(0,1)}},{key:"start",value:function(e){this.center(),this.game.run()}}]),e}();t.a=s},e7Fs:function(e,t){e.exports={id:"villager",width:24,height:24,animations:{idle_down:{length:2,row:0}},offset_x:-4,offset_y:-8}},eOxi:function(e,t){e.exports={id:"coder",width:24,height:24,animations:{idle_down:{length:2,row:0}},offset_x:-4,offset_y:-7}},ejIc:function(e,t){e.exports={sha224WithRSAEncryption:{sign:"rsa",hash:"sha224",id:"302d300d06096086480165030402040500041c"},"RSA-SHA224":{sign:"ecdsa/rsa",hash:"sha224",id:"302d300d06096086480165030402040500041c"},sha256WithRSAEncryption:{sign:"rsa",hash:"sha256",id:"3031300d060960864801650304020105000420"},"RSA-SHA256":{sign:"ecdsa/rsa",hash:"sha256",id:"3031300d060960864801650304020105000420"},sha384WithRSAEncryption:{sign:"rsa",hash:"sha384",id:"3041300d060960864801650304020205000430"},"RSA-SHA384":{sign:"ecdsa/rsa",hash:"sha384",id:"3041300d060960864801650304020205000430"},sha512WithRSAEncryption:{sign:"rsa",hash:"sha512",id:"3051300d060960864801650304020305000440"},"RSA-SHA512":{sign:"ecdsa/rsa",hash:"sha512",id:"3051300d060960864801650304020305000440"},"RSA-SHA1":{sign:"rsa",hash:"sha1",id:"3021300906052b0e03021a05000414"},"ecdsa-with-SHA1":{sign:"ecdsa",hash:"sha1",id:""},sha256:{sign:"ecdsa",hash:"sha256",id:""},sha224:{sign:"ecdsa",hash:"sha224",id:""},sha384:{sign:"ecdsa",hash:"sha384",id:""},sha512:{sign:"ecdsa",hash:"sha512",id:""},"DSA-SHA":{sign:"dsa",hash:"sha1",id:""},"DSA-SHA1":{sign:"dsa",hash:"sha1",id:""},DSA:{sign:"dsa",hash:"sha1",id:""},"DSA-WITH-SHA224":{sign:"dsa",hash:"sha224",id:""},"DSA-SHA224":{sign:"dsa",hash:"sha224",id:""},"DSA-WITH-SHA256":{sign:"dsa",hash:"sha256",id:""},"DSA-SHA256":{sign:"dsa",hash:"sha256",id:""},"DSA-WITH-SHA384":{sign:"dsa",hash:"sha384",id:""},"DSA-SHA384":{sign:"dsa",hash:"sha384",id:""},"DSA-WITH-SHA512":{sign:"dsa",hash:"sha512",id:""},"DSA-SHA512":{sign:"dsa",hash:"sha512",id:""},"DSA-RIPEMD160":{sign:"dsa",hash:"rmd160",id:""},ripemd160WithRSA:{sign:"rsa",hash:"rmd160",id:"3021300906052b2403020105000414"},"RSA-RIPEMD160":{sign:"rsa",hash:"rmd160",id:"3021300906052b2403020105000414"},md5WithRSAEncryption:{sign:"rsa",hash:"md5",id:"3020300c06082a864886f70d020505000410"},"RSA-MD5":{sign:"rsa",hash:"md5",id:"3020300c06082a864886f70d020505000410"}}},esNN:function(e,t){e.exports={id:"test1",width:32,height:32,animations:{atk_right:{length:3,row:3},walk_right:{length:3,row:2},idle_right:{length:3,row:2},walk_up:{length:3,row:1},idle_up:{length:3,row:1},walk_down:{length:3,row:0},idle_down:{length:3,row:0}},offset_x:0,offset_y:-12}},fzpQ:function(e,t,i){"use strict";var a=i("BO1k"),n=i.n(a),r=i("Zrlr"),o=i.n(r),s=i("wxAW"),h=i.n(s),l=i("zTqn"),c=i("yh7f"),d=function(){function e(t){o()(this,e),this.game=t}return h()(e,[{key:"update",value:function(){this.updateEntities(),this.updateTransitions(),this.updatePhase()}},{key:"updateEntities",value:function(){var e=this;this.game.forEachEntity(function(t){t instanceof l.a&&(e.updateCharacter(t),e.updateAnimation(t)),e.updateEntityFading(t)})}},{key:"updateCharacter",value:function(e){var t=Math.round(16/Math.round(e.moveSpeed/(1e3/60)));e.isMoving()&&!1===e.movement.inProgress&&(e.orientation===c.a.Orientations.LEFT?e.movement.start(this.game.currentTime,function(t){e.x=t,e.hasMoved()},function(){e.x=e.movement.endValue,e.hasMoved(),e.nextStep()},e.x-t,e.x-16,e.moveSpeed):e.orientation===c.a.Orientations.RIGHT?e.movement.start(this.game.currentTime,function(t){e.x=t,e.hasMoved()},function(){e.x=e.movement.endValue,e.hasMoved(),e.nextStep()},e.x+t,e.x+16,e.moveSpeed):e.orientation===c.a.Orientations.UP?e.movement.start(this.game.currentTime,function(t){e.y=t,e.hasMoved()},function(){e.y=e.movement.endValue,e.hasMoved(),e.nextStep()},e.y-t,e.y-16,e.moveSpeed):e.orientation===c.a.Orientations.DOWN&&e.movement.start(this.game.currentTime,function(t){e.y=t,e.hasMoved()},function(){e.y=e.movement.endValue,e.hasMoved(),e.nextStep()},e.y+t,e.y+16,e.moveSpeed))}},{key:"updateAnimation",value:function(e){var t=e.currentAnimation;t&&t.update(this.game.currentTime)&&t.currentFrame&&((e.flipSpriteX&&e.texture.repeat.x>0||!e.flipSpriteX&&e.texture.repeat.x<0)&&(e.texture.repeat.x=-e.texture.repeat.x),e.texture.repeat.x>0?e.texture.offset.set(t.currentFrame.x/e.sprite.width,(e.sprite.height-t.currentFrame.y-t.height)/e.sprite.height):e.texture.offset.set(-(e.sprite.width-t.currentFrame.x-t.width)/e.sprite.width,(e.sprite.height-t.currentFrame.y-t.height)/e.sprite.height))}},{key:"updateTransitions",value:function(){var e=this,t=this.game.map.offset.x+this.game.map.tilesize/2,i=this.game.map.offset.y+this.game.map.tilesize/2;this.game.forEachEntity(function(a){var r=a.movement;if(r&&r.inProgress&&r.step(e.game.currentTime),a.mesh&&a.mesh.position.set(t+a.x+a.offset.x,0+a.offset.y,i+a.y+a.offset.z),a.shatters){var o=!0,s=!1,h=void 0;try{for(var l,c=n()(a.shatters);!(o=(l=c.next()).done);o=!0){var d=l.value;d._pos_init||(d.position.x+=a.mesh.position.x,d.position.z+=a.mesh.position.z,d._pos_init=!0,d.shatterTick=100*Math.random());--d.shatterTick,d.shatterTick<0&&(Math.abs(a.mesh.position.x-d.position.x)<1?d.position.x=a.mesh.position.x:d.position.x+=1/(a.mesh.position.x-d.position.x),Math.abs(a.mesh.position.y-d.position.y)<3?d.position.y=a.mesh.position.y:d.position.y+=3/(a.mesh.position.y-d.position.y),Math.abs(a.mesh.position.z-d.position.z)<1?d.position.z=a.mesh.position.z:d.position.z+=1/(a.mesh.position.z-d.position.z))}}catch(e){s=!0,h=e}finally{try{!o&&c.return&&c.return()}finally{if(s)throw h}}}}),this.game.mesh__&&(this.game.mesh__.position.copy(this.game.player.mesh.position),this.game.mesh__.position.y=11)}},{key:"updateEntityFading",value:function(e){if(e&&e.isFading){var t=this.game.currentTime-e.startFadingTime;t>1e3?(e.isFading=!1,e.mesh&&(e.spriteMesh.material.opacity=1)):e.mesh&&(e.spriteMesh.material.opacity=t/1e3)}}},{key:"updatePhase",value:function(){this.game.nextPhase&&(this.game.phase?(this.game.phase.end(),this.game.phase=null):(this.game.phase=this.game.nextPhase,this.game.nextPhase=null,this.game.phase.begin())),this.game.phase&&this.game.phase.update()}}]),e}();t.a=d},hemJ:function(e,t){e.exports={id:"goldensword",width:48,height:48,animations:{atk_right:{length:5,row:0},walk_right:{length:4,row:1},idle_right:{length:2,row:2},atk_up:{length:5,row:3},walk_up:{length:4,row:4},idle_up:{length:2,row:5},atk_down:{length:5,row:6},walk_down:{length:4,row:7},idle_down:{length:2,row:8}},offset_x:-16,offset_y:-20}},ijQv:function(e,t){e.exports={id:"arrow",width:14,height:14,animations:{idle_down:{length:1,row:0}}}},j8az:function(e,t){e.exports={id:"talk",width:14,height:14,animations:{idle_down:{length:1,row:0}}}},jQdr:function(e,t){var i=/firefox/i.test(navigator.userAgent);e.exports.isFirefox=i},jgxY:function(e,t){e.exports={id:"skeleton2",width:48,height:48,animations:{atk_right:{length:3,row:0},walk_right:{length:4,row:1},idle_right:{length:2,row:2},atk_up:{length:3,row:3},walk_up:{length:4,row:4},idle_up:{length:2,row:5},atk_down:{length:3,row:6},walk_down:{length:4,row:7},idle_down:{length:3,row:8}},offset_x:-16,offset_y:-20}},lUAm:function(e,t){e.exports={id:"desertnpc",width:24,height:24,animations:{idle_down:{length:2,row:0}},offset_x:-4,offset_y:-8}},lgfl:function(e,t){e.exports={id:"octocat",width:32,height:32,animations:{idle_down:{length:4,row:0}},offset_x:-8,offset_y:-12}},m3jU:function(e,t,i){"use strict";var a=i("Zrlr"),n=i.n(a),r=i("wxAW"),o=i.n(r),s=function(){function e(t,i){n()(this,e),this.id=t,this.kind=i,this.isLoaded=!1}return o()(e,[{key:"setPosition",value:function(e,t){this.x=e,this.y=t}},{key:"setGridPosition",value:function(t,i){this.gridX=t,this.gridY=i,this.setPosition(t*e.gridSize,i*e.gridSize)}},{key:"fadeIn",value:function(e){this.isFading=!0,this.startFadingTime=e}}],[{key:"setGridSize",value:function(t){e.gridSize=t}}]),e}();t.a=s},mJyv:function(e,t){e.exports={id:"hand",width:14,height:14,animations:{idle_down:{length:1,row:0}}}},me95:function(e,t){e.exports={id:"shadow16",width:16,height:16}},"n+Rf":function(e,t){e.exports={id:"item-platearmor",width:16,height:16,animations:{idle:{length:6,row:0}},offset_x:0,offset_y:0}},ni5p:function(e,t){e.exports={id:"priest",width:24,height:24,animations:{idle_down:{length:2,row:0}},offset_x:-4,offset_y:-8}},oxPP:function(e,t){e.exports={id:"bat",width:32,height:48,animations:{atk_right:{length:5,row:0},walk_right:{length:5,row:1},idle_right:{length:5,row:2},atk_up:{length:5,row:3},walk_up:{length:5,row:4},idle_up:{length:5,row:5},atk_down:{length:5,row:6},walk_down:{length:5,row:7},idle_down:{length:5,row:8}},offset_x:-8,offset_y:-24}},q9QV:function(e,t){e.exports={id:"axe",width:48,height:48,animations:{atk_right:{length:5,row:0},walk_right:{length:4,row:1},idle_right:{length:2,row:2},atk_up:{length:5,row:3},walk_up:{length:4,row:4},idle_up:{length:2,row:5},atk_down:{length:5,row:6},walk_down:{length:4,row:7},idle_down:{length:2,row:8}},offset_x:-16,offset_y:-20}},rwlJ:function(e,t,i){(function(e){e.BokehShader={uniforms:{textureWidth:{value:1},textureHeight:{value:1},focalDepth:{value:1},focalLength:{value:24},fstop:{value:.9},tColor:{value:null},tDepth:{value:null},maxblur:{value:1},showFocus:{value:0},manualdof:{value:0},vignetting:{value:0},depthblur:{value:0},threshold:{value:.5},gain:{value:2},bias:{value:.5},fringe:{value:.7},znear:{value:.1},zfar:{value:100},noise:{value:1},dithering:{value:1e-4},pentagon:{value:0},shaderFocus:{value:1},focusCoords:{value:new e.Vector2}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","varying vec2 vUv;","uniform sampler2D tColor;","uniform sampler2D tDepth;","uniform float textureWidth;","uniform float textureHeight;","uniform float focalDepth;  //focal distance value in meters, but you may use autofocus option below","uniform float focalLength; //focal length in mm","uniform float fstop; //f-stop value","uniform bool showFocus; //show debug focus point and focal range (red = focal point, green = focal range)","/*","make sure that these two values are the same for your camera, otherwise distances will be wrong.","*/","uniform float znear; // camera clipping start","uniform float zfar; // camera clipping end","//------------------------------------------","//user variables","const int samples = SAMPLES; //samples on the first ring","const int rings = RINGS; //ring count","const int maxringsamples = rings * samples;","uniform bool manualdof; // manual dof calculation","float ndofstart = 1.0; // near dof blur start","float ndofdist = 2.0; // near dof blur falloff distance","float fdofstart = 1.0; // far dof blur start","float fdofdist = 3.0; // far dof blur falloff distance","float CoC = 0.03; //circle of confusion size in mm (35mm film = 0.03mm)","uniform bool vignetting; // use optical lens vignetting","float vignout = 1.3; // vignetting outer border","float vignin = 0.0; // vignetting inner border","float vignfade = 22.0; // f-stops till vignete fades","uniform bool shaderFocus;","// disable if you use external focalDepth value","uniform vec2 focusCoords;","// autofocus point on screen (0.0,0.0 - left lower corner, 1.0,1.0 - upper right)","// if center of screen use vec2(0.5, 0.5);","uniform float maxblur;","//clamp value of max blur (0.0 = no blur, 1.0 default)","uniform float threshold; // highlight threshold;","uniform float gain; // highlight gain;","uniform float bias; // bokeh edge bias","uniform float fringe; // bokeh chromatic aberration / fringing","uniform bool noise; //use noise instead of pattern for sample dithering","uniform float dithering;","uniform bool depthblur; // blur the depth buffer","float dbsize = 1.25; // depth blur size","/*","next part is experimental","not looking good with small sample and ring count","looks okay starting from samples = 4, rings = 4","*/","uniform bool pentagon; //use pentagon as bokeh shape?","float feather = 0.4; //pentagon shape feather","//------------------------------------------","float penta(vec2 coords) {","//pentagonal shape","float scale = float(rings) - 1.3;","vec4  HS0 = vec4( 1.0,         0.0,         0.0,  1.0);","vec4  HS1 = vec4( 0.309016994, 0.951056516, 0.0,  1.0);","vec4  HS2 = vec4(-0.809016994, 0.587785252, 0.0,  1.0);","vec4  HS3 = vec4(-0.809016994,-0.587785252, 0.0,  1.0);","vec4  HS4 = vec4( 0.309016994,-0.951056516, 0.0,  1.0);","vec4  HS5 = vec4( 0.0        ,0.0         , 1.0,  1.0);","vec4  one = vec4( 1.0 );","vec4 P = vec4((coords),vec2(scale, scale));","vec4 dist = vec4(0.0);","float inorout = -4.0;","dist.x = dot( P, HS0 );","dist.y = dot( P, HS1 );","dist.z = dot( P, HS2 );","dist.w = dot( P, HS3 );","dist = smoothstep( -feather, feather, dist );","inorout += dot( dist, one );","dist.x = dot( P, HS4 );","dist.y = HS5.w - abs( P.z );","dist = smoothstep( -feather, feather, dist );","inorout += dist.x;","return clamp( inorout, 0.0, 1.0 );","}","float bdepth(vec2 coords) {","// Depth buffer blur","float d = 0.0;","float kernel[9];","vec2 offset[9];","vec2 wh = vec2(1.0/textureWidth,1.0/textureHeight) * dbsize;","offset[0] = vec2(-wh.x,-wh.y);","offset[1] = vec2( 0.0, -wh.y);","offset[2] = vec2( wh.x -wh.y);","offset[3] = vec2(-wh.x,  0.0);","offset[4] = vec2( 0.0,   0.0);","offset[5] = vec2( wh.x,  0.0);","offset[6] = vec2(-wh.x, wh.y);","offset[7] = vec2( 0.0,  wh.y);","offset[8] = vec2( wh.x, wh.y);","kernel[0] = 1.0/16.0;   kernel[1] = 2.0/16.0;   kernel[2] = 1.0/16.0;","kernel[3] = 2.0/16.0;   kernel[4] = 4.0/16.0;   kernel[5] = 2.0/16.0;","kernel[6] = 1.0/16.0;   kernel[7] = 2.0/16.0;   kernel[8] = 1.0/16.0;","for( int i=0; i<9; i++ ) {","float tmp = texture2D(tDepth, coords + offset[i]).r;","d += tmp * kernel[i];","}","return d;","}","vec3 color(vec2 coords,float blur) {","//processing the sample","vec3 col = vec3(0.0);","vec2 texel = vec2(1.0/textureWidth,1.0/textureHeight);","col.r = texture2D(tColor,coords + vec2(0.0,1.0)*texel*fringe*blur).r;","col.g = texture2D(tColor,coords + vec2(-0.866,-0.5)*texel*fringe*blur).g;","col.b = texture2D(tColor,coords + vec2(0.866,-0.5)*texel*fringe*blur).b;","vec3 lumcoeff = vec3(0.299,0.587,0.114);","float lum = dot(col.rgb, lumcoeff);","float thresh = max((lum-threshold)*gain, 0.0);","return col+mix(vec3(0.0),col,thresh*blur);","}","vec3 debugFocus(vec3 col, float blur, float depth) {","float edge = 0.002*depth; //distance based edge smoothing","float m = clamp(smoothstep(0.0,edge,blur),0.0,1.0);","float e = clamp(smoothstep(1.0-edge,1.0,blur),0.0,1.0);","col = mix(col,vec3(1.0,0.5,0.0),(1.0-m)*0.6);","col = mix(col,vec3(0.0,0.5,1.0),((1.0-e)-(1.0-m))*0.2);","return col;","}","float linearize(float depth) {","return -zfar * znear / (depth * (zfar - znear) - zfar);","}","float vignette() {","float dist = distance(vUv.xy, vec2(0.5,0.5));","dist = smoothstep(vignout+(fstop/vignfade), vignin+(fstop/vignfade), dist);","return clamp(dist,0.0,1.0);","}","float gather(float i, float j, int ringsamples, inout vec3 col, float w, float h, float blur) {","float rings2 = float(rings);","float step = PI*2.0 / float(ringsamples);","float pw = cos(j*step)*i;","float ph = sin(j*step)*i;","float p = 1.0;","if (pentagon) {","p = penta(vec2(pw,ph));","}","col += color(vUv.xy + vec2(pw*w,ph*h), blur) * mix(1.0, i/rings2, bias) * p;","return 1.0 * mix(1.0, i /rings2, bias) * p;","}","void main() {","//scene depth calculation","float depth = linearize(texture2D(tDepth,vUv.xy).x);","// Blur depth?","if ( depthblur ) {","depth = linearize(bdepth(vUv.xy));","}","//focal plane calculation","float fDepth = focalDepth;","if (shaderFocus) {","fDepth = linearize(texture2D(tDepth,focusCoords).x);","}","// dof blur factor calculation","float blur = 0.0;","if (manualdof) {","float a = depth-fDepth; // Focal plane","float b = (a-fdofstart)/fdofdist; // Far DoF","float c = (-a-ndofstart)/ndofdist; // Near Dof","blur = (a>0.0) ? b : c;","} else {","float f = focalLength; // focal length in mm","float d = fDepth*1000.0; // focal plane in mm","float o = depth*1000.0; // depth in mm","float a = (o*f)/(o-f);","float b = (d*f)/(d-f);","float c = (d-f)/(d*fstop*CoC);","blur = abs(a-b)*c;","}","blur = clamp(blur,0.0,1.0);","// calculation of pattern for dithering","vec2 noise = vec2(rand(vUv.xy), rand( vUv.xy + vec2( 0.4, 0.6 ) ) )*dithering*blur;","// getting blur x and y step factor","float w = (1.0/textureWidth)*blur*maxblur+noise.x;","float h = (1.0/textureHeight)*blur*maxblur+noise.y;","// calculation of final color","vec3 col = vec3(0.0);","if(blur < 0.05) {","//some optimization thingy","col = texture2D(tColor, vUv.xy).rgb;","} else {","col = texture2D(tColor, vUv.xy).rgb;","float s = 1.0;","int ringsamples;","for (int i = 1; i <= rings; i++) {","/*unboxstart*/","ringsamples = i * samples;","for (int j = 0 ; j < maxringsamples ; j++) {","if (j >= ringsamples) break;","s += gather(float(i), float(j), ringsamples, col, w, h, blur);","}","/*unboxend*/","}","col /= s; //divide by sample count","}","if (showFocus) {","col = debugFocus(col, blur, depth);","}","if (vignetting) {","col *= vignette();","}","gl_FragColor.rgb = col;","gl_FragColor.a = 1.0;","} "].join("\n")},e.BokehDepthShader={uniforms:{mNear:{value:1},mFar:{value:1e3}},vertexShader:["varying float vViewZDepth;","void main() {","\t#include <begin_vertex>","\t#include <project_vertex>","\tvViewZDepth = - mvPosition.z;","}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","varying float vViewZDepth;","void main() {","\tfloat color = 1.0 - smoothstep( mNear, mFar, vViewZDepth );","\tgl_FragColor = vec4( vec3( color ), 1.0 );","} "].join("\n")}}).call(t,i("Ml+6"))},t0mp:function(e,t){e.exports={id:"scientist",width:24,height:24,animations:{idle_down:{length:2,row:0}},offset_x:-4,offset_y:-8}},t9nu:function(e,t){e.exports={id:"impact",width:16,height:16,animations:{idle:{length:1,row:0}},offset_x:0,offset_y:0}},tTs3:function(e,t,i){"use strict";var a=i("OvRC"),n=i.n(a),r=i("XDXK"),o=function(e,t,i,a,n,o,s){this.textAlign="left",this.textBaseline="alphabetic",this.text=void 0!==t?t:"",this.size=void 0!==i?i:12,this.font=void 0!==a?a:"Arial",this.color=void 0!==n?n:"#000000",this.lineHeight=1;o=void 0!==o?o:0,s=void 0!==s?s:0;r.a.bind(this)(e,o,s)};(o.prototype=n()(r.a.prototype)).draw=function(e,t,i){e.font=this.size+"px "+this.font,e.fillStyle=this.color,e.textAlign=this.textAlign,e.textBaseline=this.textBaseline;var a=this.text.split("\n"),n=0;"center"===this.textVerticalAlign?n=a.length/2-.5:"bottom"===this.textVerticalAlign&&(n=a.length-1);for(var r=0;r<a.length;r++){var o=a[r],s=i+(r-n)*(this.size*this.lineHeight);e.fillText(o,t,s)}},t.a=o},taTb:function(e,t){e.exports={id:"boss",width:64,height:72,animations:{atk_right:{length:6,row:0},walk_right:{length:3,row:1},idle_right:{length:4,row:2},atk_up:{length:5,row:3},walk_up:{length:4,row:4},idle_up:{length:4,row:5},atk_down:{length:6,row:6},walk_down:{length:4,row:7},idle_down:{length:4,row:8},"Group 5":{length:3,row:9}},offset_x:-24,offset_y:-36}},uL5Q:function(e,t,i){"use strict";t.a={center:1,left:2,right:3,top:4,bottom:5}},ujQs:function(e,t){e.exports={id:"firefox",width:32,height:32,animations:{atk_right:{length:5,row:0},walk_right:{length:4,row:1},idle_right:{length:5,row:2},atk_up:{length:5,row:3},walk_up:{length:8,row:4},idle_up:{length:2,row:5},atk_down:{length:5,row:6},walk_down:{length:4,row:7},idle_down:{length:2,row:8}},offset_x:-8,offset_y:-12}},vm1t:function(e,t){e.exports={id:"sword1",width:32,height:32,animations:{atk_right:{length:5,row:0},walk_right:{length:4,row:1},idle_right:{length:2,row:2},atk_up:{length:5,row:3},walk_up:{length:4,row:4},idle_up:{length:2,row:5},atk_down:{length:5,row:6},walk_down:{length:4,row:7},idle_down:{length:2,row:8}},offset_x:-8,offset_y:-12}},wV90:function(e,t,i){"use strict";new Int32Array(4096)},wVoP:function(e,t,i){"use strict";var a=i("Zrlr"),n=i.n(a),r=i("wxAW"),o=i.n(r),s=function(){function e(t,i,a,r,o){n()(this,e),this.name=t,this.length=i,this.row=a,this.width=r,this.height=o,this.reset()}return o()(e,[{key:"tick",value:function(){var e=this.currentFrame.index;if(e=e<this.length-1?e+1:0,this.count>0&&0===e&&(this.count-=1,0===this.count))return this.currentFrame.index=0,void this.endcount_callback();this.currentFrame.x=this.width*e,this.currentFrame.y=this.height*this.row,this.currentFrame.index=e}},{key:"setSpeed",value:function(e){this.speed=e}},{key:"setCount",value:function(e,t){this.count=e,this.endcount_callback=t}},{key:"isTimeToAnimate",value:function(e){return e-this.lastTime>this.speed}},{key:"update",value:function(e){return 0===this.lastTime&&"atk"===this.name.substr(0,3)&&(this.lastTime=e),!!this.isTimeToAnimate(e)&&(this.lastTime=e,this.tick(),!0)}},{key:"reset",value:function(){this.lastTime=0,this.currentFrame={index:0,x:0,y:this.row*this.height}}}]),e}();t.a=s},wine:function(e,t){e.exports={id:"sword",width:14,height:14,animations:{idle_down:{length:1,row:0}}}},wzZJ:function(e,t){e.exports={id:"item-burger",width:16,height:16,animations:{idle:{length:6,row:0}},offset_x:0,offset_y:0}},ySG5:function(e,t){e.exports={id:"loot",width:14,height:14,animations:{idle_down:{length:1,row:0}}}},yWNk:function(e,t){e.exports={id:"bluesword",width:48,height:48,animations:{atk_right:{length:5,row:0},walk_right:{length:4,row:1},idle_right:{length:2,row:2},atk_up:{length:5,row:3},walk_up:{length:4,row:4},idle_up:{length:2,row:5},atk_down:{length:5,row:6},walk_down:{length:4,row:7},idle_down:{length:2,row:8}},offset_x:-16,offset_y:-20}},yh7f:function(e,t,i){"use strict";t.a={Orientations:{UP:1,DOWN:2,LEFT:3,RIGHT:4},Entities:{PLAYER:1,FIRE:2,CHEST:3,DEATHKNIGHT:4},BattleState:{BEGIN:1,MAIN:2,END:3}}},zRJz:function(e,t){e.exports={id:"rat",width:48,height:48,animations:{death:{length:4,row:0},atk_right:{length:6,row:1},walk_right:{length:3,row:2},idle_right:{length:2,row:3},atk_up:{length:4,row:4},walk_up:{length:4,row:5},idle_up:{length:4,row:6},atk_down:{length:4,row:7},walk_down:{length:4,row:8},idle_down:{length:4,row:9}}}},zTqn:function(e,t,i){"use strict";(function(e,a){var n=i("Zx67"),r=i.n(n),o=i("Zrlr"),s=i.n(o),h=i("wxAW"),l=i.n(h),c=i("zwoO"),d=i.n(c),f=i("Pf15"),u=i.n(f),p=(i("wV90"),i("m3jU")),g=i("TAbc"),m=i("yh7f"),v=i("wVoP"),w=function(t){function i(e,t){s()(this,i);var a=d()(this,(i.__proto__||r()(i)).call(this,e,t));return a.nextGridX=-1,a.nextGridY=-1,a.orientation=m.a.Orientations.DOWN,a.movement=new g.a,a.path=null,a.newDestination=null,a.adjacentTiles={},a.animations={},a.currentAnimation=null,a.flipSpriteX=!1,a.flipSpriteY=!1,a.moveSpeed=120,a.walkSpeed=100,a.idleSpeed=450,a}return u()(i,t),l()(i,[{key:"setSprite",value:function(e){for(var t in this.sprite=e,e.data.animations){var i=e.data.animations[t];this.animations[t]=new v.a(t,i.length,i.row,e.data.width,e.data.height)}}},{key:"getAnimationByName",value:function(e){if(e in this.animations)return this.animations[e]}},{key:"setAnimation",value:function(e,t,i,a){if(!this.currentAnimation||this.currentAnimation.name!==e){var n=this.getAnimationByName(e);n&&(this.currentAnimation=n,"atk"===e.substr(0,3)&&this.currentAnimation.reset(),this.currentAnimation.setSpeed(t),this.currentAnimation.setCount(i||0,a||function(){this.idle()}))}}},{key:"animate",value:function(t,i,a,n){var r=this.orientation;this.currentAnimation&&"death"===this.currentAnimation.name||(this.flipSpriteX=!1,this.flipSpriteY=!1,e.indexOf(["atk","walk","idle"],t)>=0&&(t+="_"+(r===m.a.Orientations.LEFT?"right":function(e){switch(e){case m.a.Orientations.LEFT:return"left";case m.a.Orientations.RIGHT:return"right";case m.a.Orientations.UP:return"up";case m.a.Orientations.DOWN:return"down"}}(r)),this.flipSpriteX=this.orientation===m.a.Orientations.LEFT),this.setAnimation(t,i,a,n))}},{key:"buildMesh",value:function(){if(this.sprite){var e=new a.Group,t=new a.PlaneGeometry(32,32);t.computeFaceNormals(),t.computeBoundingBox();var i=new a.Texture;i.image=this.sprite.image,i.format=a.RGBAFormat,i.needsUpdate=!0,i.wrapS=i.wrapT=a.RepeatWrapping;var n=this.sprite.width/this.sprite.data.width,r=this.sprite.height/this.sprite.data.height;i.repeat.set(1/n,1/r),i.magFilter=a.NearestFilter,i.minFilter=a.NearestFilter;var o=new a.MeshStandardMaterial({map:i,transparent:!0}),s=new a.Mesh(t,o);e.add(s);var h=new a.SphereGeometry(this.sprite.data.width/5,32,32),l=new a.MeshBasicMaterial({transparent:!0,opacity:0}),c=new a.Mesh(h,l);c.scale.set(1,2,1),c.castShadow=!0,e.add(c),this.mesh=e,this.texture=s.material.map,this.spriteMesh=s,this.offset={x:0,y:-this.sprite.data.offset_y||0,z:0}}}},{key:"requestPathfindingTo",value:function(e,t){return this.request_path_callback?this.request_path_callback(e,t):[]}},{key:"onRequestPath",value:function(e){this.request_path_callback=e}},{key:"onStartPathing",value:function(e){this.start_pathing_callback=e}},{key:"onStopPathing",value:function(e){this.stop_pathing_callback=e}},{key:"onBeforeStep",value:function(e){this.before_step_callback=e}},{key:"onStep",value:function(e){this.step_callback=e}},{key:"isMoving",value:function(){return!(null===this.path)}},{key:"hasMoved",value:function(){this.hasmoved_callback&&this.hasmoved_callback(this)}},{key:"hasNextStep",value:function(){return this.path.length-1>this.step}},{key:"hasChangedItsPath",value:function(){return!(null===this.newDestination)}},{key:"setOrientation",value:function(e){e&&(this.orientation=e)}},{key:"idle",value:function(e){this.setOrientation(e),this.animate("idle",this.idleSpeed)}},{key:"walk",value:function(e){this.setOrientation(e),this.animate("walk",this.walkSpeed)}},{key:"go",value:function(e,t){this.followingMode&&(this.followingMode=!1,this.target=null),this.moveTo(e,t)}},{key:"follow",value:function(e){e&&(this.followingMode=!0,this.moveTo(e.gridX,e.gridY))}},{key:"moveTo",value:function(e,t){if(this.destination={gridX:e,gridY:t},this.isMoving())this.continueTo(e,t);else{var i=this.requestPathfindingTo(e,t);this.followPath(i)}}},{key:"stop",value:function(){this.isMoving()&&(this.interrupted=!0)}},{key:"continueTo",value:function(e,t){this.newDestination={x:e,y:t}}},{key:"updateMovement",value:function(){var e=this.path,t=this.step;e[t][0]<e[t-1][0]&&this.walk(m.a.Orientations.LEFT),e[t][0]>e[t-1][0]&&this.walk(m.a.Orientations.RIGHT),e[t][1]<e[t-1][1]&&this.walk(m.a.Orientations.UP),e[t][1]>e[t-1][1]&&this.walk(m.a.Orientations.DOWN)}},{key:"followPath",value:function(e){e.length>1&&(this.path=e,this.step=0,this.followingMode&&e.pop(),this.start_pathing_callback&&this.start_pathing_callback(e),this.nextStep())}},{key:"nextStep",value:function(){var e=!1;if(this.isMoving()){if(this.before_step_callback&&this.before_step_callback(),this.updatePositionOnGrid(),this.interrupted)e=!0,this.interrupted=!1;else if(this.hasNextStep()&&(this.nextGridX=this.path[this.step+1][0],this.nextGridY=this.path[this.step+1][1]),this.step_callback&&this.step_callback(),this.hasChangedItsPath()){var t=this.newDestination.x,i=this.newDestination.y,a=this.requestPathfindingTo(t,i);this.newDestination=null,a.length<2?e=!0:this.followPath(a)}else this.hasNextStep()?(this.step+=1,this.updateMovement()):e=!0;e&&(this.path=null,this.idle(),this.stop_pathing_callback&&this.stop_pathing_callback(this.gridX,this.gridY))}}},{key:"updatePositionOnGrid",value:function(){this.setGridPosition(this.path[this.step][0],this.path[this.step][1])}},{key:"setTarget",value:function(e){this.target!==e&&(this.target=e)}}]),i}(p.a);t.a=w}).call(t,i("rdLu"),i("Ml+6"))}},["NHnr"]);
//# sourceMappingURL=app.eed4020fd8be1a8704cc.js.map