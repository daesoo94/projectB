webpackJsonp([1],{"+F07":function(e,t){e.exports={id:"item-sword1",width:16,height:16,animations:{idle:{length:6,row:0}},offset_x:0,offset_y:0}},"+rbd":function(e,t){e.exports={id:"agent",width:24,height:24,animations:{idle_down:{length:2,row:0}},offset_x:-4,offset_y:-8}},"/Ooo":function(e,t){e.exports={id:"king",width:32,height:32,animations:{idle_down:{length:2,row:0}},offset_x:-8,offset_y:-12}},"/c9u":function(e,t,i){"use strict";var n=i("OvRC"),a=i.n(n),r=i("XDXK"),o=function(e,t,i,n,a,o){this.color=t;i=void 0!==i?i:0,n=void 0!==n?n:0,a=void 0!==a?a:1,o=void 0!==o?o:1;r.a.bind(this)(e,i,n,a,o)};(o.prototype=a()(r.a.prototype)).draw=function(e,t,i,n,a){e.fillStyle=this.color,e.fillRect(t,i,n,a)},t.a=o},"/sf/":function(e,t){e.exports={id:"guard",width:25,height:24,animations:{idle_down:{length:2,row:0}},offset_x:-5,offset_y:-8}},"/z/9":function(e,t){e.exports={id:"item-goldensword",width:16,height:16,animations:{idle:{length:6,row:0}},offset_x:0,offset_y:0}},"0U4p":function(e,t){e.exports={id:"snake",width:28,height:28,animations:{atk_right:{length:5,row:0},walk_right:{length:4,row:1},idle_right:{length:4,row:2},atk_up:{length:5,row:3},walk_up:{length:4,row:4},idle_up:{length:4,row:5},atk_down:{length:5,row:6},walk_down:{length:4,row:7},idle_down:{length:6,row:8}},offset_x:-6,offset_y:-10}},"0YEL":function(e,t){e.exports={id:"item-leatherarmor",width:16,height:16,animations:{idle:{length:6,row:0}},offset_x:0,offset_y:0}},"0i05":function(e,t){e.exports={id:"mailarmor",width:32,height:32,animations:{atk_right:{length:5,row:0},walk_right:{length:4,row:1},idle_right:{length:2,row:2},atk_up:{length:5,row:3},walk_up:{length:4,row:4},idle_up:{length:2,row:5},atk_down:{length:5,row:6},walk_down:{length:4,row:7},idle_down:{length:2,row:8}},offset_x:-8,offset_y:-12}},"1ZLN":function(e,t,i){var n={"./agent.json":"+rbd","./arrow.json":"ijQv","./axe.json":"q9QV","./bat.json":"oxPP","./beachnpc.json":"72jo","./bluesword.json":"yWNk","./boss.json":"taTb","./chest.json":"cKQl","./clotharmor.json":"AKwQ","./coder.json":"eOxi","./crab.json":"UcV4","./death.json":"Sqs0","./deathknight.json":"Oy9j","./desertnpc.json":"lUAm","./eye.json":"PznX","./firefox.json":"ujQs","./forestnpc.json":"aNYQ","./goblin.json":"C37V","./goldenarmor.json":"UStB","./goldensword.json":"hemJ","./guard.json":"/sf/","./hand.json":"mJyv","./impact.json":"t9nu","./item-axe.json":"HITf","./item-bluesword.json":"ZBgj","./item-burger.json":"wzZJ","./item-cake.json":"B4O8","./item-clotharmor.json":"LsZA","./item-firepotion.json":"9R10","./item-flask.json":"RgGw","./item-goldenarmor.json":"SML3","./item-goldensword.json":"/z/9","./item-leatherarmor.json":"0YEL","./item-mailarmor.json":"BvGv","./item-morningstar.json":"3SDg","./item-platearmor.json":"n+Rf","./item-redarmor.json":"A0vU","./item-redsword.json":"RZ8U","./item-sword1.json":"+F07","./item-sword2.json":"7fe2","./king.json":"/Ooo","./lavanpc.json":"Tb6K","./leatherarmor.json":"JYMs","./loot.json":"ySG5","./mailarmor.json":"0i05","./morningstar.json":"34Xz","./nyan.json":"47gg","./octocat.json":"lgfl","./ogre.json":"8VIR","./platearmor.json":"L0hz","./priest.json":"ni5p","./rat.json":"zRJz","./redarmor.json":"RVzG","./redsword.json":"IJ/y","./rick.json":"4Alr","./scientist.json":"t0mp","./shadow16.json":"me95","./skeleton.json":"1mYB","./skeleton2.json":"jgxY","./snake.json":"0U4p","./sorcerer.json":"8emz","./sparks.json":"2UF/","./spectre.json":"NxES","./sword.json":"wine","./sword1.json":"vm1t","./sword2.json":"H7Qu","./talk.json":"j8az","./target.json":"Qyla","./test1.json":"esNN","./test2.json":"F+2f","./test3.json":"spbf","./test4.json":"INyW","./test5.json":"kqRq","./villagegirl.json":"KD9h","./villager.json":"e7Fs","./wizard.json":"Lx20"};function a(e){return i(r(e))}function r(e){var t=n[e];if(!(t+1))throw new Error("Cannot find module '"+e+"'.");return t}a.keys=function(){return Object.keys(n)},a.resolve=r,e.exports=a,a.id="1ZLN"},"1fqz":function(e,t,i){"use strict";var n=i("Zx67"),a=i.n(n),r=i("Zrlr"),o=i.n(r),s=i("zwoO"),h=i.n(s),l=i("Pf15"),u=i.n(l),d=function(e){function t(e,i,n){o()(this,t);var r=h()(this,(t.__proto__||a()(t)).call(this,e,n));return r.name=i,r}return u()(t,e),t}(i("zTqn").a);t.a=d},"1mYB":function(e,t){e.exports={id:"skeleton",width:48,height:48,animations:{atk_right:{length:3,row:0},walk_right:{length:4,row:1},idle_right:{length:2,row:2},atk_up:{length:3,row:3},walk_up:{length:4,row:4},idle_up:{length:3,row:5},atk_down:{length:3,row:6},walk_down:{length:4,row:7},idle_down:{length:3,row:8}},offset_x:-16,offset_y:-20}},"2UF/":function(e,t){e.exports={id:"sparks",width:16,height:16,animations:{idle:{length:6,row:0}},offset_x:0,offset_y:0}},"34Xz":function(e,t){e.exports={id:"morningstar",width:38,height:38,animations:{atk_right:{length:5,row:0},walk_right:{length:4,row:1},idle_right:{length:2,row:2},atk_up:{length:5,row:3},walk_up:{length:4,row:4},idle_up:{length:2,row:5},atk_down:{length:5,row:6},walk_down:{length:4,row:7},idle_down:{length:2,row:8}},offset_x:-11,offset_y:-15}},"3SDg":function(e,t){e.exports={id:"item-morningstar",width:16,height:16,animations:{idle:{length:6,row:0}},offset_x:0,offset_y:0}},"47gg":function(e,t){e.exports={id:"nyan",width:49,height:24,animations:{idle_down:{length:6,row:0}},offset_x:-22,offset_y:-6}},"4Alr":function(e,t){e.exports={id:"rick",width:32,height:32,animations:{idle_down:{length:4,row:0}},offset_x:-8,offset_y:-12}},"72jo":function(e,t){e.exports={id:"beachnpc",width:24,height:24,animations:{idle_down:{length:2,row:0}},offset_x:-4,offset_y:-8}},"7fe2":function(e,t){e.exports={id:"item-sword2",width:16,height:16,animations:{idle:{length:6,row:0}},offset_x:0,offset_y:0}},"8VIR":function(e,t){e.exports={id:"ogre",width:48,height:48,animations:{atk_right:{length:3,row:0},walk_right:{length:6,row:1},idle_right:{length:2,row:2},atk_up:{length:3,row:3},walk_up:{length:5,row:4},idle_up:{length:2,row:5},atk_down:{length:3,row:6},walk_down:{length:6,row:7},idle_down:{length:2,row:8}},offset_x:-16,offset_y:-24}},"8emz":function(e,t){e.exports={id:"sorcerer",width:26,height:26,animations:{idle_down:{length:6,row:0}},offset_x:-5,offset_y:-9}},"8qcI":function(e,t,i){"use strict";var n=i("BO1k"),a=i.n(n),r=[],o=!0,s=!1,h=void 0;try{for(var l,u=a()(["deathknight","clotharmor","test3","test4","test5"]);!(o=(l=u.next()).done);o=!0){var d=l.value,c=i("1ZLN")("./"+d+".json");r.push(c)}}catch(e){s=!0,h=e}finally{try{!o&&u.return&&u.return()}finally{if(s)throw h}}t.a=r},"9R10":function(e,t){e.exports={id:"item-firepotion",width:16,height:16,animations:{idle:{length:6,row:0}},offset_x:0,offset_y:0}},A0vU:function(e,t){e.exports={id:"item-redarmor",width:16,height:16,animations:{idle:{length:6,row:0}},offset_x:0,offset_y:0}},AKwQ:function(e,t){e.exports={id:"clotharmor",width:32,height:32,animations:{atk_right:{length:5,row:0},walk_right:{length:4,row:1},idle_right:{length:2,row:2},atk_up:{length:5,row:3},walk_up:{length:4,row:4},idle_up:{length:2,row:5},atk_down:{length:5,row:6},walk_down:{length:4,row:7},idle_down:{length:2,row:8}},offset_x:-8,offset_y:-12}},AeT2:function(e,t,i){"use strict";(function(e){var n=i("C4MV"),a=i.n(n),r=i("uL5Q"),o=i("Rr+P"),s=i("/c9u"),h=i("b8n+"),l=i("tTs3"),u=i("jQdr"),d=(i.n(u),["x","y","width","height","rotation","alpha","visible","pivot","anchor","smoothing","stretch","offset","text","scale","parent","textAlign","assetPath","color","left","right","up","down","ActiveInvoke"]),c=function(e,t){d.forEach(function(i){var n="_proxied_"+i;e[n]=e[i],a()(e,i,{set:function(a){e[i]!==a&&(t.shouldReDraw=!0),e[n]=a},get:function(){return e[n]}})})},f=function(e,t,i){this.displayObjects=[],this.eventListeners={click:[]},this.clearRect=null,this.gameCanvas=e,this.canvas=document.getElementById("foreground"),this.context=this.canvas.getContext("2d"),this.renderOnQuad=i||!1,this.shouldReDraw=!0,this.renderOnQuad&&this.prepareThreeJSScene(),this.resize()};f.anchors=r.a,f.prototype.addCanvasToDom=function(){this.gameCanvas.parentNode.appendChild(this.canvas)},f.prototype.prepareThreeJSScene=function(){this.camera=new e.OrthographicCamera(-this.canvas.width/2,this.canvas.width/2,this.canvas.height/2,-this.canvas.height/2,0,30),this.scene=new e.Scene,this.texture=new e.Texture(this.canvas);var t=new e.MeshBasicMaterial({map:this.texture});t.transparent=!0;var i=new e.PlaneGeometry(this.canvas.width,this.canvas.height);this.plane=new e.Mesh(i,t),this.plane.matrixAutoUpdate=!1,this.scene.add(this.plane)},f.prototype.resize=function(){this.width=800,this.height=400,this.shouldReDraw=!0},f.prototype.draw=function(){if(this.shouldReDraw){this.clearRect||this.context.clearRect(0,0,this.canvas.width,this.canvas.height);for(var e=this.displayObjects.length,t=0;t<e;t++)this.displayObjects[t].render(this.context);this.renderOnQuad&&(this.texture.needsUpdate=!0),this.shouldReDraw=!1}},f.prototype.render=function(e){this.draw(),this.renderOnQuad&&e.render(this.scene,this.camera),this.colorReplace&&(this.context.save(),this.context.fillStyle=this.colorReplace,this.context.globalCompositeOperation="source-atop",this.context.fillRect(0,0,this.canvas.width,this.canvas.height),this.context.restore())},f.prototype.createSprite=function(e,t,i,n,a){var r=new h.a(this,e,t,i,n,a);return this.displayObjects.push(r),c(r,this),r},f.prototype.createSpriteFromSheet=function(e,t,i,n,a,r,o){var s=new h.a(this,e,n,a,r,o,t,i);return this.displayObjects.push(s),c(s,this),s},f.prototype.createRectangle=function(e,t,i,n,a){var r=new s.a(this,e,t,i,n,a);return this.displayObjects.push(r),c(r,this),r},f.prototype.createText=function(e,t,i,n,a){var r=new l.a(this,e,t,i,n,a);return this.displayObjects.push(r),c(r,this),r},f.prototype.createBitmapText=function(e,t,i,n,a,r){var s=new o.a(this,e,t,i,n,a,r);return this.displayObjects.push(s),c(s,this),s},f.prototype.addEventListener=function(e,t,i){this.eventListeners[e].push({callback:t,displayObject:i})},f.prototype.clickHandler=function(e,t){var i={x:e,y:t},n=[];this.eventListeners.click.forEach(function(e){var t=e.displayObject;if(t.shouldReceiveEvents()){var a=t.getBounds();f.isInBoundingBox(i.x,i.y,a.x,a.y,a.width,a.height)&&n.push(e.callback)}});var a=!1;return n.forEach(function(e){e(),a=!0}),a},f.prototype.windowToUISpace=function(e,t){var i=this.gameCanvas.getBoundingClientRect(),n=this.height/i.height;return{x:(e-i.left)*n,y:(t-i.top)*n}},f.prototype.moveToFront=function(e){var t=this.displayObjects.indexOf(e);t>-1&&this.displayObjects.splice(t,1),this.displayObjects.push(e)},f.isInBoundingBox=function(e,t,i,n,a,r){return e>=i&&e<=i+a&&t>=n&&t<=n+r},t.a=f}).call(t,i("Ml+6"))},B4O8:function(e,t){e.exports={id:"item-cake",width:24,height:24,animations:{idle:{length:3,row:0}},offset_x:-4,offset_y:-6}},BvGv:function(e,t){e.exports={id:"item-mailarmor",width:16,height:16,animations:{idle:{length:6,row:0}},offset_x:0,offset_y:0}},C37V:function(e,t){e.exports={id:"goblin",width:26,height:26,animations:{atk_right:{length:3,row:0},walk_right:{length:3,row:1},idle_right:{length:2,row:2},atk_up:{length:3,row:3},walk_up:{length:4,row:4},idle_up:{length:2,row:5},atk_down:{length:3,row:6},walk_down:{length:4,row:7},idle_down:{length:2,row:8}},offset_x:-5,offset_y:-9}},DwfQ:function(e,t,i){"use strict";(function(e){var n=i("Zx67"),a=i.n(n),r=i("Zrlr"),o=i.n(r),s=i("wxAW"),h=i.n(s),l=i("zwoO"),u=i.n(l),d=i("Pf15"),c=i.n(d),f=function(t){function i(e,t){o()(this,i);var n=u()(this,(i.__proto__||a()(i)).call(this,e,t));return n.load(),n}return c()(i,t),h()(i,[{key:"load",value:function(){var t=new e.BoxBufferGeometry(8,8,8),i=new e.MeshLambertMaterial({color:16777215}),n=new e.Mesh(t,i);t.computeBoundingBox(),this.mesh=n,this.offset={x:0,y:-t.boundingBox.min.y,z:0},this.isLoaded=!0}},{key:"attachPointLight",value:function(t,i,n){var a=new e.PointLight(t,i,n);a.position.set(0,10,0),a.castShadow=!0,this.mesh.add(a)}}]),i}(i("m3jU").a);t.a=f}).call(t,i("Ml+6"))},"F+2f":function(e,t){e.exports={id:"test2",width:24,height:50,animations:{walk_right:{length:4,row:2},idle_right:{length:4,row:2},walk_up:{length:4,row:1},idle_up:{length:4,row:1},walk_down:{length:4,row:0},idle_down:{length:4,row:0}},offset_x:0,offset_y:-21}},GoZD:function(e,t,i){"use strict";var n=i("Zrlr"),a=i.n(n),r=i("wxAW"),o=i.n(r);
/**
 * A* (A-Star) algorithm for a path finder
 * @author  Andrea Giammarchi
 * @license Mit Style License
 */
function s(e,t,i,n,a,r,o,s,h,l,u,d,c){return e&&(i&&!h[a][o]&&(d[c++]={x:o,y:a}),n&&!h[a][s]&&(d[c++]={x:s,y:a})),t&&(i&&!h[r][o]&&(d[c++]={x:o,y:r}),n&&!h[r][s]&&(d[c++]={x:s,y:r})),d}function h(e,t,i,n,a,r,o,s,h,l,u,d,c){return e=a>-1,t=r<l,n=s>-1,o<u&&(e&&!h[a][o]&&(d[c++]={x:o,y:a}),t&&!h[r][o]&&(d[c++]={x:o,y:r})),n&&(e&&!h[a][s]&&(d[c++]={x:s,y:a}),t&&!h[r][s]&&(d[c++]={x:s,y:r})),d}function l(e,t,i,n,a,r,o,s,h,l,u,d,c){return d}function u(e,t,i,n,a,r){var o=i-1,s=i+1,h=t+1,l=t-1,u=o>-1&&!n[o][t],d=s<a&&!n[s][t],c=h<r&&!n[i][h],f=l>-1&&!n[i][l],p=[],g=0;return u&&(p[g++]={x:t,y:o}),c&&(p[g++]={x:h,y:i}),d&&(p[g++]={x:t,y:s}),f&&(p[g++]={x:l,y:i}),e(u,d,c,f,o,s,h,l,n,a,r,p,g)}function d(e,t,i,n){return n(i(e.x-t.x),i(e.y-t.y))}function c(e,t,i,n){var a=e.x-t.x,r=e.y-t.y;return n(a*a+r*r)}function f(e,t,i,n){return i(e.x-t.x)+i(e.y-t.y)}var p=function(e,t,i,n){var a,r,o,p,g,m,w,v,y,_=e[0].length,x=e.length,k=_*x,b=Math.abs,S=Math.max,M={},T=[],A=[{x:t[0],y:t[1],f:0,g:0,v:t[0]+t[1]*_}],E=1;switch(i={x:i[0],y:i[1],v:i[0]+i[1]*_},n){case"Diagonal":o=s;case"DiagonalFree":r=d;break;case"Euclidean":o=s;case"EuclideanFree":S=Math.sqrt,r=c;break;default:r=f,o=l}o||(o=h);do{for(m=k,w=0,p=0;p<E;++p)(n=A[p].f)<m&&(m=n,w=p);if((v=A.splice(w,1)[0]).v!=i.v)for(--E,p=0,g=(y=u(o,v.x,v.y,e,x,_)).length;p<g;++p)(a=y[p]).p=v,a.f=a.g=0,a.v=a.x+a.y*_,a.v in M||(a.f=(a.g=v.g+r(a,v,b,S))+r(a,i,b,S),A[E++]=a,M[a.v]=1);else{p=E=0;do{T[p++]=[v.x,v.y]}while(v=v.p);T.reverse()}}while(E);return T},g=function(){function e(t,i){a()(this,e),this.width=t,this.height=i,this.grid=null,this.ignored=[],this.initBlankGrid()}return o()(e,[{key:"initBlankGrid",value:function(){this.blankGrid=[];for(var e=0;e<this.height;e+=1){this.blankGrid[e]=[];for(var t=0;t<this.width;t+=1)this.blankGrid[e][t]=0}}},{key:"findPath",value:function(e,t,i,n,a){var r=[t.gridX,t.gridY],o=[i,n];this.grid=e;var s=p(this.grid,r,o);return 0===s.length&&!0===a&&(s=this.findIncompletePath_(r,o)),s}},{key:"findIncompletePath_",value:function(e,t){for(var i,n=void 0,a=void 0,r=[],o=(i=p(this.blankGrid,e,t)).length-1;o>0;o-=1)if(n=i[o][0],a=i[o][1],0===this.grid[a][n]){r=p(this.grid,e,[n,a]);break}return r}},{key:"ignoreEntity",value:function(e){e&&this.ignored.push(e)}},{key:"clearIgnoreList",value:function(){this.applyIgnoreList_(!1),this.ignored=[]}}]),e}();t.a=g},H7Qu:function(e,t){e.exports={id:"sword2",width:48,height:48,animations:{atk_right:{length:5,row:0},walk_right:{length:4,row:1},idle_right:{length:2,row:2},atk_up:{length:5,row:3},walk_up:{length:4,row:4},idle_up:{length:2,row:5},atk_down:{length:5,row:6},walk_down:{length:4,row:7},idle_down:{length:2,row:8}},offset_x:-16,offset_y:-20}},HITf:function(e,t){e.exports={id:"item-axe",width:16,height:16,animations:{idle:{length:6,row:0}},offset_x:0,offset_y:0}},"IJ/y":function(e,t){e.exports={id:"redsword",width:48,height:48,animations:{atk_right:{length:5,row:0},walk_right:{length:4,row:1},idle_right:{length:2,row:2},atk_up:{length:5,row:3},walk_up:{length:4,row:4},idle_up:{length:2,row:5},atk_down:{length:5,row:6},walk_down:{length:4,row:7},idle_down:{length:2,row:8}},offset_x:-16,offset_y:-20}},INyW:function(e,t){e.exports={id:"test4",width:72,height:48,animations:{attack_ready:{length:3,row:0},attack:{length:3,row:1}},offset_x:0,offset_y:-22}},ITPp:function(e,t,i){"use strict";(function(e,n,a){var r=i("BO1k"),o=i.n(r),s=i("Zrlr"),h=i.n(s),l=i("wxAW"),u=i.n(l),d=(i("N9/5"),function(e){return e%1==0}),c=function(){function t(e){h()(this,t),this.loadMap()}return u()(t,[{key:"loadMap",value:function(){var t=this;e.get("static/maps.json",function(e){t._rawData=e,t.tilesheet=new Image,t.tilesheet.src="static/tilesheet.png",t.tilesheet.onload=function(){t.isLoaded=!0}},"json")}},{key:"initByName",value:function(e){if(e in this._rawData){var t=this._rawData[e];this._initMap(t),this._generateCollisionGrid(),this._buildMesh()}}},{key:"_initMap",value:function(e){this.width=e.width,this.height=e.height,this.data=e.data,this.tilesize=e.tilesize,this.collisions=e.collisions,this.props=e.props,this.portals={};var t=!0,i=!1,n=void 0;try{for(var a,r=o()(e.portals);!(t=(a=r.next()).done);t=!0){var s=a.value;this.portals[s.x+s.y*this.width]=s}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}}},{key:"_generateCollisionGrid",value:function(){var e=this;this.grid=[];for(var t=0;t<this.height;t++){this.grid[t]=[];for(var i=0;i<this.width;i++)this.grid[t][i]=0}n.each(this.collisions,function(t){var i=e.tileIndexToGridPosition(t);e.grid[i.y][i.x]=1})}},{key:"isColliding",value:function(e,t){return!(this.isOutOfBounds(e,t)||!this.grid)&&1===this.grid[t][e]}},{key:"isOutOfBounds",value:function(e,t){return d(e)&&d(t)&&(e<0||e>=this.width||t<0||t>=this.height)}},{key:"tileIndexToGridPosition",value:function(e){return{x:e%this.width,y:Math.floor(e/this.width)}}},{key:"GridPositionToTileIndex",value:function(e,t){return t*this.width+e}},{key:"isPortal",value:function(e,t){return this.GridPositionToTileIndex(e,t)in this.portals}},{key:"getPortalDestination",value:function(e,t){var i=this.GridPositionToTileIndex(e,t);return this.portals[i].target}},{key:"_buildMesh",value:function(){for(var e=new a.PlaneGeometry(this.width*this.tilesize,this.height*this.tilesize,this.width,this.height),t=this.tilesize,i=this.tilesheet.width,n=this.tilesheet.height,r=t/i,o=-t/n,s=i/t,h=0;h<this.height;h++)for(var l=0;l<this.width;l++){var u=h*this.width+l,d=this.data[h][l],c=d%s*t/i,f=1-Math.floor(d/s)*t/n;e.faceVertexUvs[0][2*u][0]=new a.Vector2(c,f),e.faceVertexUvs[0][2*u][1]=new a.Vector2(c,f+o),e.faceVertexUvs[0][2*u][2]=new a.Vector2(c+r,f),e.faceVertexUvs[0][2*u+1][0]=new a.Vector2(c,f+o),e.faceVertexUvs[0][2*u+1][1]=new a.Vector2(c+r,f+o),e.faceVertexUvs[0][2*u+1][2]=new a.Vector2(c+r,f)}var p=new a.Texture;p.image=this.tilesheet,p.format=a.RGBAFormat,p.needsUpdate=!0;var g=new a.MeshStandardMaterial({transparent:!0,map:p});g.roughness=.9,g.metalness=0;var m=new a.Mesh(e,g);m.receiveShadow=!0,m.rotation.order="YXZ",m.rotation.x=-Math.PI/2,m.position.y=1,e.computeBoundingBox(),this.offset={x:e.boundingBox.min.x,y:e.boundingBox.min.y},this.mesh=m}}]),t}();t.a=c}).call(t,i("7t+N"),i("rdLu"),i("Ml+6"))},JYMs:function(e,t){e.exports={id:"leatherarmor",width:32,height:32,animations:{atk_right:{length:5,row:0},walk_right:{length:4,row:1},idle_right:{length:2,row:2},atk_up:{length:5,row:3},walk_up:{length:4,row:4},idle_up:{length:2,row:5},atk_down:{length:5,row:6},walk_down:{length:4,row:7},idle_down:{length:2,row:8}},offset_x:-8,offset_y:-12}},KD9h:function(e,t){e.exports={id:"villagegirl",width:24,height:24,animations:{idle_down:{length:2,row:0}},offset_x:-4,offset_y:-8}},L0hz:function(e,t){e.exports={id:"platearmor",width:32,height:32,animations:{atk_right:{length:5,row:0},walk_right:{length:4,row:1},idle_right:{length:2,row:2},atk_up:{length:5,row:3},walk_up:{length:4,row:4},idle_up:{length:2,row:5},atk_down:{length:5,row:6},walk_down:{length:4,row:7},idle_down:{length:2,row:8}},offset_x:-8,offset_y:-12}},LsZA:function(e,t){e.exports={id:"item-clotharmor",width:16,height:16,animations:{idle:{length:6,row:0}},offset_x:0,offset_y:0}},Lx20:function(e,t){e.exports={id:"wizard",width:26,height:26,animations:{death:{length:3,row:0},atk_right:{length:4,row:1},atk_up:{length:4,row:2},atk_down:{length:4,row:3},walk_right:{length:4,row:4},walk_up:{length:4,row:5},walk_down:{length:4,row:6},idle_right:{length:6,row:7},idle_up:{length:6,row:8},idle_down:{length:6,row:9}},offset_x:-5,offset_y:-9}},"N9/5":function(e,t,i){"use strict";(function(e){var n=i("fZjL"),a=i.n(n),r=i("pFYg"),o=i.n(r),s=i("OvRC"),h=i.n(s),l=i("//Fk"),u=i.n(l),d=i("Zrlr"),c=i.n(d),f=i("wxAW"),p=i.n(f),g=function(){function t(i){c()(this,t),this.manager=void 0!==i?i:e.DefaultLoadingManager,this.dracoLoader=null,this.crossOrigin="anonymous"}return p()(t,[{key:"load",value:function(t,i,n,a){var r,o=this;r=void 0!==this.resourcePath?this.resourcePath:void 0!==this.path?this.path:e.LoaderUtils.extractUrlBase(t),o.manager.itemStart(t);var s=function(e){a?a(e):console.error(e),o.manager.itemError(t),o.manager.itemEnd(t)},h=new e.FileLoader(o.manager);h.setPath(this.path),h.setResponseType("arraybuffer"),h.load(t,function(e){try{o.parse(e,r,function(e){i(e),o.manager.itemEnd(t)},s)}catch(e){s(e)}},n,s)}},{key:"setCrossOrigin",value:function(e){return this.crossOrigin=e,this}},{key:"setPath",value:function(e){return this.path=e,this}},{key:"setResourcePath",value:function(e){return this.resourcePath=e,this}},{key:"setDRACOLoader",value:function(e){return this.dracoLoader=e,this}},{key:"parse",value:function(t,i,n,a){var r,o={};if("string"==typeof t)r=t;else if(e.LoaderUtils.decodeText(new Uint8Array(t,0,4))===x){try{o[w.KHR_BINARY_GLTF]=new function(t){this.name=w.KHR_BINARY_GLTF,this.content=null,this.body=null;var i=new DataView(t,0,k);if(this.header={magic:e.LoaderUtils.decodeText(new Uint8Array(t.slice(0,4))),version:i.getUint32(4,!0),length:i.getUint32(8,!0)},this.header.magic!==x)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected. Use LegacyGLTFLoader instead.");var n=new DataView(t,k),a=0;for(;a<n.byteLength;){var r=n.getUint32(a,!0);a+=4;var o=n.getUint32(a,!0);if(a+=4,o===b.JSON){var s=new Uint8Array(t,k+a,r);this.content=e.LoaderUtils.decodeText(s)}else if(o===b.BIN){var h=k+a;this.body=t.slice(h,h+r)}a+=r}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}(t)}catch(e){return void(a&&a(e))}r=o[w.KHR_BINARY_GLTF].content}else r=e.LoaderUtils.decodeText(new Uint8Array(t));var s=JSON.parse(r);if(void 0===s.asset||s.asset.version[0]<2)a&&a(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported. Use LegacyGLTFLoader instead."));else{if(s.extensionsUsed)for(var h=0;h<s.extensionsUsed.length;++h){var l=s.extensionsUsed[h],u=s.extensionsRequired||[];switch(l){case w.KHR_LIGHTS_PUNCTUAL:o[l]=new y(s);break;case w.KHR_MATERIALS_UNLIT:o[l]=new _(s);break;case w.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:o[l]=new T(s);break;case w.KHR_DRACO_MESH_COMPRESSION:o[l]=new S(s,this.dracoLoader);break;case w.MSFT_TEXTURE_DDS:o[w.MSFT_TEXTURE_DDS]=new v;break;case w.KHR_TEXTURE_TRANSFORM:o[w.KHR_TEXTURE_TRANSFORM]=new M(s);break;default:u.indexOf(l)>=0&&console.warn('THREE.GLTFLoader: Unknown extension "'+l+'".')}}var d=new ee(s,o,{path:i||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager});d.parse(function(e,t,i,a,r){var s={scene:e,scenes:t,cameras:i,animations:a,asset:r.asset,parser:d,userData:{}};Z(o,s,r),n(s)},a)}}}]),t}();t.a=g;var m=function(){function e(){c()(this,e),this.objects={}}return p()(e,[{key:"get",value:function(e){return this.objects[e]}},{key:"add",value:function(e,t){this.objects[e]=t}},{key:"remove",value:function(e){delete this.objects[e]}},{key:"removeAll",value:function(){this.objects={}}}]),e}(),w={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function v(){if(!e.DDSLoader)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing THREE.DDSLoader");this.name=w.MSFT_TEXTURE_DDS,this.ddsLoader=new e.DDSLoader}function y(e){this.name=w.KHR_LIGHTS_PUNCTUAL;var t=e.extensions&&e.extensions[w.KHR_LIGHTS_PUNCTUAL]||{};this.lightDefs=t.lights||[]}function _(e){this.name=w.KHR_MATERIALS_UNLIT}y.prototype.loadLight=function(t){var i,n=this.lightDefs[t],a=new e.Color(16777215);void 0!==n.color&&a.fromArray(n.color);var r=void 0!==n.range?n.range:0;switch(n.type){case"directional":(i=new e.DirectionalLight(a)).target.position.set(0,0,-1),i.add(i.target);break;case"point":(i=new e.PointLight(a)).distance=r;break;case"spot":(i=new e.SpotLight(a)).distance=r,n.spot=n.spot||{},n.spot.innerConeAngle=void 0!==n.spot.innerConeAngle?n.spot.innerConeAngle:0,n.spot.outerConeAngle=void 0!==n.spot.outerConeAngle?n.spot.outerConeAngle:Math.PI/4,i.angle=n.spot.outerConeAngle,i.penumbra=1-n.spot.innerConeAngle/n.spot.outerConeAngle,i.target.position.set(0,0,-1),i.add(i.target);break;default:throw new Error('THREE.GLTFLoader: Unexpected light type, "'+n.type+'".')}return i.position.set(0,0,0),i.decay=2,void 0!==n.intensity&&(i.intensity=n.intensity),i.name=n.name||"light_"+t,u.a.resolve(i)},_.prototype.getMaterialType=function(t){return e.MeshBasicMaterial},_.prototype.extendParams=function(t,i,n){var a=[];t.color=new e.Color(1,1,1),t.opacity=1;var r=i.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){var o=r.baseColorFactor;t.color.fromArray(o),t.opacity=o[3]}void 0!==r.baseColorTexture&&a.push(n.assignTexture(t,"map",r.baseColorTexture))}return u.a.all(a)};var x="glTF",k=12,b={JSON:1313821514,BIN:5130562};function S(t,i){if(!i)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=w.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=i,e.DRACOLoader.getDecoderModule()}function M(e){this.name=w.KHR_TEXTURE_TRANSFORM}function T(){return{name:w.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return e.ShaderMaterial},extendParams:function(t,i,n){var a=i.extensions[this.name],r=e.ShaderLib.standard,o=e.UniformsUtils.clone(r.uniforms),s=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),h=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),l=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),d=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),c=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","material.specularRoughness = clamp( 1.0 - glossinessFactor, 0.04, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n"),f=r.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",s).replace("#include <metalnessmap_pars_fragment>",h).replace("#include <roughnessmap_fragment>",l).replace("#include <metalnessmap_fragment>",d).replace("#include <lights_physical_fragment>",c);delete o.roughness,delete o.metalness,delete o.roughnessMap,delete o.metalnessMap,o.specular={value:(new e.Color).setHex(1118481)},o.glossiness={value:.5},o.specularMap={value:null},o.glossinessMap={value:null},t.vertexShader=r.vertexShader,t.fragmentShader=f,t.uniforms=o,t.defines={STANDARD:""},t.color=new e.Color(1,1,1),t.opacity=1;var p=[];if(Array.isArray(a.diffuseFactor)){var g=a.diffuseFactor;t.color.fromArray(g),t.opacity=g[3]}if(void 0!==a.diffuseTexture&&p.push(n.assignTexture(t,"map",a.diffuseTexture)),t.emissive=new e.Color(0,0,0),t.glossiness=void 0!==a.glossinessFactor?a.glossinessFactor:1,t.specular=new e.Color(1,1,1),Array.isArray(a.specularFactor)&&t.specular.fromArray(a.specularFactor),void 0!==a.specularGlossinessTexture){var m=a.specularGlossinessTexture;p.push(n.assignTexture(t,"glossinessMap",m)),p.push(n.assignTexture(t,"specularMap",m))}return u.a.all(p)},createMaterial:function(t){var i=new e.ShaderMaterial({defines:t.defines,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:t.uniforms,fog:!0,lights:!0,opacity:t.opacity,transparent:t.transparent});return i.isGLTFSpecularGlossinessMaterial=!0,i.color=t.color,i.map=void 0===t.map?null:t.map,i.lightMap=null,i.lightMapIntensity=1,i.aoMap=void 0===t.aoMap?null:t.aoMap,i.aoMapIntensity=1,i.emissive=t.emissive,i.emissiveIntensity=1,i.emissiveMap=void 0===t.emissiveMap?null:t.emissiveMap,i.bumpMap=void 0===t.bumpMap?null:t.bumpMap,i.bumpScale=1,i.normalMap=void 0===t.normalMap?null:t.normalMap,t.normalScale&&(i.normalScale=t.normalScale),i.displacementMap=null,i.displacementScale=1,i.displacementBias=0,i.specularMap=void 0===t.specularMap?null:t.specularMap,i.specular=t.specular,i.glossinessMap=void 0===t.glossinessMap?null:t.glossinessMap,i.glossiness=t.glossiness,i.alphaMap=null,i.envMap=void 0===t.envMap?null:t.envMap,i.envMapIntensity=1,i.refractionRatio=.98,i.extensions.derivatives=!0,i},cloneMaterial:function(e){var t=e.clone();t.isGLTFSpecularGlossinessMaterial=!0;for(var i=this.specularGlossinessParams,n=0,a=i.length;n<a;n++)t[i[n]]=e[i[n]];return t},refreshUniforms:function(e,t,i,n,a,r){if(!0===a.isGLTFSpecularGlossinessMaterial){var o,s=a.uniforms,h=a.defines;s.opacity.value=a.opacity,s.diffuse.value.copy(a.color),s.emissive.value.copy(a.emissive).multiplyScalar(a.emissiveIntensity),s.map.value=a.map,s.specularMap.value=a.specularMap,s.alphaMap.value=a.alphaMap,s.lightMap.value=a.lightMap,s.lightMapIntensity.value=a.lightMapIntensity,s.aoMap.value=a.aoMap,s.aoMapIntensity.value=a.aoMapIntensity,a.map?o=a.map:a.specularMap?o=a.specularMap:a.displacementMap?o=a.displacementMap:a.normalMap?o=a.normalMap:a.bumpMap?o=a.bumpMap:a.glossinessMap?o=a.glossinessMap:a.alphaMap?o=a.alphaMap:a.emissiveMap&&(o=a.emissiveMap),void 0!==o&&(o.isWebGLRenderTarget&&(o=o.texture),!0===o.matrixAutoUpdate&&o.updateMatrix(),s.uvTransform.value.copy(o.matrix)),a.envMap&&(s.envMap.value=a.envMap,s.envMapIntensity.value=a.envMapIntensity,s.flipEnvMap.value=a.envMap.isCubeTexture?-1:1,s.reflectivity.value=a.reflectivity,s.refractionRatio.value=a.refractionRatio,s.maxMipLevel.value=e.properties.get(a.envMap).__maxMipLevel),s.specular.value.copy(a.specular),s.glossiness.value=a.glossiness,s.glossinessMap.value=a.glossinessMap,s.emissiveMap.value=a.emissiveMap,s.bumpMap.value=a.bumpMap,s.normalMap.value=a.normalMap,s.displacementMap.value=a.displacementMap,s.displacementScale.value=a.displacementScale,s.displacementBias.value=a.displacementBias,null!==s.glossinessMap.value&&void 0===h.USE_GLOSSINESSMAP&&(h.USE_GLOSSINESSMAP="",h.USE_ROUGHNESSMAP=""),null===s.glossinessMap.value&&void 0!==h.USE_GLOSSINESSMAP&&(delete h.USE_GLOSSINESSMAP,delete h.USE_ROUGHNESSMAP)}}}}function A(t,i,n,a){e.Interpolant.call(this,t,i,n,a)}S.prototype.decodePrimitive=function(e,t){var i=this.json,n=this.dracoLoader,a=e.extensions[this.name].bufferView,r=e.extensions[this.name].attributes,o={},s={},h={};for(var l in r)l in U&&(o[U[l]]=r[l]);for(l in e.attributes)if(void 0!==U[l]&&void 0!==r[l]){var d=i.accessors[e.attributes[l]],c=j[d.componentType];h[U[l]]=c,s[U[l]]=!0===d.normalized}return t.getDependency("bufferView",a).then(function(e){return new u.a(function(t){n.decodeDracoFile(e,function(e){for(var i in e.attributes){var n=e.attributes[i],a=s[i];void 0!==a&&(n.normalized=a)}t(e)},o,h)})})},M.prototype.extendTexture=function(e,t){return e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.needsUpdate=!0,e},A.prototype=h()(e.Interpolant.prototype),A.prototype.constructor=A,A.prototype.copySampleValue_=function(e){for(var t=this.resultBuffer,i=this.sampleValues,n=this.valueSize,a=e*n*3+n,r=0;r!==n;r++)t[r]=i[a+r];return t},A.prototype.beforeStart_=A.prototype.copySampleValue_,A.prototype.afterEnd_=A.prototype.copySampleValue_,A.prototype.interpolate_=function(e,t,i,n){for(var a=this.resultBuffer,r=this.sampleValues,o=this.valueSize,s=2*o,h=3*o,l=n-t,u=(i-t)/l,d=u*u,c=d*u,f=e*h,p=f-h,g=-2*c+3*d,m=c-d,w=1-g,v=m-d+u,y=0;y!==o;y++){var _=r[p+y+o],x=r[p+y+s]*l,k=r[f+y+o],b=r[f+y]*l;a[y]=w*_+v*x+g*k+m*b}return a};var E=0,R=1,L=2,D=3,F=4,I=5,P=6,j=(Number,e.Matrix3,e.Matrix4,e.Vector2,e.Vector3,e.Vector4,e.Texture,{5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array}),O={9728:e.NearestFilter,9729:e.LinearFilter,9984:e.NearestMipMapNearestFilter,9985:e.LinearMipMapNearestFilter,9986:e.NearestMipMapLinearFilter,9987:e.LinearMipMapLinearFilter},C={33071:e.ClampToEdgeWrapping,33648:e.MirroredRepeatWrapping,10497:e.RepeatWrapping},G=(e.BackSide,e.FrontSide,e.NeverDepth,e.LessDepth,e.EqualDepth,e.LessEqualDepth,e.GreaterEqualDepth,e.NotEqualDepth,e.GreaterEqualDepth,e.AlwaysDepth,e.AddEquation,e.SubtractEquation,e.ReverseSubtractEquation,e.ZeroFactor,e.OneFactor,e.SrcColorFactor,e.OneMinusSrcColorFactor,e.SrcAlphaFactor,e.OneMinusSrcAlphaFactor,e.DstAlphaFactor,e.OneMinusDstAlphaFactor,e.DstColorFactor,e.OneMinusDstColorFactor,e.SrcAlphaSaturateFactor,{SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16}),U={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},B={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},N={CUBICSPLINE:e.InterpolateSmooth,LINEAR:e.InterpolateLinear,STEP:e.InterpolateDiscrete},H="OPAQUE",z="MASK",V="BLEND",K={"image/png":e.RGBAFormat,"image/jpeg":e.RGBFormat};function X(e,t){return"string"!=typeof e||""===e?"":/^(https?:)?\/\//i.test(e)?e:/^data:.*,.*$/i.test(e)?e:/^blob:.*$/i.test(e)?e:t+e}function Z(e,t,i){for(var n in i.extensions)void 0===e[n]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[n]=i.extensions[n])}function W(e,t){void 0!==t.extras&&("object"===o()(t.extras)?e.userData=t.extras:console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function Y(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var i=0,n=t.weights.length;i<n;i++)e.morphTargetInfluences[i]=t.weights[i];if(t.extras&&Array.isArray(t.extras.targetNames)){var a=t.extras.targetNames;if(e.morphTargetInfluences.length===a.length){e.morphTargetDictionary={};for(i=0,n=a.length;i<n;i++)e.morphTargetDictionary[a[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function q(e,t){if(a()(e).length!==a()(t).length)return!1;for(var i in e)if(e[i]!==t[i])return!1;return!0}function Q(e){var t=e.extensions&&e.extensions[w.KHR_DRACO_MESH_COMPRESSION];return t?"draco:"+t.bufferView+":"+t.indices+":"+J(t.attributes):e.indices+":"+J(e.attributes)+":"+e.mode}function J(e){for(var t="",i=a()(e).sort(),n=0,r=i.length;n<r;n++)t+=i[n]+":"+e[i[n]]+";";return t}function $(t){if(t.isInterleavedBufferAttribute){for(var i=t.count,n=t.itemSize,a=t.array.slice(0,i*n),r=0,o=0;r<i;++r)a[o++]=t.getX(r),n>=2&&(a[o++]=t.getY(r)),n>=3&&(a[o++]=t.getZ(r)),n>=4&&(a[o++]=t.getW(r));return new e.BufferAttribute(a,n,t.normalized)}return t.clone()}function ee(t,i,n){this.json=t||{},this.extensions=i||{},this.options=n||{},this.cache=new m,this.primitiveCache={},this.multiplePrimitivesCache={},this.multiPassGeometryCache={},this.textureLoader=new e.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new e.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer")}function te(e,t,i){var n=t.attributes,a=[];function r(t,n){return i.getDependency("accessor",t).then(function(t){e.addAttribute(n,t)})}for(var o in n){var s=U[o];s&&(s in e.attributes||a.push(r(n[o],s)))}if(void 0!==t.indices&&!e.index){var h=i.getDependency("accessor",t.indices).then(function(t){e.setIndex(t)});a.push(h)}return W(e,t),u.a.all(a).then(function(){return void 0!==t.targets?function(e,t,i){for(var n=!1,a=!1,r=0,o=t.length;r<o&&(void 0!==(l=t[r]).POSITION&&(n=!0),void 0!==l.NORMAL&&(a=!0),!n||!a);r++);if(!n&&!a)return u.a.resolve(e);var s=[],h=[];for(r=0,o=t.length;r<o;r++){var l=t[r];if(n){var d=void 0!==l.POSITION?i.getDependency("accessor",l.POSITION).then(function(e){return $(e)}):e.attributes.position;s.push(d)}a&&(d=void 0!==l.NORMAL?i.getDependency("accessor",l.NORMAL).then(function(e){return $(e)}):e.attributes.normal,h.push(d))}return u.a.all([u.a.all(s),u.a.all(h)]).then(function(i){for(var r=i[0],o=i[1],s=0,h=t.length;s<h;s++){var l=t[s],u="morphTarget"+s;if(n&&void 0!==l.POSITION){var d=r[s];d.name=u;for(var c=e.attributes.position,f=0,p=d.count;f<p;f++)d.setXYZ(f,d.getX(f)+c.getX(f),d.getY(f)+c.getY(f),d.getZ(f)+c.getZ(f))}if(a&&void 0!==l.NORMAL){var g=o[s];g.name=u;var m=e.attributes.normal;for(f=0,p=g.count;f<p;f++)g.setXYZ(f,g.getX(f)+m.getX(f),g.getY(f)+m.getY(f),g.getZ(f)+m.getZ(f))}}return n&&(e.morphAttributes.position=r),a&&(e.morphAttributes.normal=o),e})}(e,t.targets,i):e})}ee.prototype.parse=function(e,t){var i=this.json;this.cache.removeAll(),this.markDefs(),this.getMultiDependencies(["scene","animation","camera"]).then(function(t){var n=t.scenes||[],a=n[i.scene||0],r=t.animations||[],o=t.cameras||[];e(a,n,o,r,i)}).catch(t)},ee.prototype.markDefs=function(){for(var e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[],n={},a={},r=0,o=t.length;r<o;r++)for(var s=t[r].joints,h=0,l=s.length;h<l;h++)e[s[h]].isBone=!0;for(var u=0,d=e.length;u<d;u++){var c=e[u];void 0!==c.mesh&&(void 0===n[c.mesh]&&(n[c.mesh]=a[c.mesh]=0),n[c.mesh]++,void 0!==c.skin&&(i[c.mesh].isSkinnedMesh=!0))}this.json.meshReferences=n,this.json.meshUses=a},ee.prototype.getDependency=function(e,t){var i=e+":"+t,n=this.cache.get(i);if(!n){switch(e){case"scene":n=this.loadScene(t);break;case"node":n=this.loadNode(t);break;case"mesh":n=this.loadMesh(t);break;case"accessor":n=this.loadAccessor(t);break;case"bufferView":n=this.loadBufferView(t);break;case"buffer":n=this.loadBuffer(t);break;case"material":n=this.loadMaterial(t);break;case"texture":n=this.loadTexture(t);break;case"skin":n=this.loadSkin(t);break;case"animation":n=this.loadAnimation(t);break;case"camera":n=this.loadCamera(t);break;case"light":n=this.extensions[w.KHR_LIGHTS_PUNCTUAL].loadLight(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(i,n)}return n},ee.prototype.getDependencies=function(e){var t=this.cache.get(e);if(!t){var i=this,n=this.json[e+("mesh"===e?"es":"s")]||[];t=u.a.all(n.map(function(t,n){return i.getDependency(e,n)})),this.cache.add(e,t)}return t},ee.prototype.getMultiDependencies=function(e){for(var t={},i=[],n=0,a=e.length;n<a;n++){var r=e[n],o=this.getDependencies(r);o=o.then(function(e,i){t[e]=i}.bind(this,r+("mesh"===r?"es":"s"))),i.push(o)}return u.a.all(i).then(function(){return t})},ee.prototype.loadBuffer=function(e){var t=this.json.buffers[e],i=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return u.a.resolve(this.extensions[w.KHR_BINARY_GLTF].body);var n=this.options;return new u.a(function(e,a){i.load(X(t.uri,n.path),e,void 0,function(){a(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})},ee.prototype.loadBufferView=function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(e){var i=t.byteLength||0,n=t.byteOffset||0;return e.slice(n,n+i)})},ee.prototype.loadAccessor=function(t){var i=this,n=this.json,a=this.json.accessors[t];if(void 0===a.bufferView&&void 0===a.sparse)return u.a.resolve(null);var r=[];return void 0!==a.bufferView?r.push(this.getDependency("bufferView",a.bufferView)):r.push(null),void 0!==a.sparse&&(r.push(this.getDependency("bufferView",a.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",a.sparse.values.bufferView))),u.a.all(r).then(function(t){var r,o,s=t[0],h=G[a.type],l=j[a.componentType],u=l.BYTES_PER_ELEMENT,d=u*h,c=a.byteOffset||0,f=void 0!==a.bufferView?n.bufferViews[a.bufferView].byteStride:void 0,p=!0===a.normalized;if(f&&f!==d){var g="InterleavedBuffer:"+a.bufferView+":"+a.componentType,m=i.cache.get(g);m||(r=new l(s),m=new e.InterleavedBuffer(r,f/u),i.cache.add(g,m)),o=new e.InterleavedBufferAttribute(m,h,c/u,p)}else r=null===s?new l(a.count*h):new l(s,c,a.count*h),o=new e.BufferAttribute(r,h,p);if(void 0!==a.sparse){var w=G.SCALAR,v=j[a.sparse.indices.componentType],y=a.sparse.indices.byteOffset||0,_=a.sparse.values.byteOffset||0,x=new v(t[1],y,a.sparse.count*w),k=new l(t[2],_,a.sparse.count*h);null!==s&&o.setArray(o.array.slice());for(var b=0,S=x.length;b<S;b++){var M=x[b];if(o.setX(M,k[b*h]),h>=2&&o.setY(M,k[b*h+1]),h>=3&&o.setZ(M,k[b*h+2]),h>=4&&o.setW(M,k[b*h+3]),h>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return o})},ee.prototype.loadTexture=function(t){var i,n=this,a=this.json,r=this.options,o=this.textureLoader,s=window.URL||window.webkitURL,h=a.textures[t],l=h.extensions||{},d=(i=l[w.MSFT_TEXTURE_DDS]?a.images[l[w.MSFT_TEXTURE_DDS].source]:a.images[h.source]).uri,c=!1;return void 0!==i.bufferView&&(d=n.getDependency("bufferView",i.bufferView).then(function(e){c=!0;var t=new Blob([e],{type:i.mimeType});return d=s.createObjectURL(t)})),u.a.resolve(d).then(function(t){var i=e.Loader.Handlers.get(t);return i||(i=l[w.MSFT_TEXTURE_DDS]?n.extensions[w.MSFT_TEXTURE_DDS].ddsLoader:o),new u.a(function(e,n){i.load(X(t,r.path),e,void 0,n)})}).then(function(t){!0===c&&s.revokeObjectURL(d),t.flipY=!1,void 0!==h.name&&(t.name=h.name),i.mimeType in K&&(t.format=K[i.mimeType]);var n=(a.samplers||{})[h.sampler]||{};return t.magFilter=O[n.magFilter]||e.LinearFilter,t.minFilter=O[n.minFilter]||e.LinearMipMapLinearFilter,t.wrapS=C[n.wrapS]||e.RepeatWrapping,t.wrapT=C[n.wrapT]||e.RepeatWrapping,t})},ee.prototype.assignTexture=function(t,i,n){var a=this;return this.getDependency("texture",n.index).then(function(r){switch(i){case"aoMap":case"emissiveMap":case"metalnessMap":case"normalMap":case"roughnessMap":r.format=e.RGBFormat}if(a.extensions[w.KHR_TEXTURE_TRANSFORM]){var o=void 0!==n.extensions?n.extensions[w.KHR_TEXTURE_TRANSFORM]:void 0;o&&(r=a.extensions[w.KHR_TEXTURE_TRANSFORM].extendTexture(r,o))}t[i]=r})},ee.prototype.loadMaterial=function(t){var i,n=this.json,a=this.extensions,r=n.materials[t],o={},s=r.extensions||{},h=[];if(s[w.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var l=a[w.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];i=l.getMaterialType(r),h.push(l.extendParams(o,r,this))}else if(s[w.KHR_MATERIALS_UNLIT]){var d=a[w.KHR_MATERIALS_UNLIT];i=d.getMaterialType(r),h.push(d.extendParams(o,r,this))}else{i=e.MeshStandardMaterial;var c=r.pbrMetallicRoughness||{};if(o.color=new e.Color(1,1,1),o.opacity=1,Array.isArray(c.baseColorFactor)){var f=c.baseColorFactor;o.color.fromArray(f),o.opacity=f[3]}void 0!==c.baseColorTexture&&h.push(this.assignTexture(o,"map",c.baseColorTexture)),o.metalness=void 0!==c.metallicFactor?c.metallicFactor:1,o.roughness=void 0!==c.roughnessFactor?c.roughnessFactor:1,void 0!==c.metallicRoughnessTexture&&(h.push(this.assignTexture(o,"metalnessMap",c.metallicRoughnessTexture)),h.push(this.assignTexture(o,"roughnessMap",c.metallicRoughnessTexture)))}!0===r.doubleSided&&(o.side=e.DoubleSide);var p=r.alphaMode||H;return p===V?o.transparent=!0:(o.transparent=!1,p===z&&(o.alphaTest=void 0!==r.alphaCutoff?r.alphaCutoff:.5)),void 0!==r.normalTexture&&i!==e.MeshBasicMaterial&&(h.push(this.assignTexture(o,"normalMap",r.normalTexture)),o.normalScale=new e.Vector2(1,1),void 0!==r.normalTexture.scale&&o.normalScale.set(r.normalTexture.scale,r.normalTexture.scale)),void 0!==r.occlusionTexture&&i!==e.MeshBasicMaterial&&(h.push(this.assignTexture(o,"aoMap",r.occlusionTexture)),void 0!==r.occlusionTexture.strength&&(o.aoMapIntensity=r.occlusionTexture.strength)),void 0!==r.emissiveFactor&&i!==e.MeshBasicMaterial&&(o.emissive=(new e.Color).fromArray(r.emissiveFactor)),void 0!==r.emissiveTexture&&i!==e.MeshBasicMaterial&&h.push(this.assignTexture(o,"emissiveMap",r.emissiveTexture)),u.a.all(h).then(function(){var t;return t=i===e.ShaderMaterial?a[w.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(o):new i(o),void 0!==r.name&&(t.name=r.name),t.map&&(t.map.encoding=e.sRGBEncoding),t.emissiveMap&&(t.emissiveMap.encoding=e.sRGBEncoding),t.specularMap&&(t.specularMap.encoding=e.sRGBEncoding),W(t,r),r.extensions&&Z(a,t,r),t})},ee.prototype.loadGeometries=function(t){var i,n=this,a=this.extensions,r=this.primitiveCache,o=function(e){if(e.length<2)return!1;var t=e[0],i=t.targets||[];if(void 0===t.indices)return!1;for(var n=1,a=e.length;n<a;n++){var r=e[n];if(t.mode!==r.mode)return!1;if(void 0===r.indices)return!1;if(r.extensions&&r.extensions[w.KHR_DRACO_MESH_COMPRESSION])return!1;if(!q(t.attributes,r.attributes))return!1;var o=r.targets||[];if(i.length!==o.length)return!1;for(var s=0,h=i.length;s<h;s++)if(!q(i[s],o[s]))return!1}return!0}(t);function s(e){return a[w.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,n).then(function(t){return te(t,e,n)})}o&&(i=t,t=[t[0]]);for(var h=[],l=0,d=t.length;l<d;l++){var c,f=t[l],p=Q(f),g=r[p];if(g)h.push(g.promise);else c=f.extensions&&f.extensions[w.KHR_DRACO_MESH_COMPRESSION]?s(f):te(new e.BufferGeometry,f,n),r[p]={primitive:f,promise:c},h.push(c)}return u.a.all(h).then(function(a){if(o){var r=a[0],s=n.multiPassGeometryCache,h=function(e,t){for(var i=e.uuid,n=0,a=t.length;n<a;n++)i+=n+Q(t[n]);return i}(r,i);if(null!==(g=s[h]))return[g.geometry];var l=new e.BufferGeometry;for(var d in l.name=r.name,l.userData=r.userData,r.attributes)l.addAttribute(d,r.attributes[d]);for(var d in r.morphAttributes)l.morphAttributes[d]=r.morphAttributes[d];for(var c=[],f=0,p=i.length;f<p;f++)c.push(n.getDependency("accessor",i[f].indices));return u.a.all(c).then(function(e){for(var t=[],n=0,a=0,o=i.length;a<o;a++){for(var u=e[a],d=0,c=u.count;d<c;d++)t.push(u.array[d]);l.addGroup(n,u.count,a),n+=u.count}return l.setIndex(t),s[h]={geometry:l,baseGeometry:r,primitives:i},[l]})}if(a.length>1&&void 0!==e.BufferGeometryUtils){for(f=1,p=t.length;f<p;f++)if(t[0].mode!==t[f].mode)return a;var g;s=n.multiplePrimitivesCache,h=function(e){for(var t="",i=0,n=e.length;i<n;i++)t+=":"+e[i].uuid;return t}(a);if(g=s[h]){if(null!==g.geometry)return[g.geometry]}else{l=e.BufferGeometryUtils.mergeBufferGeometries(a,!0);if(s[h]={geometry:l,baseGeometries:a},null!==l)return[l]}}return a})},ee.prototype.loadMesh=function(t){for(var i=this,n=this.json,r=this.extensions,o=n.meshes[t],s=o.primitives,h=[],l=0,d=s.length;l<d;l++){var c=void 0===s[l].material?new e.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:e.FrontSide}):this.getDependency("material",s[l].material);h.push(c)}return u.a.all(h).then(function(n){return i.loadGeometries(s).then(function(h){for(var l=1===h.length&&h[0].groups.length>0,u=[],d=0,c=h.length;d<c;d++){var f,p=h[d],g=s[d],m=l?n:n[d];if(g.mode===F||g.mode===I||g.mode===P||void 0===g.mode)!0===(f=!0===o.isSkinnedMesh?new e.SkinnedMesh(p,m):new e.Mesh(p,m)).isSkinnedMesh&&f.normalizeSkinWeights(),g.mode===I?f.drawMode=e.TriangleStripDrawMode:g.mode===P&&(f.drawMode=e.TriangleFanDrawMode);else if(g.mode===R)f=new e.LineSegments(p,m);else if(g.mode===D)f=new e.Line(p,m);else if(g.mode===L)f=new e.LineLoop(p,m);else{if(g.mode!==E)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+g.mode);f=new e.Points(p,m)}a()(f.geometry.morphAttributes).length>0&&Y(f,o),f.name=o.name||"mesh_"+t,h.length>1&&(f.name+="_"+d),W(f,o),u.push(f);for(var v=l?f.material:[f.material],y=void 0!==p.attributes.tangent,_=void 0!==p.attributes.color,x=void 0===p.attributes.normal,k=!0===f.isSkinnedMesh,b=a()(p.morphAttributes).length>0,S=b&&void 0!==p.morphAttributes.normal,M=0,T=v.length;M<T;M++){m=v[M];if(f.isPoints){var A="PointsMaterial:"+m.uuid,j=i.cache.get(A);j||(j=new e.PointsMaterial,e.Material.prototype.copy.call(j,m),j.color.copy(m.color),j.map=m.map,j.lights=!1,i.cache.add(A,j)),m=j}else if(f.isLine){A="LineBasicMaterial:"+m.uuid;var O=i.cache.get(A);O||(O=new e.LineBasicMaterial,e.Material.prototype.copy.call(O,m),O.color.copy(m.color),O.lights=!1,i.cache.add(A,O)),m=O}if(y||_||x||k||b){A="ClonedMaterial:"+m.uuid+":";m.isGLTFSpecularGlossinessMaterial&&(A+="specular-glossiness:"),k&&(A+="skinning:"),y&&(A+="vertex-tangents:"),_&&(A+="vertex-colors:"),x&&(A+="flat-shading:"),b&&(A+="morph-targets:"),S&&(A+="morph-normals:");var C=i.cache.get(A);C||(C=m.isGLTFSpecularGlossinessMaterial?r[w.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].cloneMaterial(m):m.clone(),k&&(C.skinning=!0),y&&(C.vertexTangents=!0),_&&(C.vertexColors=e.VertexColors),x&&(C.flatShading=!0),b&&(C.morphTargets=!0),S&&(C.morphNormals=!0),i.cache.add(A,C)),m=C}v[M]=m,m.aoMap&&void 0===p.attributes.uv2&&void 0!==p.attributes.uv&&(console.log("THREE.GLTFLoader: Duplicating UVs to support aoMap."),p.addAttribute("uv2",new e.BufferAttribute(p.attributes.uv.array,2))),m.isGLTFSpecularGlossinessMaterial&&(f.onBeforeRender=r[w.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].refreshUniforms)}f.material=l?v:v[0]}if(1===u.length)return u[0];var G=new e.Group;for(d=0,c=u.length;d<c;d++)G.add(u[d]);return G})})},ee.prototype.loadCamera=function(t){var i,n=this.json.cameras[t],a=n[n.type];if(a)return"perspective"===n.type?i=new e.PerspectiveCamera(e.Math.radToDeg(a.yfov),a.aspectRatio||1,a.znear||1,a.zfar||2e6):"orthographic"===n.type&&(i=new e.OrthographicCamera(a.xmag/-2,a.xmag/2,a.ymag/2,a.ymag/-2,a.znear,a.zfar)),void 0!==n.name&&(i.name=n.name),W(i,n),u.a.resolve(i);console.warn("THREE.GLTFLoader: Missing camera parameters.")},ee.prototype.loadSkin=function(e){var t=this.json.skins[e],i={joints:t.joints};return void 0===t.inverseBindMatrices?u.a.resolve(i):this.getDependency("accessor",t.inverseBindMatrices).then(function(e){return i.inverseBindMatrices=e,i})},ee.prototype.loadAnimation=function(t){for(var i=this.json.animations[t],n=[],a=[],r=[],o=[],s=[],h=0,l=i.channels.length;h<l;h++){var d=i.channels[h],c=i.samplers[d.sampler],f=d.target,p=void 0!==f.node?f.node:f.id,g=void 0!==i.parameters?i.parameters[c.input]:c.input,m=void 0!==i.parameters?i.parameters[c.output]:c.output;n.push(this.getDependency("node",p)),a.push(this.getDependency("accessor",g)),r.push(this.getDependency("accessor",m)),o.push(c),s.push(f)}return u.a.all([u.a.all(n),u.a.all(a),u.a.all(r),u.a.all(o),u.a.all(s)]).then(function(n){for(var a=n[0],r=n[1],o=n[2],s=n[3],h=n[4],l=[],u=0,d=a.length;u<d;u++){var c=a[u],f=r[u],p=o[u],g=s[u],m=h[u];if(void 0!==c){var w;switch(c.updateMatrix(),c.matrixAutoUpdate=!0,B[m.path]){case B.weights:w=e.NumberKeyframeTrack;break;case B.rotation:w=e.QuaternionKeyframeTrack;break;case B.position:case B.scale:default:w=e.VectorKeyframeTrack}var v=c.name?c.name:c.uuid,y=void 0!==g.interpolation?N[g.interpolation]:e.InterpolateLinear,_=[];B[m.path]===B.weights?c.traverse(function(e){!0===e.isMesh&&e.morphTargetInfluences&&_.push(e.name?e.name:e.uuid)}):_.push(v);for(var x=0,k=_.length;x<k;x++){var b=new w(_[x]+"."+B[m.path],e.AnimationUtils.arraySlice(f.array,0),e.AnimationUtils.arraySlice(p.array,0),y);"CUBICSPLINE"===g.interpolation&&(b.createInterpolant=function(e){return new A(this.times,this.values,this.getValueSize()/3,e)},b.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),l.push(b)}}}var S=void 0!==i.name?i.name:"animation_"+t;return new e.AnimationClip(S,void 0,l)})},ee.prototype.loadNode=function(t){var i=this.json,n=this.extensions,a=this,r=i.meshReferences,o=i.meshUses,s=i.nodes[t];return(!0===s.isBone?u.a.resolve(new e.Bone):void 0!==s.mesh?a.getDependency("mesh",s.mesh).then(function(e){var t;if(r[s.mesh]>1){var i=o[s.mesh]++;(t=e.clone()).name+="_instance_"+i,t.onBeforeRender=e.onBeforeRender;for(var n=0,a=t.children.length;n<a;n++)t.children[n].name+="_instance_"+i,t.children[n].onBeforeRender=e.children[n].onBeforeRender}else t=e;return void 0!==s.weights&&t.traverse(function(e){if(e.isMesh)for(var t=0,i=s.weights.length;t<i;t++)e.morphTargetInfluences[t]=s.weights[t]}),t}):void 0!==s.camera?a.getDependency("camera",s.camera):s.extensions&&s.extensions[w.KHR_LIGHTS_PUNCTUAL]&&void 0!==s.extensions[w.KHR_LIGHTS_PUNCTUAL].light?a.getDependency("light",s.extensions[w.KHR_LIGHTS_PUNCTUAL].light):u.a.resolve(new e.Object3D)).then(function(t){if(void 0!==s.name&&(t.name=e.PropertyBinding.sanitizeNodeName(s.name)),W(t,s),s.extensions&&Z(n,t,s),void 0!==s.matrix){var i=new e.Matrix4;i.fromArray(s.matrix),t.applyMatrix(i)}else void 0!==s.translation&&t.position.fromArray(s.translation),void 0!==s.rotation&&t.quaternion.fromArray(s.rotation),void 0!==s.scale&&t.scale.fromArray(s.scale);return t})},ee.prototype.loadScene=function(){function t(i,n,a,r){var o=a.nodes[i];return r.getDependency("node",i).then(function(t){return void 0===o.skin?t:r.getDependency("skin",o.skin).then(function(e){for(var t=[],n=0,a=(i=e).joints.length;n<a;n++)t.push(r.getDependency("node",i.joints[n]));return u.a.all(t)}).then(function(n){for(var a=!0===t.isGroup?t.children:[t],r=0,o=a.length;r<o;r++){for(var s=a[r],h=[],l=[],u=0,d=n.length;u<d;u++){var c=n[u];if(c){h.push(c);var f=new e.Matrix4;void 0!==i.inverseBindMatrices&&f.fromArray(i.inverseBindMatrices.array,16*u),l.push(f)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',i.joints[u])}s.bind(new e.Skeleton(h,l),s.matrixWorld)}return t});var i}).then(function(e){n.add(e);var i=[];if(o.children)for(var s=o.children,h=0,l=s.length;h<l;h++){var d=s[h];i.push(t(d,e,a,r))}return u.a.all(i)})}var i=this.json,n=this.extensions,a=this.json.scenes[0],r=new e.Scene;void 0!==a.name&&(r.name=a.name),W(r,a),a.extensions&&Z(n,r,a);for(var o=a.nodes||[],s=[],h=0,l=o.length;h<l;h++)s.push(t(o[h],r,i,this));return u.a.all(s).then(function(){return r})}}).call(t,i("Ml+6"))},NHnr:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){var t,n,a,r=i("cbRa"),o=i("c6m3");t=new r.a,n=new o.a,a=document.getElementById("canvas"),n.init(a),t.setGame(n),e("#foreground").click(function(t){var i=e("#canvas").offset(),a={};a.x=t.pageX-i.left,a.y=t.pageY-i.top,n.click(a.x,a.y)}),window.addEventListener("keydown",function(e){n.keyDown(e.keyCode)},!1),t.start("TEST")}.call(t,i("7t+N"))},NxES:function(e,t){e.exports={id:"spectre",width:34,height:34,animations:{atk_right:{length:8,row:0},walk_right:{length:4,row:1},idle_right:{length:2,row:2},atk_up:{length:6,row:3},walk_up:{length:8,row:4},idle_up:{length:8,row:5},atk_down:{length:6,row:6},walk_down:{length:4,row:7},idle_down:{length:2,row:8}},offset_x:-9,offset_y:-13}},OSyj:function(e,t,i){"use strict";var n=i("BO1k"),a=i.n(n),r=i("Zrlr"),o=i.n(r),s=i("wxAW"),h=i.n(s),l={linear:function(e){return e},outCubic:function(e){return(e-=1)*e*e+1},inCubic:function(e){return e*e*e},inOutCubic:function(e){return(e*=2)<1?e*e*e/2:((e-=2)*e*e+2)/2},inOutSine:function(e){return(1-Math.cos(Math.PI*e))/2},outExponential:function(e){return e<1?1-Math.pow(2,-10*e):1},outBounce:function(e){return e<4/11?121*e*e/16:e<8/11?9.075*e*e-9.9*e+3.4:e<.9?4356/361*e*e-35442/1805*e+16061/1805:10.8*e*e-20.52*e+10.72},outBack:function(e){var t=1.70158;return(e-=1)*e*((t+1)*e+t)+1}},u={Loop:1,Stop:2,Destory:3},d=function(){function e(){for(var t=arguments.length,i=Array(t),n=0;n<t;n++)i[n]=arguments[n];o()(this,e),Array.isArray(i)||(i=[i]),this._timelines=i,this._frame=0,this._playing=!1,this._stopHandler=null,this._mode=u.Stop;var r=0,s=!0,h=!1,l=void 0;try{for(var d,c=a()(i);!(s=(d=c.next()).done);s=!0){var f=d.value;r=Math.max(r,f.endFrame)}}catch(e){h=!0,l=e}finally{try{!s&&c.return&&c.return()}finally{if(h)throw l}}this._lastFrame=r}return h()(e,null,[{key:"Timeline",value:function(e,t,i,n){return Array.isArray(n)||(n=[n]),{startFrame:e,endFrame:t,mesh:i,tweens:n}}}]),h()(e,[{key:"playAndStop",value:function(e){this._playing=!0,this._mode=u.Stop,this._stopHandler=e}},{key:"playAndDestroy",value:function(e){this._playing=!0,this._mode=u.Destory,this._stopHandler=e}},{key:"playLoop",value:function(){this._playing=!0,this._mode=u.Loop}},{key:"update",value:function(){if(this._frame++,this._playing){if(this._frame>=this._lastFrame)switch(this._mode){case u.Loop:this._frame=1;break;case u.Destory:return void(this._stopHandler&&this._stopHandler());default:this._playing=!1,this._frame=this._lastFrame,this._stopHandler&&this._stopHandler()}var e=!0,t=!1,i=void 0;try{for(var n,r=a()(this._timelines);!(e=(n=r.next()).done);e=!0){var o=n.value;if(!(this._frame<o.startFrame||o.endFrame<this._frame)){var s=o.endFrame-o.startFrame,h=s>0?(this._frame-o.startFrame)/s:0,d=o.mesh,c=!0,f=!1,p=void 0;try{for(var g,m=a()(o.tweens);!(c=(g=m.next()).done);c=!0){var w=g.value,v=w[0],y=w[1],_=w[2],x=(0,l[w[3]])(h)*(_-y)+y;switch(v){case"scaleX":case"scaleY":case"scale":break;case"x":d.position.x=x;break;case"y":d.position.y=x;break;case"alpha":d.material.transparent=!0,d.material.opacity=x;break;case"rotation":image.setRotation(x)}}}catch(e){f=!0,p=e}finally{try{!c&&m.return&&m.return()}finally{if(f)throw p}}}}}catch(e){t=!0,i=e}finally{try{!e&&r.return&&r.return()}finally{if(t)throw i}}}}}]),e}();t.a=d},Oy9j:function(e,t){e.exports={id:"deathknight",width:42,height:42,animations:{atk_right:{length:5,row:0},walk_right:{length:4,row:1},idle_right:{length:2,row:2},atk_up:{length:5,row:3},walk_up:{length:4,row:4},idle_up:{length:2,row:5},atk_down:{length:5,row:6},walk_down:{length:4,row:7},idle_down:{length:2,row:8}},offset_x:-13,offset_y:-17}},PznX:function(e,t){e.exports={id:"eye",width:40,height:48,animations:{atk_right:{length:6,row:0},walk_right:{length:4,row:1},idle_right:{length:14,row:2},atk_up:{length:4,row:3},walk_up:{length:4,row:4},idle_up:{length:14,row:5},atk_down:{length:8,row:6},walk_down:{length:4,row:7},idle_down:{length:14,row:8}},offset_x:-12,offset_y:-18}},Qyla:function(e,t){e.exports={id:"target",width:16,height:16,animations:{move:{length:4,row:0},atk:{length:4,row:1}}}},RVzG:function(e,t){e.exports={id:"redarmor",width:32,height:32,animations:{atk_right:{length:5,row:0},walk_right:{length:4,row:1},idle_right:{length:2,row:2},atk_up:{length:5,row:3},walk_up:{length:4,row:4},idle_up:{length:2,row:5},atk_down:{length:5,row:6},walk_down:{length:4,row:7},idle_down:{length:2,row:8}},offset_x:-8,offset_y:-12}},RZ8U:function(e,t){e.exports={id:"item-redsword",width:16,height:16,animations:{idle:{length:6,row:0}},offset_x:0,offset_y:0}},RgGw:function(e,t){e.exports={id:"item-flask",width:16,height:16,animations:{idle:{length:6,row:0}},offset_x:0,offset_y:0}},"Rr+P":function(e,t,i){"use strict";var n=i("fZjL"),a=i.n(n),r=i("pFYg"),o=i.n(r),s=i("OvRC"),h=i.n(s),l=i("XDXK"),u=function(e,t,i,n,a,r,o){this.parseSheet(r,o),this.scale=void 0!==i?i:1,this.setText(t);n=void 0!==n?n:0,a=void 0!==a?a:0;var s=this.calculateDimensions();l.a.bind(this)(e,n,a,s.width,s.height),this.pivot.x=0,this.pivot.y=0};(u.prototype=h()(l.a.prototype)).setText=function(e){if(this.text!==e){this.text=void 0!==e?e.toString():"",this.characters=this.text.split("");var t=this.calculateDimensions();this.width=t.width,this.height=t.height}},u.prototype.parseSheet=function(e,t){if(void 0===e&&!this.sheet)throw new Error("Sheet image path missing when creating sprite from sheet");if(void 0===t&&!this.sheetData)throw new Error("Sheet data path missing when creating sprite from sheet");if(!e&&this.sheet||(this.sheet=AssetLoader.getAssetById(e)),!t&&this.sheetData||(this.sheetData=AssetLoader.getAssetById(t)),"object"!==o()(this.sheetData))throw new Error("Invalid sheet data "+t+" -- not an object");this.characterData={};for(var i=a()(this.sheetData),n=i.length,r=0;r<n;r++){var s=i[r],h=this.sheetData[s];h.uv0[0]=Math.min(1,Math.max(0,h.uv0[0])),h.uv0[1]=Math.min(1,Math.max(0,h.uv0[1])),h.uv1[0]=Math.min(1,Math.max(0,h.uv1[0])),h.uv1[1]=Math.min(1,Math.max(0,h.uv1[1])),this.characterData[s]={x:Math.round(h.uv0[0]*this.sheet.width),y:Math.round((1-h.uv0[1])*this.sheet.height),width:Math.round((h.uv1[0]-h.uv0[0])*this.sheet.width),height:Math.round((h.uv0[1]-h.uv1[1])*this.sheet.height)};var l=this.characterData[s];l.width=Math.max(1e-5,l.width),l.height=Math.max(1e-5,l.height)}},u.prototype.calculateDimensions=function(){for(var e={width:0,height:0},t=this.characters.length,i=0;i<t;i++){var n=this.characters[i];this.characterData[n]||(n=a()(this.characterData)[0]);var r=this.characterData[n];e.width+=r?r.width:0,e.height=Math.max(e.height,r?r.height:0)}return e.width*=this.scale,e.height*=this.scale,e},u.prototype.draw=function(e,t,i){for(var n=this.characters.length,a=0;a<n;a++){var r=this.characters[a],o=this.drawCharacter(e,r,t,i);t=o.x+o.width,i=o.y}},u.prototype.drawCharacter=function(e,t,i,n){var a=this.characterData[t],r=!1;void 0===a&&(a={width:6,height:6},r=!0);var o=a.width*this.scale,s=a.height*this.scale;return r||e.drawImage(this.sheet,a.x,a.y,a.width,a.height,i,n,o,s),{x:i,y:n,width:o,height:s}},t.a=u},SML3:function(e,t){e.exports={id:"item-goldenarmor",width:16,height:16,animations:{idle:{length:6,row:0}},offset_x:0,offset_y:0}},Sqs0:function(e,t){e.exports={id:"death",width:24,height:24,animations:{death:{length:6,row:0}},offset_x:-4,offset_y:-4}},TAbc:function(e,t,i){"use strict";var n=i("Zrlr"),a=i.n(n),r=i("wxAW"),o=i.n(r),s=function(){function e(){a()(this,e),this.startValue=0,this.endValue=0,this.duration=0,this.inProgress=!1}return o()(e,[{key:"start",value:function(e,t,i,n,a,r){this.startTime=e,this.updateFunction=t,this.stopFunction=i,this.startValue=n,this.endValue=a,this.duration=r,this.inProgress=!0,this.count=0}},{key:"step",value:function(e){if(this.inProgress)if(this.count>0)this.count-=1,log.debug(e+": jumped frame");else{var t=e-this.startTime;t>this.duration&&(t=this.duration);var i=this.endValue-this.startValue,n=this.startValue+i/this.duration*t;n=Math.round(n),t===this.duration||n===this.endValue?(this.stop(),this.stopFunction&&this.stopFunction()):this.updateFunction&&this.updateFunction(n)}}},{key:"restart",value:function(e,t,i){this.start(e,this.updateFunction,this.stopFunction,t,i,this.duration),this.step(e)}},{key:"stop",value:function(){this.inProgress=!1}}]),e}();t.a=s},Tb6K:function(e,t){e.exports={id:"lavanpc",width:24,height:24,animations:{idle_down:{length:2,row:0}},offset_x:-4,offset_y:-8}},UStB:function(e,t){e.exports={id:"goldenarmor",width:32,height:32,animations:{atk_right:{length:5,row:0},walk_right:{length:4,row:1},idle_right:{length:2,row:2},atk_up:{length:5,row:3},walk_up:{length:4,row:4},idle_up:{length:2,row:5},atk_down:{length:5,row:6},walk_down:{length:4,row:7},idle_down:{length:2,row:8}},offset_x:-8,offset_y:-12}},UcV4:function(e,t){e.exports={id:"crab",width:32,height:32,animations:{death:{length:8,row:0},atk_right:{length:7,row:1},walk_right:{length:6,row:2},idle_right:{length:4,row:3},atk_up:{length:8,row:4},idle_up:{length:4,row:5},walk_up:{length:6,row:6},atk_down:{length:8,row:7},walk_down:{length:6,row:8},idle_down:{length:7,row:9}},offset_x:-8,offset_y:-8}},"X+Uv":function(e,t,i){"use strict";(function(e){var n=i("Zrlr"),a=i.n(n),r=i("wxAW"),o=i.n(r),s=i("yh7f"),h=i("DwfQ"),l=i("ZQ2e"),u=i("zTqn"),d=function(){function t(){a()(this,t)}return o()(t,null,[{key:"createEntity",value:function(i,n,a){if(i){if(!e.isFunction(t.builders[i]))throw Error(i+" is not a valid Entity type");return t.builders[i](n,a)}}}]),t}();d.builders=[],d.builders[s.a.Entities.DEATHKNIGHT]=function(e){return new u.a(e,s.a.Entities.DEATHKNIGHT)},d.builders[s.a.Entities.CHEST]=function(e){return new l.a(e)},d.builders[s.a.Entities.FIRE]=function(e){var t=new h.a(e,s.a.Entities.FIRE);return t.attachPointLight(16760992,.5),t},t.a=d}).call(t,i("rdLu"))},XDXK:function(e,t,i){"use strict";var n=i("fZjL"),a=i.n(n),r=i("uL5Q"),o=function(e,t,i,n,a){this.ui=e,this.x=void 0!==t?t:0,this.y=void 0!==i?i:0,this.width=void 0!==n?n:0,this.height=void 0!==a?a:0,this.rotation=0,this.alpha=1,this.visible=!0,this.pivot={x:.5,y:.5},this.anchor={x:r.a.left,y:r.a.top},this.smoothing=!0,this.stretch={x:!1,y:!1},this.offset={left:0,top:0,right:0,bottom:0},this.parent=void 0};o.prototype.getBounds=function(){var e=this.determinePositionInCanvas(),t=this.determineDimensionsInCanvas();return{x:e.x,y:e.y,width:t.width,height:t.height}},o.prototype.getParentBounds=function(){if(void 0===this.parent)return{x:0,y:0,width:this.ui.width,height:this.ui.height};if(this.parent instanceof o)return this.parent.getBounds();throw new Error("DisplayObject.parent should always be an instance of DisplayObject")},o.prototype.determinePositionInCanvas=function(){var e={x:"number"==typeof this.x?this.x:0,y:"number"==typeof this.y?this.y:0};return e=this.adjustPositionForAnchor(e.x,e.y),e=this.adjustPositionForPivot(e.x,e.y)},o.prototype.determineDimensionsInCanvas=function(){return{width:"number"==typeof this.width?this.width:0,height:"number"==typeof this.height?this.height:0}},o.prototype.adjustPositionForAnchor=function(e,t){var i=this.getParentBounds();return this.anchor.x===r.a.left?e+=i.x:this.anchor.x===r.a.right?e+=i.x+i.width-this.width:this.anchor.x===r.a.center&&(e+=i.x+i.width/2-this.width/2),this.anchor.y===r.a.top?t+=i.y:this.anchor.y===r.a.bottom?t+=i.y+i.height-this.height:this.anchor.y===r.a.center&&(t+=i.y+i.height/2-this.height/2),{x:e,y:t}},o.prototype.getOffsetInCanvas=function(){for(var e,t={left:this.offset.left,top:this.offset.top,right:this.offset.right,bottom:this.offset.bottom},i=a()(t),n=i.length,r=0;r<n;r++){var o=i[r],s=t[o];if("number"!=typeof s){e=e||this.getParentBounds();var h=parseFloat(s.match(/^([0-9\.]+)%$/)[1]);t[o]=h/100*e.width}}return t},o.prototype.adjustPositionForPivot=function(e,t){return{x:e-=this.width*this.pivot.x,y:t-=this.height*this.pivot.y}},o.prototype.shouldReceiveEvents=function(){return this.visible},o.prototype.onClick=function(e){this.ui.addEventListener("click",e,this)},o.prototype.render=function(e){if(this.visible){e.save();var t=this.getBounds();e.globalAlpha=this.alpha,void 0!==e.mozImageSmoothingEnabled&&(e.mozImageSmoothingEnabled=this.smoothing),void 0!==e.webkitImageSmoothingEnabled&&(e.webkitImageSmoothingEnabled=this.smoothing),void 0!==e.msImageSmoothingEnabled&&(e.msImageSmoothingEnabled=this.smoothing),void 0!==e.imageSmoothingEnabled&&(e.imageSmoothingEnabled=this.smoothing),this.draw(e,t.x,t.y,t.width,t.height),e.restore()}},o.draw=function(e,t,i,n,a){},Object.defineProperty(o.prototype,"_proxied_visible",{get:function(){return!(this.parent&&this.parent!==this&&!this.parent.visible)&&this._visible},set:function(e){return this._visible=e}}),t.a=o},ZBgj:function(e,t){e.exports={id:"item-bluesword",width:16,height:16,animations:{idle:{length:6,row:0}},offset_x:0,offset_y:0}},ZQ2e:function(e,t,i){"use strict";var n=i("Zx67"),a=i.n(n),r=i("Zrlr"),o=i.n(r),s=i("zwoO"),h=i.n(s),l=i("Pf15"),u=i.n(l),d=i("yh7f"),c=function(e){function t(e){return o()(this,t),h()(this,(t.__proto__||a()(t)).call(this,e,d.a.Entities.CHEST))}return u()(t,e),t}(i("DwfQ").a);t.a=c},aNYQ:function(e,t){e.exports={id:"forestnpc",width:24,height:24,animations:{idle_down:{length:2,row:0}},offset_x:-4,offset_y:-8}},"b8n+":function(e,t,i){"use strict";var n=i("pFYg"),a=i.n(n),r=i("OvRC"),o=i.n(r),s=i("XDXK"),h=function(e,t,i,n,a,r,o,h){this.setAssetPath(t,o,h);i=void 0!==i?i:0,n=void 0!==n?n:0,a=void 0!==a?a:null,r=void 0!==r?r:null;this.asset?(a=null!==a?a:this.asset.width,r=null!==r?r:this.asset.height):this.sheet&&this.sheetImageData&&(a=null!==a?a:this.sheetImageData.frame.w,r=null!==r?r:this.sheetImageData.frame.h),s.a.bind(this)(e,i,n,a,r)};(h.prototype=o()(s.a.prototype)).draw=function(e,t,i,n,a){this.sheet&&this.sheetImageData?e.drawImage(this.sheet,this.sheetImageData.frame.x,this.sheetImageData.frame.y,this.sheetImageData.frame.w,this.sheetImageData.frame.h,t,i,n,a):e.drawImage(this.asset,t,i,n,a)},h.prototype.setAssetPath=function(e,t,i){this.assetPath=e,void 0!==t||this.sheet?(this.asset=null,this.parseSheet(e,t,i)):(this.asset=AssetLoader.getAssetById(e),this.sheet=null)},h.prototype.parseSheet=function(e,t,i){if(void 0===i&&!this.sheetData)throw new Error("Sheet data path missing when creating sprite from sheet");if(!t&&this.sheet||(this.sheet=AssetLoader.getAssetById(t)),!i&&this.sheetData||(this.sheetData=AssetLoader.getAssetById(i)),"object"!==a()(this.sheetData))throw new Error("Invalid sheet data "+i+" -- not an object");if(!this.sheetData.frames)throw new Error("Invalid sheet data "+i+" -- does not have frames");var n;if(this.sheetData.frames.forEach(function(t){t.filename===e&&(n=t)}),!n)throw new Error('Asset "'+e+'" does not exist in sheet "'+i+'"');this.sheetImageData=n},t.a=h},c6m3:function(e,t,i){"use strict";(function(e,n){var a=i("BO1k"),r=i.n(a),o=i("Zrlr"),s=i.n(o),h=i("wxAW"),l=i.n(h),u=i("1fqz"),d=i("fzpQ"),c=i("ITPp"),f=i("GoZD"),p=i("m3jU"),g=i("X+Uv"),m=i("N9/5"),w=i("yh7f"),v=i("ZQ2e"),y=i("AeT2"),_=i("8qcI"),x=i("rwlJ"),k=(i.n(x),i("zTqn")),b=i("OSyj"),S=function(){function t(){s()(this,t)}return l()(t,[{key:"init",value:function(t){var i=t.width,n=t.height;this.canvas=t;var a=new e.WebGLRenderer({canvas:t});a.shadowMap.enabled=!0,a.setPixelRatio(window.devicePixelRatio),a.setSize(i,n),a.autoClear=!1;var r=new e.PerspectiveCamera(20,t.width/t.height,1,3e3),o=new y.a(t,n);this.renderer=a,this.camera=r,this.ui=o;var s=new e.Scene;this.scene=s,this.entities={},this.entityGrid=null,this.phase=null,this.nextPhase=null,this.initPostprocessing(i,n)}},{key:"initPostprocessing",value:function(t,i){var n={enabled:!0},a=e.BokehDepthShader,r=new e.ShaderMaterial({uniforms:a.uniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader});r.uniforms.mNear.value=this.camera.near,r.uniforms.mFar.value=this.camera.far,n.materialDepth=r;var o=3,s=4;n.scene=new e.Scene,n.camera=new e.OrthographicCamera(t/-2,t/2,i/2,i/-2,-1e4,1e4),n.camera.position.z=100,n.scene.add(n.camera);var h={minFilter:e.LinearFilter,magFilter:e.LinearFilter,format:e.RGBFormat};n.rtTextureDepth=new e.WebGLRenderTarget(t,i,h),n.rtTextureColor=new e.WebGLRenderTarget(t,i,h);var l=e.BokehShader;n.bokeh_uniforms=e.UniformsUtils.clone(l.uniforms),n.bokeh_uniforms.tColor.value=n.rtTextureColor.texture,n.bokeh_uniforms.tDepth.value=n.rtTextureDepth.texture,n.bokeh_uniforms.textureWidth.value=t,n.bokeh_uniforms.textureHeight.value=i,n.bokeh_uniforms.znear.value=this.camera.near,n.bokeh_uniforms.zfar.value=this.camera.far,n.bokeh_uniforms.shaderFocus.value=!1,n.bokeh_uniforms.focusCoords.value.set(.5,.5),n.materialBokeh=new e.ShaderMaterial({uniforms:n.bokeh_uniforms,vertexShader:l.vertexShader,fragmentShader:l.fragmentShader,defines:{RINGS:o,SAMPLES:s}}),n.quad=new e.Mesh(new e.PlaneBufferGeometry(t,i),n.materialBokeh),n.quad.position.z=-500,n.scene.add(n.quad),this.postprocessing=n}},{key:"updateCamera",value:function(){var t=this;if(this.camera&&this.player){var i=void 0,n=new e.Vector3(-200,150,200);if(this.battlemode){var a=new e.Vector3(0,0,0),r=0;this.forEachEntity(function(e){e.spriteMesh&&(a=a.add(e.mesh.position.clone()),r++)}),i=a.divideScalar(r),this.battle_asset.zoom_effect&&(n.z=250,n.y=75)}else(i=this.player.mesh.position.clone()).y+=16;var o=n.add(i).sub(this.camera.position),s=Math.min(o.length(),5),h=o.normalize().multiplyScalar(s);this.camera.position.add(h),this.camera.lookAt(i),this.forEachEntity(function(e){e.spriteMesh&&e.spriteMesh.lookAt(t.camera.position)})}}},{key:"tick",value:function(){if(this.currentTime=(new Date).getTime(),this.updater.update(),this.ui.render(),this.battle_asset&&(this.battle_asset.movie&&this.battle_asset.movie.update(),this.battle_asset.update&&this.battle_asset.update()),this.updateCamera(),this.postprocessing.enabled){var e=this.renderer,t=this.postprocessing,i=this.player.mesh.position.distanceTo(this.camera.position),n=this.camera.far,a=this.camera.near,r=Math.max(0,Math.min(1,(i-a)/(n-a))),o=-n*a/((1-r*r*(3-2*r))*(n-a)-n);t.bokeh_uniforms.focalDepth.value=o,e.clear(),e.setRenderTarget(t.rtTextureColor),e.clear(),e.render(this.scene,this.camera),this.scene.overrideMaterial=t.materialDepth,e.setRenderTarget(t.rtTextureDepth),e.clear(),e.render(this.scene,this.camera),this.scene.overrideMaterial=null,e.setRenderTarget(null),e.render(t.scene,t.camera)}else this.scene.overrideMaterial=null,this.renderer.setRenderTarget(null),this.renderer.clear(),this.renderer.render(this.scene,this.camera);this.isStopped||requestAnimationFrame(this.tick.bind(this))}},{key:"start",value:function(){this.tick()}},{key:"stop",value:function(){this.isStopped=!0}},{key:"enterZone",value:function(t){if(this.currentZone){for(;this.scene.children.length>0;)this.scene.remove(this.scene.children[0]);this.entities={}}this.map.initByName(t),this.currentZone=t,this.initEntityGrid(),p.a.setGridSize(this.map.tilesize),this.scene.add(this.map.mesh);var i=new e.AmbientLight(16777215,.5);this.scene.add(i);var n=100,a=!0,o=!1,s=void 0;try{for(var h,l=r()(this.map.props);!(a=(h=l.next()).done);a=!0){var u=h.value,d=g.a.createEntity(u.kind,n++,"");d.setGridPosition(u.x,u.y),d instanceof v.a&&(d.model=this.model,d.mesh=d.model.scene.clone(),d.mesh.scale.set(5,5,5),d.mesh.rotation.y=Math.PI),this.addEntity(d),this.scene.add(d.mesh)}}catch(e){o=!0,s=e}finally{try{!a&&l.return&&l.return()}finally{if(o)throw s}}this.pathfinder=new f.a(this.map.width,this.map.height),this.player.setGridPosition(3,3),this.player.idle(),this.addEntity(this.player),this.scene.add(this.player.mesh)}},{key:"run",value:function(t){var i=this;this.loadSprites(),this.loadMap(),this.loadModel(),this.updater=new d.a(this);var n=setInterval(function(){if(i.map.isLoaded&&i.isSpritesLoaded()&&i.model){clearInterval(n);var a=new u.a(1,t,"");a.setSprite(i.sprites.test5),a.buildMesh(),a.mesh.scale.set(.5,.5,.5),a.onRequestPath(function(e,t){return i.findPath(a,e,t)}),a.onStopPathing(function(t,n){if(a.target instanceof v.a){var r=a.target;if(a.target=null,!r.open){r.open=!0;var o=new e.AnimationMixer(r.mesh.children[0]),s=i.model.animations,h=e.AnimationClip.findByName(s,"Cube.001Action_Cube.001"),l=o.clipAction(h);l.setLoop(e.LoopOnce),l.clampWhenFinished=!0,l.play();var u=setInterval(function(){o.update(.05),l.isRunning()||clearInterval(u)},10)}}if(i.map.isPortal(t,n)){var d=i.map.getPortalDestination(t,n);i.enterZone(d)}}),i.player=a,i.enterZone("home"),i.start()}},100)}},{key:"loadSprites",value:function(){var e={},t=function(t){var i={data:t,image:null,isLoaded:!1};e[t.id]=i;var n=new Image;n.src="static/"+t.id+".png",n.onload=function(){i.image=n,i.isLoaded=!0,i.width=n.width,i.height=n.height}},i=!0,n=!1,a=void 0;try{for(var o,s=r()(_.a);!(i=(o=s.next()).done);i=!0){t(o.value)}}catch(e){n=!0,a=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw a}}this.sprites=e}},{key:"loadMap",value:function(){this.map=new c.a}},{key:"loadModel",value:function(){var e=this;(new m.a).load("static/box.gltf",function(t){e.model=t},void 0,function(e){console.error(e)})}},{key:"isSpritesLoaded",value:function(){return!n.any(this.sprites,function(e){return!e.isLoaded})}},{key:"initEntityGrid",value:function(){this.entityGrid=[];for(var e=0;e<this.map.height;e+=1){this.entityGrid[e]=[];for(var t=0;t<this.map.width;t+=1)this.entityGrid[e][t]={}}}},{key:"addEntity",value:function(e){void 0===this.entities[e.id]&&(this.entities[e.id]=e,this.registerEntityPosition(e))}},{key:"removeEntity",value:function(e){e.id in this.entities&&(this.unregisterEntityPosition(e),delete this.entities[e.id])}},{key:"registerEntityPosition",value:function(e){var t=e.gridX,i=e.gridY;this.entityGrid[i][t][e.id]=e}},{key:"unregisterEntityPosition",value:function(e){var t=e.gridX,i=e.gridY;this.entityGrid[i][t][e.id]&&delete this.entityGrid[i][t][e.id]}},{key:"getEntityAt",value:function(e,t){if(this.map.isOutOfBounds(e,t)||!this.entityGrid)return null;var i=this.entityGrid[t][e],a=null;return n.size(i)>0&&(a=i[n.keys(i)[0]]),a}},{key:"getItemAt",value:function(e,t){return null}},{key:"getGridPosition",value:function(e){var t=this.map.offset,i=this.map.tilesize;return{x:Math.floor((e.x-t.x)/i),y:Math.floor((e.z-t.y)/i)}}},{key:"click",value:function(t,i){if(this.ui&&this.ui.clickHandler(t,i))return;this.phase&&this.phase.click(t,i);var n=new e.Vector2;this.renderer.getSize(n);var a=new e.Vector2;a.x=t/n.x*2-1,a.y=-i/n.y*2+1;var o=new e.Raycaster;o.setFromCamera(a,this.camera);var s=o.intersectObjects(this.scene.children),h=!0,l=!1,u=void 0;try{for(var d,c=r()(s);!(h=(d=c.next()).done);h=!0){var f=d.value,p=this.getGridPosition(f.point),g=this.getEntityAt(p.x,p.y);g instanceof v.a?(this.player.setTarget(g),this.player.follow(g)):this.player.go(p.x,p.y)}}catch(e){l=!0,u=e}finally{try{!h&&c.return&&c.return()}finally{if(l)throw u}}}},{key:"keyDown",value:function(t){var i=this;if(66===t)if(this.battlemode=!this.battlemode,this.battlemode){var n=new Image;n.src="static/battleui.png",n.onload=function(){document.getElementById("foreground").getContext("2d").drawImage(n,0,0)};var a=new k.a(10,"");a.setSprite(this.sprites.test4),a.buildMesh(),a.setGridPosition(3,5),this.addEntity(a),this.scene.add(a.mesh),a.animate("attack_ready",200),this.player.setGridPosition(12,5),this.player.setOrientation(w.a.Orientations.LEFT),this.player.walk();var r={enemy:a,click:this.click};this.click=function(){if(!a.isAttacking){var e=a.mesh.position.clone(),t=i.player.mesh.position.clone(),n=new b.a(new b.a.Timeline(0,40,a.mesh,[["x",e.x,t.x-16,"inOutSine"],["z",e.z,t.z,"inOutSine"]]),new b.a.Timeline(41,100,a.mesh,[["x",t.x-16,t.x-16,"linear"],["z",t.z,t.z,"linear"]]),new b.a.Timeline(101,130,a.mesh,[["x",t.x-16,e.x,"inOutSine"],["z",t.z,e.z,"inOutSine"]]));n.playAndDestroy(function(){a.isAttacking=!1}),a.isAttacking=!0,r.movie=n,r.update=function(){n._playing&&(n._frame>100?(a.animate("attack_ready",200),r.zoom_effect=!1):n._frame>70?a.animate("attack",100):n._frame>40&&(r.zoom_effect=!0))}}},this.battle_asset=r}else{var o=document.getElementById("foreground");if(o.getContext("2d").clearRect(0,0,o.width,o.height),this.battle_asset){var s=this.battle_asset.enemy;this.removeEntity(s),this.scene.remove(s.mesh),this.click=this.battle_asset.click,this.battle_asset.timeout&&clearTimeout(this.battle_asset.timeout),this.player.idle(),this.battle_asset=null}}if(67===t)if(this.isometric=!this.isometric,this.isometric){var h=canvas.width/canvas.height,l=new e.OrthographicCamera(100*h/-2,100*h/2,50,-50,1,1e3);l.position.set(100,100,100),this.postprocessing.enabled=!1,this.camera=l}else{var u=new e.PerspectiveCamera(20,canvas.width/canvas.height,1,3e3);this.camera=u,this.postprocessing.enabled=!0}}},{key:"forEachEntity",value:function(e){n.each(this.entities,function(t){e(t)})}},{key:"findPath",value:function(e,t,i){return this.map.isColliding(t,i)?[]:this.pathfinder&&e?this.pathfinder.findPath(this.map.grid,e,t,i,!1):[]}}]),t}();t.a=S}).call(t,i("Ml+6"),i("rdLu"))},cKQl:function(e,t){e.exports={id:"chest",width:16,height:16,animations:{idle_down:{length:1,row:0}},offset_x:0,offset_y:0}},cbRa:function(e,t,i){"use strict";var n=i("Zrlr"),a=i.n(n),r=i("wxAW"),o=i.n(r),s=function(){function e(){a()(this,e)}return o()(e,[{key:"setGame",value:function(e){this.game=e}},{key:"center",value:function(){window.scrollTo(0,1)}},{key:"start",value:function(e){this.center(),this.game.run()}}]),e}();t.a=s},e7Fs:function(e,t){e.exports={id:"villager",width:24,height:24,animations:{idle_down:{length:2,row:0}},offset_x:-4,offset_y:-8}},eOxi:function(e,t){e.exports={id:"coder",width:24,height:24,animations:{idle_down:{length:2,row:0}},offset_x:-4,offset_y:-7}},esNN:function(e,t){e.exports={id:"test1",width:32,height:32,animations:{atk_right:{length:3,row:3},walk_right:{length:3,row:2},idle_right:{length:3,row:2},walk_up:{length:3,row:1},idle_up:{length:3,row:1},walk_down:{length:3,row:0},idle_down:{length:3,row:0}},offset_x:0,offset_y:-12}},fzpQ:function(e,t,i){"use strict";var n=i("BO1k"),a=i.n(n),r=i("Zrlr"),o=i.n(r),s=i("wxAW"),h=i.n(s),l=i("zTqn"),u=i("yh7f"),d=function(){function e(t){o()(this,e),this.game=t}return h()(e,[{key:"update",value:function(){this.updateEntities(),this.updateTransitions(),this.updatePhase()}},{key:"updateEntities",value:function(){var e=this;this.game.forEachEntity(function(t){t instanceof l.a&&(e.updateCharacter(t),e.updateAnimation(t)),e.updateEntityFading(t)})}},{key:"updateCharacter",value:function(e){var t=Math.round(16/Math.round(e.moveSpeed/(1e3/60)));e.isMoving()&&!1===e.movement.inProgress&&(e.orientation===u.a.Orientations.LEFT?e.movement.start(this.game.currentTime,function(t){e.x=t,e.hasMoved()},function(){e.x=e.movement.endValue,e.hasMoved(),e.nextStep()},e.x-t,e.x-16,e.moveSpeed):e.orientation===u.a.Orientations.RIGHT?e.movement.start(this.game.currentTime,function(t){e.x=t,e.hasMoved()},function(){e.x=e.movement.endValue,e.hasMoved(),e.nextStep()},e.x+t,e.x+16,e.moveSpeed):e.orientation===u.a.Orientations.UP?e.movement.start(this.game.currentTime,function(t){e.y=t,e.hasMoved()},function(){e.y=e.movement.endValue,e.hasMoved(),e.nextStep()},e.y-t,e.y-16,e.moveSpeed):e.orientation===u.a.Orientations.DOWN&&e.movement.start(this.game.currentTime,function(t){e.y=t,e.hasMoved()},function(){e.y=e.movement.endValue,e.hasMoved(),e.nextStep()},e.y+t,e.y+16,e.moveSpeed))}},{key:"updateAnimation",value:function(e){var t=e.currentAnimation;t&&t.update(this.game.currentTime)&&t.currentFrame&&((e.flipSpriteX&&e.texture.repeat.x>0||!e.flipSpriteX&&e.texture.repeat.x<0)&&(e.texture.repeat.x=-e.texture.repeat.x),e.texture.repeat.x>0?e.texture.offset.set(t.currentFrame.x/e.sprite.width,(e.sprite.height-t.currentFrame.y-t.height)/e.sprite.height):e.texture.offset.set(-(e.sprite.width-t.currentFrame.x-t.width)/e.sprite.width,(e.sprite.height-t.currentFrame.y-t.height)/e.sprite.height))}},{key:"updateTransitions",value:function(){var e=this,t=this.game.map.offset.x+this.game.map.tilesize/2,i=this.game.map.offset.y+this.game.map.tilesize/2;this.game.forEachEntity(function(n){var r=n.movement;if(r&&r.inProgress&&r.step(e.game.currentTime),n.mesh&&n.mesh.position.set(t+n.x+n.offset.x,0+n.offset.y,i+n.y+n.offset.z),n.shatters){var o=!0,s=!1,h=void 0;try{for(var l,u=a()(n.shatters);!(o=(l=u.next()).done);o=!0){var d=l.value;d._pos_init||(d.position.x+=n.mesh.position.x,d.position.z+=n.mesh.position.z,d._pos_init=!0,d.shatterTick=100*Math.random());--d.shatterTick,d.shatterTick<0&&(Math.abs(n.mesh.position.x-d.position.x)<1?d.position.x=n.mesh.position.x:d.position.x+=1/(n.mesh.position.x-d.position.x),Math.abs(n.mesh.position.y-d.position.y)<3?d.position.y=n.mesh.position.y:d.position.y+=3/(n.mesh.position.y-d.position.y),Math.abs(n.mesh.position.z-d.position.z)<1?d.position.z=n.mesh.position.z:d.position.z+=1/(n.mesh.position.z-d.position.z))}}catch(e){s=!0,h=e}finally{try{!o&&u.return&&u.return()}finally{if(s)throw h}}}}),this.game.mesh__&&(this.game.mesh__.position.copy(this.game.player.mesh.position),this.game.mesh__.position.y=11)}},{key:"updateEntityFading",value:function(e){if(e&&e.isFading){var t=this.game.currentTime-e.startFadingTime;t>1e3?(e.isFading=!1,e.mesh&&(e.spriteMesh.material.opacity=1)):e.mesh&&(e.spriteMesh.material.opacity=t/1e3)}}},{key:"updatePhase",value:function(){this.game.nextPhase&&(this.game.phase?(this.game.phase.end(),this.game.phase=null):(this.game.phase=this.game.nextPhase,this.game.nextPhase=null,this.game.phase.begin())),this.game.phase&&this.game.phase.update()}}]),e}();t.a=d},hemJ:function(e,t){e.exports={id:"goldensword",width:48,height:48,animations:{atk_right:{length:5,row:0},walk_right:{length:4,row:1},idle_right:{length:2,row:2},atk_up:{length:5,row:3},walk_up:{length:4,row:4},idle_up:{length:2,row:5},atk_down:{length:5,row:6},walk_down:{length:4,row:7},idle_down:{length:2,row:8}},offset_x:-16,offset_y:-20}},ijQv:function(e,t){e.exports={id:"arrow",width:14,height:14,animations:{idle_down:{length:1,row:0}}}},j8az:function(e,t){e.exports={id:"talk",width:14,height:14,animations:{idle_down:{length:1,row:0}}}},jQdr:function(e,t){var i=/firefox/i.test(navigator.userAgent);e.exports.isFirefox=i},jgxY:function(e,t){e.exports={id:"skeleton2",width:48,height:48,animations:{atk_right:{length:3,row:0},walk_right:{length:4,row:1},idle_right:{length:2,row:2},atk_up:{length:3,row:3},walk_up:{length:4,row:4},idle_up:{length:2,row:5},atk_down:{length:3,row:6},walk_down:{length:4,row:7},idle_down:{length:3,row:8}},offset_x:-16,offset_y:-20}},kqRq:function(e,t){e.exports={id:"test5",width:64,height:96,animations:{idle_right:{length:6,row:0},idle_up:{length:6,row:1},idle_down:{length:6,row:0}},offset_x:0,offset_y:-23}},lUAm:function(e,t){e.exports={id:"desertnpc",width:24,height:24,animations:{idle_down:{length:2,row:0}},offset_x:-4,offset_y:-8}},lgfl:function(e,t){e.exports={id:"octocat",width:32,height:32,animations:{idle_down:{length:4,row:0}},offset_x:-8,offset_y:-12}},m3jU:function(e,t,i){"use strict";var n=i("Zrlr"),a=i.n(n),r=i("wxAW"),o=i.n(r),s=function(){function e(t,i){a()(this,e),this.id=t,this.kind=i,this.isLoaded=!1}return o()(e,[{key:"setPosition",value:function(e,t){this.x=e,this.y=t}},{key:"setGridPosition",value:function(t,i){this.gridX=t,this.gridY=i,this.setPosition(t*e.gridSize,i*e.gridSize)}},{key:"fadeIn",value:function(e){this.isFading=!0,this.startFadingTime=e}}],[{key:"setGridSize",value:function(t){e.gridSize=t}}]),e}();t.a=s},mJyv:function(e,t){e.exports={id:"hand",width:14,height:14,animations:{idle_down:{length:1,row:0}}}},me95:function(e,t){e.exports={id:"shadow16",width:16,height:16}},"n+Rf":function(e,t){e.exports={id:"item-platearmor",width:16,height:16,animations:{idle:{length:6,row:0}},offset_x:0,offset_y:0}},ni5p:function(e,t){e.exports={id:"priest",width:24,height:24,animations:{idle_down:{length:2,row:0}},offset_x:-4,offset_y:-8}},oxPP:function(e,t){e.exports={id:"bat",width:32,height:48,animations:{atk_right:{length:5,row:0},walk_right:{length:5,row:1},idle_right:{length:5,row:2},atk_up:{length:5,row:3},walk_up:{length:5,row:4},idle_up:{length:5,row:5},atk_down:{length:5,row:6},walk_down:{length:5,row:7},idle_down:{length:5,row:8}},offset_x:-8,offset_y:-24}},q9QV:function(e,t){e.exports={id:"axe",width:48,height:48,animations:{atk_right:{length:5,row:0},walk_right:{length:4,row:1},idle_right:{length:2,row:2},atk_up:{length:5,row:3},walk_up:{length:4,row:4},idle_up:{length:2,row:5},atk_down:{length:5,row:6},walk_down:{length:4,row:7},idle_down:{length:2,row:8}},offset_x:-16,offset_y:-20}},rwlJ:function(e,t,i){(function(e){e.BokehShader={uniforms:{textureWidth:{value:1},textureHeight:{value:1},focalDepth:{value:1},focalLength:{value:24},fstop:{value:.9},tColor:{value:null},tDepth:{value:null},maxblur:{value:1},showFocus:{value:0},manualdof:{value:0},vignetting:{value:0},depthblur:{value:0},threshold:{value:.5},gain:{value:2},bias:{value:.5},fringe:{value:.7},znear:{value:.1},zfar:{value:100},noise:{value:1},dithering:{value:1e-4},pentagon:{value:0},shaderFocus:{value:1},focusCoords:{value:new e.Vector2}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","varying vec2 vUv;","uniform sampler2D tColor;","uniform sampler2D tDepth;","uniform float textureWidth;","uniform float textureHeight;","uniform float focalDepth;  //focal distance value in meters, but you may use autofocus option below","uniform float focalLength; //focal length in mm","uniform float fstop; //f-stop value","uniform bool showFocus; //show debug focus point and focal range (red = focal point, green = focal range)","/*","make sure that these two values are the same for your camera, otherwise distances will be wrong.","*/","uniform float znear; // camera clipping start","uniform float zfar; // camera clipping end","//------------------------------------------","//user variables","const int samples = SAMPLES; //samples on the first ring","const int rings = RINGS; //ring count","const int maxringsamples = rings * samples;","uniform bool manualdof; // manual dof calculation","float ndofstart = 1.0; // near dof blur start","float ndofdist = 2.0; // near dof blur falloff distance","float fdofstart = 1.0; // far dof blur start","float fdofdist = 3.0; // far dof blur falloff distance","float CoC = 0.03; //circle of confusion size in mm (35mm film = 0.03mm)","uniform bool vignetting; // use optical lens vignetting","float vignout = 1.3; // vignetting outer border","float vignin = 0.0; // vignetting inner border","float vignfade = 22.0; // f-stops till vignete fades","uniform bool shaderFocus;","// disable if you use external focalDepth value","uniform vec2 focusCoords;","// autofocus point on screen (0.0,0.0 - left lower corner, 1.0,1.0 - upper right)","// if center of screen use vec2(0.5, 0.5);","uniform float maxblur;","//clamp value of max blur (0.0 = no blur, 1.0 default)","uniform float threshold; // highlight threshold;","uniform float gain; // highlight gain;","uniform float bias; // bokeh edge bias","uniform float fringe; // bokeh chromatic aberration / fringing","uniform bool noise; //use noise instead of pattern for sample dithering","uniform float dithering;","uniform bool depthblur; // blur the depth buffer","float dbsize = 1.25; // depth blur size","/*","next part is experimental","not looking good with small sample and ring count","looks okay starting from samples = 4, rings = 4","*/","uniform bool pentagon; //use pentagon as bokeh shape?","float feather = 0.4; //pentagon shape feather","//------------------------------------------","float penta(vec2 coords) {","//pentagonal shape","float scale = float(rings) - 1.3;","vec4  HS0 = vec4( 1.0,         0.0,         0.0,  1.0);","vec4  HS1 = vec4( 0.309016994, 0.951056516, 0.0,  1.0);","vec4  HS2 = vec4(-0.809016994, 0.587785252, 0.0,  1.0);","vec4  HS3 = vec4(-0.809016994,-0.587785252, 0.0,  1.0);","vec4  HS4 = vec4( 0.309016994,-0.951056516, 0.0,  1.0);","vec4  HS5 = vec4( 0.0        ,0.0         , 1.0,  1.0);","vec4  one = vec4( 1.0 );","vec4 P = vec4((coords),vec2(scale, scale));","vec4 dist = vec4(0.0);","float inorout = -4.0;","dist.x = dot( P, HS0 );","dist.y = dot( P, HS1 );","dist.z = dot( P, HS2 );","dist.w = dot( P, HS3 );","dist = smoothstep( -feather, feather, dist );","inorout += dot( dist, one );","dist.x = dot( P, HS4 );","dist.y = HS5.w - abs( P.z );","dist = smoothstep( -feather, feather, dist );","inorout += dist.x;","return clamp( inorout, 0.0, 1.0 );","}","float bdepth(vec2 coords) {","// Depth buffer blur","float d = 0.0;","float kernel[9];","vec2 offset[9];","vec2 wh = vec2(1.0/textureWidth,1.0/textureHeight) * dbsize;","offset[0] = vec2(-wh.x,-wh.y);","offset[1] = vec2( 0.0, -wh.y);","offset[2] = vec2( wh.x -wh.y);","offset[3] = vec2(-wh.x,  0.0);","offset[4] = vec2( 0.0,   0.0);","offset[5] = vec2( wh.x,  0.0);","offset[6] = vec2(-wh.x, wh.y);","offset[7] = vec2( 0.0,  wh.y);","offset[8] = vec2( wh.x, wh.y);","kernel[0] = 1.0/16.0;   kernel[1] = 2.0/16.0;   kernel[2] = 1.0/16.0;","kernel[3] = 2.0/16.0;   kernel[4] = 4.0/16.0;   kernel[5] = 2.0/16.0;","kernel[6] = 1.0/16.0;   kernel[7] = 2.0/16.0;   kernel[8] = 1.0/16.0;","for( int i=0; i<9; i++ ) {","float tmp = texture2D(tDepth, coords + offset[i]).r;","d += tmp * kernel[i];","}","return d;","}","vec3 color(vec2 coords,float blur) {","//processing the sample","vec3 col = vec3(0.0);","vec2 texel = vec2(1.0/textureWidth,1.0/textureHeight);","col.r = texture2D(tColor,coords + vec2(0.0,1.0)*texel*fringe*blur).r;","col.g = texture2D(tColor,coords + vec2(-0.866,-0.5)*texel*fringe*blur).g;","col.b = texture2D(tColor,coords + vec2(0.866,-0.5)*texel*fringe*blur).b;","vec3 lumcoeff = vec3(0.299,0.587,0.114);","float lum = dot(col.rgb, lumcoeff);","float thresh = max((lum-threshold)*gain, 0.0);","return col+mix(vec3(0.0),col,thresh*blur);","}","vec3 debugFocus(vec3 col, float blur, float depth) {","float edge = 0.002*depth; //distance based edge smoothing","float m = clamp(smoothstep(0.0,edge,blur),0.0,1.0);","float e = clamp(smoothstep(1.0-edge,1.0,blur),0.0,1.0);","col = mix(col,vec3(1.0,0.5,0.0),(1.0-m)*0.6);","col = mix(col,vec3(0.0,0.5,1.0),((1.0-e)-(1.0-m))*0.2);","return col;","}","float linearize(float depth) {","return -zfar * znear / (depth * (zfar - znear) - zfar);","}","float vignette() {","float dist = distance(vUv.xy, vec2(0.5,0.5));","dist = smoothstep(vignout+(fstop/vignfade), vignin+(fstop/vignfade), dist);","return clamp(dist,0.0,1.0);","}","float gather(float i, float j, int ringsamples, inout vec3 col, float w, float h, float blur) {","float rings2 = float(rings);","float step = PI*2.0 / float(ringsamples);","float pw = cos(j*step)*i;","float ph = sin(j*step)*i;","float p = 1.0;","if (pentagon) {","p = penta(vec2(pw,ph));","}","col += color(vUv.xy + vec2(pw*w,ph*h), blur) * mix(1.0, i/rings2, bias) * p;","return 1.0 * mix(1.0, i /rings2, bias) * p;","}","void main() {","//scene depth calculation","float depth = linearize(texture2D(tDepth,vUv.xy).x);","// Blur depth?","if ( depthblur ) {","depth = linearize(bdepth(vUv.xy));","}","//focal plane calculation","float fDepth = focalDepth;","if (shaderFocus) {","fDepth = linearize(texture2D(tDepth,focusCoords).x);","}","// dof blur factor calculation","float blur = 0.0;","if (manualdof) {","float a = depth-fDepth; // Focal plane","float b = (a-fdofstart)/fdofdist; // Far DoF","float c = (-a-ndofstart)/ndofdist; // Near Dof","blur = (a>0.0) ? b : c;","} else {","float f = focalLength; // focal length in mm","float d = fDepth*1000.0; // focal plane in mm","float o = depth*1000.0; // depth in mm","float a = (o*f)/(o-f);","float b = (d*f)/(d-f);","float c = (d-f)/(d*fstop*CoC);","blur = abs(a-b)*c;","}","blur = clamp(blur,0.0,1.0);","// calculation of pattern for dithering","vec2 noise = vec2(rand(vUv.xy), rand( vUv.xy + vec2( 0.4, 0.6 ) ) )*dithering*blur;","// getting blur x and y step factor","float w = (1.0/textureWidth)*blur*maxblur+noise.x;","float h = (1.0/textureHeight)*blur*maxblur+noise.y;","// calculation of final color","vec3 col = vec3(0.0);","if(blur < 0.05) {","//some optimization thingy","col = texture2D(tColor, vUv.xy).rgb;","} else {","col = texture2D(tColor, vUv.xy).rgb;","float s = 1.0;","int ringsamples;","for (int i = 1; i <= rings; i++) {","/*unboxstart*/","ringsamples = i * samples;","for (int j = 0 ; j < maxringsamples ; j++) {","if (j >= ringsamples) break;","s += gather(float(i), float(j), ringsamples, col, w, h, blur);","}","/*unboxend*/","}","col /= s; //divide by sample count","}","if (showFocus) {","col = debugFocus(col, blur, depth);","}","if (vignetting) {","col *= vignette();","}","gl_FragColor.rgb = col;","gl_FragColor.a = 1.0;","} "].join("\n")},e.BokehDepthShader={uniforms:{mNear:{value:1},mFar:{value:1e3}},vertexShader:["varying float vViewZDepth;","void main() {","\t#include <begin_vertex>","\t#include <project_vertex>","\tvViewZDepth = - mvPosition.z;","}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","varying float vViewZDepth;","void main() {","\tfloat color = 1.0 - smoothstep( mNear, mFar, vViewZDepth );","\tgl_FragColor = vec4( vec3( color ), 1.0 );","} "].join("\n")}}).call(t,i("Ml+6"))},spbf:function(e,t){e.exports={id:"test3",width:24,height:48,animations:{walk_right:{length:4,row:2},idle_right:{length:1,row:2},walk_up:{length:4,row:1},idle_up:{length:1,row:1},walk_down:{length:4,row:0},idle_down:{length:1,row:0},attack_ready:{length:4,row:2}},offset_x:0,offset_y:-21}},t0mp:function(e,t){e.exports={id:"scientist",width:24,height:24,animations:{idle_down:{length:2,row:0}},offset_x:-4,offset_y:-8}},t9nu:function(e,t){e.exports={id:"impact",width:16,height:16,animations:{idle:{length:1,row:0}},offset_x:0,offset_y:0}},tTs3:function(e,t,i){"use strict";var n=i("OvRC"),a=i.n(n),r=i("XDXK"),o=function(e,t,i,n,a,o,s){this.textAlign="left",this.textBaseline="alphabetic",this.text=void 0!==t?t:"",this.size=void 0!==i?i:12,this.font=void 0!==n?n:"Arial",this.color=void 0!==a?a:"#000000",this.lineHeight=1;o=void 0!==o?o:0,s=void 0!==s?s:0;r.a.bind(this)(e,o,s)};(o.prototype=a()(r.a.prototype)).draw=function(e,t,i){e.font=this.size+"px "+this.font,e.fillStyle=this.color,e.textAlign=this.textAlign,e.textBaseline=this.textBaseline;var n=this.text.split("\n"),a=0;"center"===this.textVerticalAlign?a=n.length/2-.5:"bottom"===this.textVerticalAlign&&(a=n.length-1);for(var r=0;r<n.length;r++){var o=n[r],s=i+(r-a)*(this.size*this.lineHeight);e.fillText(o,t,s)}},t.a=o},taTb:function(e,t){e.exports={id:"boss",width:64,height:72,animations:{atk_right:{length:6,row:0},walk_right:{length:3,row:1},idle_right:{length:4,row:2},atk_up:{length:5,row:3},walk_up:{length:4,row:4},idle_up:{length:4,row:5},atk_down:{length:6,row:6},walk_down:{length:4,row:7},idle_down:{length:4,row:8},"Group 5":{length:3,row:9}},offset_x:-24,offset_y:-36}},uL5Q:function(e,t,i){"use strict";t.a={center:1,left:2,right:3,top:4,bottom:5}},ujQs:function(e,t){e.exports={id:"firefox",width:32,height:32,animations:{atk_right:{length:5,row:0},walk_right:{length:4,row:1},idle_right:{length:5,row:2},atk_up:{length:5,row:3},walk_up:{length:8,row:4},idle_up:{length:2,row:5},atk_down:{length:5,row:6},walk_down:{length:4,row:7},idle_down:{length:2,row:8}},offset_x:-8,offset_y:-12}},vm1t:function(e,t){e.exports={id:"sword1",width:32,height:32,animations:{atk_right:{length:5,row:0},walk_right:{length:4,row:1},idle_right:{length:2,row:2},atk_up:{length:5,row:3},walk_up:{length:4,row:4},idle_up:{length:2,row:5},atk_down:{length:5,row:6},walk_down:{length:4,row:7},idle_down:{length:2,row:8}},offset_x:-8,offset_y:-12}},wV90:function(e,t,i){"use strict";new Int32Array(4096)},wVoP:function(e,t,i){"use strict";var n=i("Zrlr"),a=i.n(n),r=i("wxAW"),o=i.n(r),s=function(){function e(t,i,n,r,o){a()(this,e),this.name=t,this.length=i,this.row=n,this.width=r,this.height=o,this.reset()}return o()(e,[{key:"tick",value:function(){var e=this.currentFrame.index;if(e=e<this.length-1?e+1:0,this.count>0&&0===e&&(this.count-=1,0===this.count))return this.currentFrame.index=0,void this.endcount_callback();this.currentFrame.x=this.width*e,this.currentFrame.y=this.height*this.row,this.currentFrame.index=e}},{key:"setSpeed",value:function(e){this.speed=e}},{key:"setCount",value:function(e,t){this.count=e,this.endcount_callback=t}},{key:"isTimeToAnimate",value:function(e){return e-this.lastTime>this.speed}},{key:"update",value:function(e){return 0===this.lastTime&&"atk"===this.name.substr(0,3)&&(this.lastTime=e),!!this.isTimeToAnimate(e)&&(this.lastTime=e,this.tick(),!0)}},{key:"reset",value:function(){this.lastTime=0,this.currentFrame={index:0,x:0,y:this.row*this.height}}}]),e}();t.a=s},wine:function(e,t){e.exports={id:"sword",width:14,height:14,animations:{idle_down:{length:1,row:0}}}},wzZJ:function(e,t){e.exports={id:"item-burger",width:16,height:16,animations:{idle:{length:6,row:0}},offset_x:0,offset_y:0}},ySG5:function(e,t){e.exports={id:"loot",width:14,height:14,animations:{idle_down:{length:1,row:0}}}},yWNk:function(e,t){e.exports={id:"bluesword",width:48,height:48,animations:{atk_right:{length:5,row:0},walk_right:{length:4,row:1},idle_right:{length:2,row:2},atk_up:{length:5,row:3},walk_up:{length:4,row:4},idle_up:{length:2,row:5},atk_down:{length:5,row:6},walk_down:{length:4,row:7},idle_down:{length:2,row:8}},offset_x:-16,offset_y:-20}},yh7f:function(e,t,i){"use strict";t.a={Orientations:{UP:1,DOWN:2,LEFT:3,RIGHT:4},Entities:{PLAYER:1,FIRE:2,CHEST:3,DEATHKNIGHT:4},BattleState:{BEGIN:1,MAIN:2,END:3}}},zRJz:function(e,t){e.exports={id:"rat",width:48,height:48,animations:{death:{length:4,row:0},atk_right:{length:6,row:1},walk_right:{length:3,row:2},idle_right:{length:2,row:3},atk_up:{length:4,row:4},walk_up:{length:4,row:5},idle_up:{length:4,row:6},atk_down:{length:4,row:7},walk_down:{length:4,row:8},idle_down:{length:4,row:9}}}},zTqn:function(e,t,i){"use strict";(function(e,n){var a=i("Zx67"),r=i.n(a),o=i("Zrlr"),s=i.n(o),h=i("wxAW"),l=i.n(h),u=i("zwoO"),d=i.n(u),c=i("Pf15"),f=i.n(c),p=(i("wV90"),i("m3jU")),g=i("TAbc"),m=i("yh7f"),w=i("wVoP"),v=function(t){function i(e,t){s()(this,i);var n=d()(this,(i.__proto__||r()(i)).call(this,e,t));return n.nextGridX=-1,n.nextGridY=-1,n.orientation=m.a.Orientations.DOWN,n.movement=new g.a,n.path=null,n.newDestination=null,n.adjacentTiles={},n.animations={},n.currentAnimation=null,n.flipSpriteX=!1,n.flipSpriteY=!1,n.moveSpeed=120,n.walkSpeed=100,n.idleSpeed=450,n}return f()(i,t),l()(i,[{key:"setSprite",value:function(e){for(var t in this.sprite=e,e.data.animations){var i=e.data.animations[t];this.animations[t]=new w.a(t,i.length,i.row,e.data.width,e.data.height)}}},{key:"getAnimationByName",value:function(e){if(e in this.animations)return this.animations[e]}},{key:"setAnimation",value:function(e,t,i,n){if(!this.currentAnimation||this.currentAnimation.name!==e){var a=this.getAnimationByName(e);a&&(this.currentAnimation=a,"atk"===e.substr(0,3)&&this.currentAnimation.reset(),this.currentAnimation.setSpeed(t),this.currentAnimation.setCount(i||0,n||function(){this.idle()}))}}},{key:"animate",value:function(t,i,n,a){var r=this.orientation;this.currentAnimation&&"death"===this.currentAnimation.name||(this.flipSpriteX=!1,this.flipSpriteY=!1,e.indexOf(["atk","walk","idle"],t)>=0&&(t+="_"+(r===m.a.Orientations.LEFT?"right":function(e){switch(e){case m.a.Orientations.LEFT:return"left";case m.a.Orientations.RIGHT:return"right";case m.a.Orientations.UP:return"up";case m.a.Orientations.DOWN:return"down"}}(r)),this.flipSpriteX=this.orientation===m.a.Orientations.LEFT),this.setAnimation(t,i,n,a))}},{key:"buildMesh",value:function(){if(this.sprite){var e=new n.Group,t=new n.PlaneGeometry(this.sprite.data.width,this.sprite.data.height);t.computeFaceNormals(),t.computeBoundingBox();var i=new n.Texture;i.image=this.sprite.image,i.format=n.RGBAFormat,i.needsUpdate=!0,i.wrapS=i.wrapT=n.RepeatWrapping;var a=this.sprite.width/this.sprite.data.width,r=this.sprite.height/this.sprite.data.height;i.repeat.set(1/a,1/r),i.magFilter=n.NearestFilter,i.minFilter=n.NearestMipMapNearestFilter;var o=new n.MeshStandardMaterial({map:i,transparent:!0}),s=new n.Mesh(t,o);s.scale.x=.6,s.scale.y=.6,e.add(s);var h=new n.SphereGeometry(1,16,16),l=new n.MeshBasicMaterial({transparent:!0,opacity:0}),u=new n.Mesh(h,l);u.scale.set(this.sprite.data.width/2.3,this.sprite.data.height/2.3,this.sprite.data.width/2.3),u.castShadow=!0,s.add(u),this.mesh=e,this.texture=s.material.map,this.spriteMesh=s,this.offset={x:0,y:.6*-this.sprite.data.offset_y||0,z:0},this.mesh.renderOrder=1}}},{key:"requestPathfindingTo",value:function(e,t){return this.request_path_callback?this.request_path_callback(e,t):[]}},{key:"onRequestPath",value:function(e){this.request_path_callback=e}},{key:"onStartPathing",value:function(e){this.start_pathing_callback=e}},{key:"onStopPathing",value:function(e){this.stop_pathing_callback=e}},{key:"onBeforeStep",value:function(e){this.before_step_callback=e}},{key:"onStep",value:function(e){this.step_callback=e}},{key:"isMoving",value:function(){return!(null===this.path)}},{key:"hasMoved",value:function(){this.hasmoved_callback&&this.hasmoved_callback(this)}},{key:"hasNextStep",value:function(){return this.path.length-1>this.step}},{key:"hasChangedItsPath",value:function(){return!(null===this.newDestination)}},{key:"setOrientation",value:function(e){e&&(this.orientation=e)}},{key:"idle",value:function(e){this.setOrientation(e),this.animate("idle",this.idleSpeed)}},{key:"walk",value:function(e){this.setOrientation(e),this.animate("walk",this.walkSpeed)}},{key:"go",value:function(e,t){this.followingMode&&(this.followingMode=!1,this.target=null),this.moveTo(e,t)}},{key:"follow",value:function(e){e&&(this.followingMode=!0,this.moveTo(e.gridX,e.gridY))}},{key:"moveTo",value:function(e,t){if(this.destination={gridX:e,gridY:t},this.isMoving())this.continueTo(e,t);else{var i=this.requestPathfindingTo(e,t);this.followPath(i)}}},{key:"stop",value:function(){this.isMoving()&&(this.interrupted=!0)}},{key:"continueTo",value:function(e,t){this.newDestination={x:e,y:t}}},{key:"updateMovement",value:function(){var e=this.path,t=this.step;e[t][0]<e[t-1][0]&&this.walk(m.a.Orientations.LEFT),e[t][0]>e[t-1][0]&&this.walk(m.a.Orientations.RIGHT),e[t][1]<e[t-1][1]&&this.walk(m.a.Orientations.UP),e[t][1]>e[t-1][1]&&this.walk(m.a.Orientations.DOWN)}},{key:"followPath",value:function(e){e.length>1&&(this.path=e,this.step=0,this.followingMode&&e.pop(),this.start_pathing_callback&&this.start_pathing_callback(e),this.nextStep())}},{key:"nextStep",value:function(){var e=!1;if(this.isMoving()){if(this.before_step_callback&&this.before_step_callback(),this.updatePositionOnGrid(),this.interrupted)e=!0,this.interrupted=!1;else if(this.hasNextStep()&&(this.nextGridX=this.path[this.step+1][0],this.nextGridY=this.path[this.step+1][1]),this.step_callback&&this.step_callback(),this.hasChangedItsPath()){var t=this.newDestination.x,i=this.newDestination.y,n=this.requestPathfindingTo(t,i);this.newDestination=null,n.length<2?e=!0:this.followPath(n)}else this.hasNextStep()?(this.step+=1,this.updateMovement()):e=!0;e&&(this.path=null,this.idle(),this.stop_pathing_callback&&this.stop_pathing_callback(this.gridX,this.gridY))}}},{key:"updatePositionOnGrid",value:function(){this.setGridPosition(this.path[this.step][0],this.path[this.step][1])}},{key:"setTarget",value:function(e){this.target!==e&&(this.target=e)}}]),i}(p.a);t.a=v}).call(t,i("rdLu"),i("Ml+6"))}},["NHnr"]);
//# sourceMappingURL=app.348ff5de5aa0c14c173f.js.map